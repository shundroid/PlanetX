!function e(t,n,a){function o(r,s){if(!n[r]){if(!t[r]){var c="function"==typeof require&&require;if(!s&&c)return c(r,!0);if(i)return i(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[r]={exports:{}};t[r][0].call(u.exports,function(e){var n=t[r][1][e];return o(n?n:e)},u,u.exports,e,t,n,a)}return n[r].exports}for(var i="function"==typeof require&&require,r=0;r<a.length;r++)o(a[r]);return o}({1:[function(e,t,n){var a,o=e("./ui"),i=e("./modules/initDOM"),r=e("./modules/packUtil/packLoader"),s=e("./modules/packUtil/packManager"),c=e("./modules/event"),l=e("./modules/stage"),u=e("./modules/data"),d=e("./modules/makePrefabDataUrls"),f=e("./modules/tray"),p=e("./modules/prefab"),m=e("./modules/classes/vector2"),h=e("./modules/classes/rect"),g=e("./modules/canvas"),v=e("./modules/editBlock"),k=e("./modules/ui/focusGuide");!function(e){function t(){u.dataInit()}t(),i(function(){o.setupCanvas(),r(u.defaultPackName).then(function(e){u.pack=new s.packModule(e),c.raiseEvent("packLoaded",null),l.stageEffects.skybox=u.pack.editor.defaultSkybox,o.setSkybox(s.getPackPath(u.defaultPackName)+u.pack.skyboxes.get(u.pack.editor.defaultSkybox).data.filename),c.raiseEvent("initedPack",null),c.raiseEvent("initedUI",null),o.initTrayBlock().then(function(){o.initTrayObj().then(function(){c.raiseEvent("initedTray",null)})})}),c.addEventListener("initedTray",function(){o.changeLoadingStatus("making DataURL"),u.trayItemDataURLs=d();var e=u.pack.blocks.get(u.pack.editor.defaultBlock);f.updateActiveBlock(u.pack.editor.defaultBlock,e.data.filename,e.data.bName),o.changeLoadingStatus("Are you ready?"),c.raiseEvent("ready",null)}),c.addEventListener("ready",function(){o.hideLoading()}),c.addEventListener("gridCanvas",function(e){var t=new p(e.gridPos.x,e.gridPos.y,u.selectBlock.fileName,u.selectBlock.blockName,l.toGridPos(u.selectBlock.width),l.toGridPos(u.selectBlock.height)),n=l.getPrefabFromGrid(new m(t.gridX,t.gridY),u.activeStageLayer),a=l.toDrawRect(new h(t.gridX,t.gridY,t.gridW,t.gridH));switch(k.hide(),u.activeToolName){case"pencil":"down"===e.eventName?n.contains?(l.items.remove(n.id,u.activeStageLayer),l.renderStage(u.activeStageLayer)):(g.render(u.selectImage,a),l.items.push(l.getId(),t,u.activeStageLayer)):"hovering"===e.eventName&&k.focus(new m(a.x,a.y),new m(a.width,a.height),n.contains?"rgba(240,0,0,0.6)":"rgba(0,240,0,0.6)");break;case"choice":if("down"===e.eventName&&n.prefab){if(u.pack.objs.contains(n.prefab.blockName)){var i=u.pack.objs.get(n.prefab.blockName);f.updateActiveBlock(n.prefab.blockName,i.data.oName,s.getPackPath(u.defaultPackName)+i.data.filename,i.data.width,i.data.height)}else{var r=u.pack.blocks.get(n.prefab.blockName);f.updateActiveBlock(n.prefab.blockName,r.data.bName,s.getPackPath(u.defaultPackName)+r.data.filename)}o.changeActiveBlock(n.prefab.blockName)}break;case"hand":"move"===e.eventName&&(l.scrollX+=e.mousePos.x-l.scrollBeforeX,l.scrollY+=e.mousePos.y-l.scrollBeforeY,l.renderStage(u.activeStageLayer)),l.scrollBeforeX=e.mousePos.x,l.scrollBeforeY=e.mousePos.y;break;case"edit":"down"===e.eventName&&n.contains&&(o.showInspector("edit-block"),u.editingBlockId=n.id,v.updateEditBlock(new v.EditBlock(n.prefab.blockName,new m(n.prefab.gridX,n.prefab.gridY),n.id)));break;default:("move"===e.eventName||"down"===e.eventName)&&("brush"===u.activeToolName?(n.contains&&n.prefab.blockName!==u.selectBlock.blockName&&(l.items.remove(n.id,u.activeStageLayer),l.renderStage(u.activeStageLayer)),n.contains||(g.render(u.selectImage,a),l.items.push(l.getId(),t,u.activeStageLayer))):"erase"===u.activeToolName&&n.contains&&(l.items.remove(n.id,u.activeStageLayer),l.renderStage(u.activeStageLayer)))}})})}(a||(a={})),t.exports=a},{"./modules/canvas":2,"./modules/classes/rect":4,"./modules/classes/vector2":6,"./modules/data":8,"./modules/editBlock":9,"./modules/event":12,"./modules/initDOM":15,"./modules/makePrefabDataUrls":17,"./modules/packUtil/packLoader":18,"./modules/packUtil/packManager":19,"./modules/prefab":21,"./modules/stage":22,"./modules/tray":23,"./modules/ui/focusGuide":26,"./ui":29}],2:[function(e,t,n){var a,o=e("./initDOM");!function(e){function t(){r.width=window.innerWidth,r.height=window.innerHeight,e.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight}}function n(e,t){s.drawImage(e,t.x,t.y,t.width,t.height)}function a(e){s.clearRect(e.x,e.y,e.width,e.height)}function i(){s.clearRect(0,0,r.width,r.height)}var r,s;o(function(){r=document.getElementById("pla-canvas"),e.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight},t(),r&&r.getContext&&(s=r.getContext("2d"),s.imageSmoothingEnabled=!1,s.mozImageSmoothingEnabled=!1,s.webkitImageSmoothingEnabled=!1,s.msImageSmoothingEnabled=!1)}),window.addEventListener("resize",t),e.render=n,e.clearByRect=a,e.clear=i}(a||(a={})),t.exports=a},{"./initDOM":15}],3:[function(e,t,n){var a=function(){function e(){this.data={}}return e.prototype.push=function(e,t){this.data[e]=t},e.prototype.update=function(e,t){this.data[e]=t},e.prototype.get=function(e){return this.data[e]},e.prototype.getAll=function(){return this.data},e.prototype.remove=function(e){delete this.data[e]},e.prototype.clear=function(){this.data={}},e.prototype.contains=function(e){return this.data.hasOwnProperty(e)},e.prototype.toSimple=function(){return this.data},e}();t.exports=a},{}],4:[function(e,t,n){var a=function(){function e(e,t,n,a){this.x=e,this.y=t,this.width=n,this.height=a}return e}();t.exports=a},{}],5:[function(e,t,n){var a=function(){function e(e,t,n,a,o){this.blockName=e,this.fileName=t,this.label=n,this.width=a,this.height=o}return e}();t.exports=a},{}],6:[function(e,t,n){var a=function(){function e(e,t){this.x=e,this.y=t}return Object.defineProperty(e,"zero",{get:function(){return new e(0,0)},enumerable:!0,configurable:!0}),e}();t.exports=a},{}],7:[function(e,t,n){var a,o=e("./jsonPlanet"),i=e("./version");!function(e){function t(e){var t=e.split("\n"),n=[],a=0,o=-1,i=0;return n.push("//:csv"),t.forEach(function(e){if(""!==e)if(-1===o)i++,5===i&&o++;else if(0===o)5===i&&"// stageCTRL::edit not_header"===e?o++:5===i?(n.push("//:header"),n.push(e),i++):"// stageCTRL::edit /header"===e?(n.push("//:/header"),o++):n.push(e);else if(1===o){if("// stageCTRL::edit footer"===e)return o++,void(i=10);if("// stageCTRL::edit not_footer"===e)return void(o+=2);if("*"===e.substring(0,1))return void(-1!==e.indexOf("*skybox,")?n.push(e):n.push(e));if(":"===e.substring(0,1))return;if(e=e.replace(/ /g,""),"//"===e.substring(0,2))return;e=e.split("=")[0];var t=e.split(",");t[2]=(-parseInt(t[2])).toString(),n.push([[t[0],t[1],t[2]].join(","),a++].join("="))}else 2===o&&(10===i?(i++,n.push("//:footer"),n.push(e)):"// stageCTRL::edit /footer"===e?(n.push("//:/footer"),o++):n.push(e))}),n.join("\n")}function n(e){var t=new o.jsonPlanet(i.jsonPlanetVersion),n=e.split("\n");return n.forEach(function(e){if(""!==e&&"*"!==e.substring(0,1)&&"//"!==e.substring(0,2)){var n=e.split("="),a=n[0].split(",");t.Stage[0].push(new o.jsonBlockItem(a[0],parseInt(a[1]),parseInt(a[2]),n[1]))}}),t}e.old2CSV=t,e.csv2Json=n}(a||(a={})),t.exports=a},{"./jsonPlanet":16,"./version":28}],8:[function(e,t,n){var a=e("./classes/list"),o=function(){function e(){}return e.dataInit=function(){this.trayItemDataURLs=new a,this.defaultPackName="oa",this.defaultGridSize=25,this.defaultBlockSize=50,this.activeToolName="pencil",this.isObjMode=!1,this.isFullscreenTray=!1,this.isShowInspector=!1,this.activeStageLayer=0},e}();t.exports=o},{"./classes/list":3}],9:[function(e,t,n){var a,o=e("./data"),i=e("./stage");!function(e){function t(e){d=e,a()}function n(){return d}function a(){if(document.getElementById("ed-name").textContent="Name: "+d.blockName,document.getElementById("ed-pos").textContent="Pos: "+d.blockPos.x+", "+d.blockPos.y,document.getElementById("ed-id").textContent="ID: "+d.blockId,document.getElementsByClassName("ed-attr-view")[0].innerHTML="",i.blockAttrs.containsBlock(o.editingBlockId)){var e=i.blockAttrs.getBlock(o.editingBlockId);Object.keys(e).forEach(function(e){var t=i.blockAttrs.getAttr(o.editingBlockId,parseInt(e));r(parseInt(e),t.attrVal,t.attrName)})}}function r(e,t,n){var a=document.createElement("section");a.id="ed-attr-field-"+e;var o=document.createElement("input");o.type="text",o.id="ed-attr-name-"+e,o.classList.add("ed-attr-name"),o.placeholder="name","undefined"!=typeof t&&(o.value=t),o.addEventListener("change",c);var i=document.createElement("input");i.type="text",i.id="ed-attr-"+e,i.classList.add("ed-attr-val"),i.placeholder="value","undefined"!=typeof n&&(i.value=n),i.addEventListener("change",s);var r=document.createElement("button");r.innerHTML='<i class="fa fa-minus"></i>',r.classList.add("pla-btn"),r.id="ed-attr-remove-"+e,r.addEventListener("click",l),a.appendChild(r),a.appendChild(o),a.appendChild(document.createTextNode(":")),a.appendChild(i),document.getElementsByClassName("ed-attr-view")[0].appendChild(a)}function s(e){console.log(i.blockAttrs.getAll()),console.log(parseInt(e.target.id.replace("ed-attr-",""))),i.blockAttrs.update(o.editingBlockId,parseInt(e.target.id.replace("ed-attr-","")),{attrVal:e.target.value})}function c(e){i.blockAttrs.update(o.editingBlockId,parseInt(e.target.id.replace("ed-attr-name-","")),{attrName:e.target.value})}function l(e){var t=parseInt(e.target.id.replace("ed-attr-remove-",""));i.blockAttrs.removeAttr(o.editingBlockId,t),document.getElementsByClassName("ed-attr-view")[0].removeChild(document.getElementById("ed-attr-field-"+t))}var u=function(){function e(e,t,n){this.blockName=e,this.blockPos=t,this.blockId=n}return e}();e.EditBlock=u;var d;e.updateEditBlock=t,e.getCurrentEditBlock=n,e.updateEditBlockUI=a,e.renderAttributeUI=r,e.changeAttrVal=s,e.changeAttrName=c,e.clickRemoveAttr=l}(a||(a={})),t.exports=a},{"./data":8,"./stage":22}],10:[function(e,t,n){var a;!function(e){function t(e,t,a){n(e,function(e){e.addEventListener(t,a)})}function n(e,t){Array.prototype.forEach.call(document.querySelectorAll(e),t)}e.addEventListenerforQuery=t,e.forEachforQuery=n}(a||(a={})),t.exports=a},{}],11:[function(e,t,n){var a,o=e("./elem");!function(e){function t(e){o.forEachforQuery(".ev-btn",function(t){t.addEventListener("click",e[t.dataset.listener])}),o.forEachforQuery(".ev-input",function(t){var n=t;"undefined"!=typeof n.dataset["default"]&&(n.value=n.dataset["default"]),"undefined"!=typeof n.dataset.change&&n.addEventListener("change",e[n.dataset.change])})}e.set=t}(a||(a={})),t.exports=a},{"./elem":10}],12:[function(e,t,n){var a,o=e("./classes/list");!function(e){function t(e,n){-1!==e.indexOf("|")?e.split("|").forEach(function(e){t(e,n)}):a.contains(e)?a.get(e).push(n):a.push(e,[n])}function n(e,t){a.contains(e)&&a.get(e).forEach(function(n){n(t,e)})}var a=new o;e.addEventListener=t,e.raiseEvent=n}(a||(a={})),t.exports=a},{"./classes/list":3}],13:[function(e,t,n){function a(e,t,n){var o=new Image;if(o.src=e,t){var i,r,s=(o.width+n.x)/2,c=(o.height+n.y)/2;return i=document.createElement("canvas"),i.width=s,i.height=c,r=i.getContext("2d"),r.drawImage(o,0,0,s,c),a(i.toDataURL("image/png"))}return o}t.exports=a},{}],14:[function(e,t,n){function a(e){var t=document.createElement("script");return t.src=e,t}t.exports=a},{}],15:[function(e,t,n){function a(e){o.push(e)}var o=new Array;document.addEventListener("DOMContentLoaded",function(){o.forEach(function(e){e()})}),t.exports=a},{}],16:[function(e,t,n){var a,o=e("./version");!function(e){var t=function(){function e(e,t,n,a,o){this.blockName=e,this.posX=t,this.posY=n,this.name=a,this.attr=o}return e.prototype.toArray=function(){var e=[this.blockName,this.posX,this.posY];return"undefined"!=typeof this.name?e.push(this.name):e.push(""),"undefined"!=typeof this.attr&&e.push(this.attr),e},e.fromArray=function(t){var n=new e(t[0],t[1],t[2],t[3]);return"undefined"!=typeof t[4]&&(n.attr=t[4]),n},e}();e.jsonBlockItem=t;var n=function(){function e(e,t){void 0===t&&(t=[]),this.JsonPlanetVersion=e,this.Stage=t}return e.prototype.exportJson=function(){var e={};e.JsonPlanetVersion=this.JsonPlanetVersion,e.Stage=[];for(var t=0;t<this.Stage.length;t++)e.Stage[t]=[],this.Stage[t].forEach(function(n){e.Stage[t].push(n.toArray())});return e},e.importJson=function(n){for(var a=new e(n.JsonPlanetVersion||o.jsonPlanetVersion),i=n.Stage,r=0;r<i.length;r++)a.Stage[r]=[],i[r].forEach(function(e){a.Stage[r].push(t.fromArray(e))});return a},e}();e.jsonPlanet=n}(a||(a={})),t.exports=a},{"./version":28}],17:[function(e,t,n){function a(){var e=new i,t=o.pack.blocks.getAll();Object.keys(t).forEach(function(t){e.push(t,c(r.getPackPath(o.defaultPackName)+o.pack.blocks.get(t).data.filename,!0,new s(o.defaultGridSize,o.defaultGridSize)).src)});var n=o.pack.objs.getAll();return Object.keys(n).forEach(function(t){var n=o.pack.objs.get(t).data;e.push(t,c(r.getPackPath(o.defaultPackName)+n.filename,!0,new s(n.width,n.height)).src)}),e}var o=e("./data"),i=e("./classes/list"),r=e("./packUtil/packManager"),s=e("./classes/vector2"),c=e("./image");t.exports=a},{"./classes/list":3,"./classes/vector2":6,"./data":8,"./image":13,"./packUtil/packManager":19}],18:[function(e,t,n){function a(e){return new Promise(function(t){var n=new XMLHttpRequest;n.open("GET",o.getPackPath(e)+"packinfo.json"),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&t(JSON.parse(n.responseText))},n.send(null)})}var o=e("./packManager");t.exports=a},{"./packManager":19}],19:[function(e,t,n){var a,o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("./../classes/list");!function(e){function t(e){return"pack/"+e+"/"}e.getPackPath=t;var n=function(){function e(e){var t=this;this.pack=new r(e.pack),this.blocks=new i,Object.keys(e.blocks).forEach(function(n){t.blocks.push(n,new c({bName:e.blocks[n].name,filename:e.blocks[n].filename}))}),this.objs=new i,Object.keys(e.objs).forEach(function(n){var a=e.objs[n];a.hidden?t.objs.push(n,new l({oName:a.name,filename:a.filename,width:a.width,height:a.height,type:a.type})):t.objs.push(n,new l({oName:a.name,filename:a.filename,width:a.width,height:a.height,type:a.type,hidden:a.hidden}))}),this.descriptions=new i,Object.keys(e.descriptions).forEach(function(n){var a=e.descriptions[n];t.descriptions.push(n,new u(a))}),this.skyboxes=new f,Object.keys(e.skyboxes).forEach(function(n){t.skyboxes.push(n,new d(e.skyboxes[n]))}),this.editor=e.editor}return e}();e.packModule=n;var a=function(){function e(e,t,n,a){this.defaultSkybox=e,this.defaultBlock=t,this.skyboxMode=n,this.skyboxSize=a}return e}();e.packEditorInfo=a;var r=function(){function e(e){this.pName=e.name,this.version=e.version,this.author=e.author,this.exportType=e.exportType}return e}();e.packInfo=r;var s=function(){function e(e){this.data=e}return e}();e.packItem=s;var c=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(s);e.blockInfo=c;var l=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(s);e.objInfo=l;var u=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(s);e.desInfo=u;var d=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(s);e.skyboxInfo=d;var f=function(e){function t(){e.call(this)}return o(t,e),t.prototype.toSimple=function(){var e=this,t={};return Object.keys(this.getAll()).forEach(function(n){t[e.get(n).data.label]=n}),t},t}(i);e.skyboxInfoList=f}(a||(a={})),t.exports=a},{"./../classes/list":3}],20:[function(e,t,n){var a,o=e("./stage"),i=e("./prefab"),r=e("./data"),s=e("./jsonPlanet"),c=e("./version");!function(e){function t(){for(var e=new s.jsonPlanet(c.jsonPlanetVersion),t=o.items.getAllLayer(),n=0;n<t.length;n++)e.Stage[n]=[],t[n].forEach(function(t){var a=o.items.get(t);if(o.blockAttrs.containsBlock(t)){var i={},r=o.blockAttrs.getBlock(t);Object.keys(r).forEach(function(e){i[r[parseInt(e)].attrName]=r[parseInt(e)].attrVal}),e.Stage[n].push(new s.jsonBlockItem(a.blockName,a.gridX,a.gridY,t.toString(),i))}else e.Stage[n].push(new s.jsonBlockItem(a.blockName,a.gridX,a.gridY,t.toString()))});return e}function n(e){o.items.clear(),o.blockAttrs.clear(),o.resetId();for(var t=0;t<e.Stage.length;t++)e.Stage[t].forEach(function(e){var n=o.getId();if(r.pack.objs.contains(e.blockName)){var a=r.pack.objs.get(e.blockName);o.items.push(n,new i(e.posX,e.posY,a.data.filename,e.blockName,o.toGridPos(a.data.width),o.toGridPos(a.data.height)),t)}else{var s=r.pack.blocks.get(e.blockName);o.items.push(n,new i(e.posX,e.posY,s.data.filename,e.blockName,o.toGridPos(r.defaultBlockSize),o.toGridPos(r.defaultBlockSize)),t)}"undefined"!=typeof e.attr&&Object.keys(e.attr).forEach(function(t){o.blockAttrs.push(n,o.blockAttrs.getMaxAttrId(n),new o.Attr(t,e.attr[t]))})});r.activeStageLayer=0;var n=new o.StageEffects;return n.skybox="sky",n}e.toJsonPlanet=t,e.fromJsonPlanet=n}(a||(a={})),t.exports=a},{"./data":8,"./jsonPlanet":16,"./prefab":21,"./stage":22,"./version":28}],21:[function(e,t,n){var a=function(){function e(e,t,n,a,o,i){this.gridX=e,this.gridY=t,this.fileName=n,this.blockName=a,this.gridW=o,this.gridH=i}return e}();t.exports=a},{}],22:[function(e,t,n){var a,o=e("./classes/list"),i=e("./canvas"),r=e("./image"),s=e("./data"),c=e("./classes/rect"),l=e("./event"),u=e("./classes/vector2");!function(e){function t(e){s.activeStageLayer=e,f(e)}function n(){S={},w={},x=new Array,e.header="",e.footer="",P=0}function a(){return P++}function d(){P=0}function f(t){void 0===t&&(t=0),i.clear();var n=I.getLayerItems(t).getAll();Object.keys(n).forEach(function(t){var n=I.get(parseInt(t)),a=e.scrollX+e.getMousePosFromCenterAndSize(e.toMousePos(n.gridX),e.toMousePos(n.gridW)),o=e.scrollY+e.getMousePosFromCenterAndSize(e.toMousePos(n.gridY),e.toMousePos(n.gridH)),l=e.toMousePos(n.gridW),u=e.toMousePos(n.gridH);a+l>=0&&a<=i.canvasRect.width&&o+u>=0&&o<=i.canvasRect.height&&i.render(r(s.trayItemDataURLs.get(n.blockName)),new c(a,o,l,u))})}function p(e,t){return e-(t-s.defaultGridSize)/2}function m(t){var n=t.x-e.scrollX,a=t.y-e.scrollY,o=n-n%s.defaultGridSize,i=a-a%s.defaultGridSize,r=o/s.defaultGridSize,c=i/s.defaultGridSize;return new u(r,c)}function h(e,t){var n=new j(!1,-1,null),a={};try{Object.keys(I.getLayerItems(t).getAll()).forEach(function(t){var o=I.get(parseInt(t));if(e.x>=o.gridX&&e.x<o.gridX+o.gridW&&e.y>=o.gridY&&e.y<o.gridY+o.gridH)throw n=new j(!0,parseInt(t),o),a})}catch(o){if(o!==a)throw o}return n}function g(e){return e*s.defaultGridSize}function v(e){return(e-e%s.defaultGridSize)/s.defaultGridSize}function k(t){return new c(e.scrollX+p(g(t.x),g(t.width)),e.scrollY+p(g(t.y),g(t.height)),g(t.width),g(t.height))}var y=function(){function e(){this.skybox=""}return e}();e.StageEffects=y,e.stageEffects=new y;var b=function(){function e(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this.attrName=e,this.attrVal=t}return e}();e.Attr=b;var w,E;!function(e){function t(e){w=e}function n(e,t,n){"undefined"==typeof w[e]&&(w[e]={}),w[e][t]=n}function a(e,t,n){if(n instanceof b)w[e][t]=n;else{var a=w[e][t];"undefined"!=typeof n.attrName&&(a.attrName=n.attrName),"undefined"!=typeof n.attrVal&&(a.attrVal=n.attrVal),w[e][t]=a}}function o(e,t){return"undefined"==typeof w[e]?!1:"undefined"!=typeof w[e][t]}function i(e){return"undefined"!=typeof w[e]}function r(e,t){delete w[e][t]}function s(e){delete w[e]}function c(e){return w[e]}function l(e,t){return w[e][t]}function u(){return w}function d(){w={}}function f(e){return"undefined"==typeof w[e]?0:Object.keys(w[e]).length}e.setAll=t,e.push=n,e.update=a,e.containsAttr=o,e.containsBlock=i,e.removeAttr=r,e.removeBlock=s,e.getBlock=c,e.getAttr=l,e.getAll=u,e.clear=d,e.getMaxAttrId=f}(E=e.blockAttrs||(e.blockAttrs={}));var S,x;e.changeActiveStageLayer=t;var I;!function(e){function t(e,t,n){void 0===n&&(n=0),S[e]=t,c(n,e)}function n(){return S}function a(e,t){x[t].splice(x[t].indexOf(e),1),delete S[e]}function i(){S={}}function r(e){return S[e]}function s(e){var t=l(e),n=new o;return t.forEach(function(e){n.push(e.toString(),r(e))}),n}function c(e,t){"undefined"==typeof x[e]&&(x[e]=[]),x[e].push(t)}function l(e){return"undefined"==typeof x[e]&&(x[e]=[]),x[e]}function u(){return x}e.push=t,e.all=n,e.remove=a,e.clear=i,e.get=r,e.getLayerItems=s,e.pushStageLayer=c,e.getLayerIds=l,e.getAllLayer=u}(I=e.items||(e.items={}));var P;n(),e.getId=a,e.resetId=d,e.renderStage=f;var L,B=!1;l.addEventListener("resize",function(){B&&clearTimeout(L),B=!0,L=setTimeout(function(){B=!1,f(s.activeStageLayer)},100)});var N=function(){function e(e,t,n){this.gridPos=e,this.eventName=t,this.mousePos=n}return e}();e.gridDetail=N,e.getMousePosFromCenterAndSize=p,e.scrollX=0,e.scrollY=0,e.scrollBeforeX=0,e.scrollBeforeY=0,e.getGridPosFromMousePos=m;var j=function(){function e(e,t,n){this.contains=e,this.id=t,this.prefab=n}return e}();e.getPrefabFromGridDetails=j,e.getPrefabFromGrid=h,e.toMousePos=g,e.toGridPos=v,e.toDrawRect=k}(a||(a={})),t.exports=a},{"./canvas":2,"./classes/list":3,"./classes/rect":4,"./classes/vector2":6,"./data":8,"./event":12,"./image":13}],23:[function(e,t,n){var a,o=e("./image"),i=e("./classes/trayBlockDetails"),r=e("./data"),s=e("./uiWaitMode"),c=e("./event"),l=e("./packUtil/packManager");!function(e){function t(e,t,a,o,s){var c=o||r.defaultBlockSize,l=s||r.defaultBlockSize;r.selectBlock=new i(e,t,a,c,l),n()}function n(){r.selectImage=o(r.trayItemDataURLs.get(r.selectBlock.blockName)),s.start(),r.selectImage.onload=function(){s.end()}}function a(e){return new Promise(function(t){var n=Object.keys(r.pack.blocks.getAll()),a=[],o=function(i){var s=n[i],u=document.createElement("div");u.classList.add("tray-list","tray-list-block"),u.addEventListener("click",function(e){c.raiseEvent("ui_clickTray",e)});var d=document.createElement("img");d.src=l.getPackPath(r.defaultPackName)+r.pack.blocks.get(s).data.filename,d.onload=function(){d.alt=r.pack.blocks.get(s).data.bName,d.dataset.block=s,u.appendChild(d),a.push(u),i===n.length-1?t(a):(e(i,n.length-1),o(i+1))}};o(0)})}function u(e){return new Promise(function(t){var n=Object.keys(r.pack.objs.getAll()),a=[],o=function(i){var s=n[i],u=document.createElement("div");u.classList.add("tray-list","tray-list-obj"),u.addEventListener("click",function(e){c.raiseEvent("ui_clickTray",e)});var d=document.createElement("img");d.src=l.getPackPath(r.defaultPackName)+r.pack.objs.get(s).data.filename,d.onload=function(){d.alt=r.pack.objs.get(s).data.oName,d.dataset.block=s,u.style.width=d.style.width=r.pack.objs.get(s).data.width/(r.pack.objs.get(s).data.height/50)+"px",u.style.height=d.style.height="50px",u.appendChild(d),a.push(u),i===n.length-1?t(a):(e(i,n.length-1),o(i+1))}};o(0)})}e.updateActiveBlock=t,e.updateSelectImage=n,e.initTrayBlock=a,e.initTrayObj=u}(a||(a={})),t.exports=a},{"./classes/trayBlockDetails":5,"./data":8,"./event":12,"./image":13,"./packUtil/packManager":19,"./uiWaitMode":24}],24:[function(e,t,n){var a;!function(e){function t(){document.getElementById("pla-canvas").style.cursor="wait"}function n(){document.getElementById("pla-canvas").style.cursor="crosshair"}e.start=t,e.end=n}(a||(a={})),t.exports=a},{}],25:[function(e,t,n){var a;!function(e){function t(){move(".pla-footer").set("height","100%").duration("0.5s").end()}function n(){move(".pla-footer").set("height","50px").duration("0.5s").end()}function a(){move(".pla-inspector").set("left","80%").duration("0.5s").end()}function o(){move(".pla-inspector").set("left","100%").duration("0.5s").end()}function i(){move(".loading").set("opacity",0).duration("1s").then().set("display","none").pop().end()}e.showTrayFull=t,e.hideTrayFull=n,e.showInspector=a,e.hideInspector=o,e.hideLoading=i}(a||(a={})),t.exports=a},{}],26:[function(e,t,n){var a,o=e("./../initDOM");!function(e){function t(e,t,n){a.style.visibility="visible",a.style.left=e.x+"px",a.style.top=e.y+"px",a.style.width=t.x+"px",a.style.height=t.y+"px",a.style.backgroundColor=n}function n(){a.style.visibility="hidden"}var a;o(function(){a=document.createElement("div"),a.id="guide",a.style.position="fixed",a.style.backgroundColor="rgba(240,0,0,0.6)",a.style.pointerEvents="none",document.body.appendChild(a)}),e.focus=t,e.hide=n}(a||(a={})),t.exports=a},{"./../initDOM":15}],27:[function(e,t,n){var a;!function(e){function t(e){var n=[];return Object.keys(e).forEach(function(a){e[a].constructor==={}.constructor?(n.push('<optgroup label="'+a+'">'),n.push(t(e[a])),n.push("</optgroup>")):n.push('<option value="'+e[a]+'">'+a+"</option>")}),n.join("\n")}e.obj2SelectElem=t}(a||(a={})),t.exports=a},{}],28:[function(e,t,n){var a;!function(e){e.version="v1.0",e.author="shundroid",e.jsonPlanetVersion=.1}(a||(a={})),t.exports=a},{}],29:[function(e,t,n){var a,o=e("./modules/data"),i=e("./modules/initDOM"),r=e("./modules/event"),s=e("./modules/elem"),c=e("./modules/compiler"),l=e("./modules/importJS"),u=e("./modules/util"),d=e("./modules/classes/vector2"),f=e("./modules/tray"),p=e("./modules/packUtil/packManager"),m=e("./modules/planet"),h=e("./modules/stage"),g=e("./modules/version"),v=e("./modules/evElems"),k=e("./modules/ui/anim"),y=e("./modules/editBlock"),b=e("./modules/jsonPlanet");!function(e){function t(){window.addEventListener("resize",function(){r.raiseEvent("resize",null)}),r.addEventListener("ui_clickTray",function(e){var t=e.target;if(o.isObjMode=t.parentElement.classList.contains("tray-list-obj"),o.isObjMode){var n=o.pack.objs.get(t.dataset.block).data;f.updateActiveBlock(t.dataset.block,n.filename,n.oName,n.width,n.height)}else{var n=o.pack.blocks.get(t.dataset.block).data;f.updateActiveBlock(t.dataset.block,n.filename,n.bName)}M(t.dataset.block)}),r.addEventListener("ui_downCanvas|ui_moveCanvas|ui_upCanvas|ui_hoveringCanvas",function(e,t){var n=h.getGridPosFromMousePos(new d(e.clientX,e.clientY));r.raiseEvent("gridCanvas",new h.gridDetail(n,t.replace("ui_","").replace("Canvas",""),new d(e.clientX,e.clientY)))}),r.addEventListener("initedPack",function(){"undefined"!=typeof o.pack.editor.skyboxMode&&"repeat"===o.pack.editor.skyboxMode&&(document.body.style.backgroundRepeat="repeat","undefined"!=typeof o.pack.editor.skyboxSize?document.body.style.backgroundSize=o.pack.editor.skyboxSize:document.body.style.backgroundSize="auto"),s.forEachforQuery(".pack-select",function(e){var t=e;t.innerHTML=u.obj2SelectElem(o.pack[t.dataset.items].toSimple())}),document.getElementById("stg-skybox").value=o.pack.editor.defaultSkybox})}function n(){e.canvas=document.getElementById("pla-canvas"),e.canvas.addEventListener("mousedown",function(e){r.raiseEvent("ui_downCanvas",e)}),e.canvas.addEventListener("mousemove",function(e){1===e.buttons?r.raiseEvent("ui_moveCanvas",e):r.raiseEvent("ui_hoveringCanvas",e)}),e.canvas.addEventListener("mouseup",function(e){r.raiseEvent("ui_upCanvas",e)})}function a(e){o.isFullscreenTray?(k.hideTrayFull(),e.target.textContent="↑"):(w(),k.showTrayFull(),e.target.textContent="↓"),o.isFullscreenTray=!o.isFullscreenTray}function w(){o.isShowInspector&&(o.isShowInspector=!1,k.hideInspector())}function E(e){document.querySelector(".ins-article-active")&&document.querySelector(".ins-article-active").classList.remove("ins-article-active"),document.getElementById("ins-"+e).classList.add("ins-article-active"),o.isShowInspector||(o.isShowInspector=!0,k.showInspector())}function S(){document.getElementById("pla-io").value=JSON.stringify(m.toJsonPlanet().exportJson())}function x(){var e=m.fromJsonPlanet(b.jsonPlanet.importJson(JSON.parse(document.getElementById("pla-io").value)));h.stageEffects=e,B(p.getPackPath(o.defaultPackName)+o.pack.skyboxes.get(e.skybox).data.filename),h.renderStage(o.activeStageLayer)}function I(e){E(e.target.dataset.ins)}function P(e){var t=e.target;"io-header"===t.id?h.header=t.value:"io-footer"===t.id&&(h.footer=t.value)}function L(e){var t=e.target;return"I"===t.nodeName&&(t=t.parentElement),t.classList.contains("tool-btn")?void r.raiseEvent("clickTrayToolbtn",t.dataset.toolname):(document.getElementsByClassName("tool-active")[0].classList.remove("tool-active"),t.classList.add("tool-active"),void(o.activeToolName=t.dataset.toolname))}function B(e){document.body.style.backgroundImage="url('"+e+"')"}function N(){return new Promise(function(e){f.initTrayBlock(function(e,t){A("loading tray-block : "+e.toString()+" / "+t.toString())}).then(function(t){t.forEach(function(e){document.getElementsByClassName("tray-items")[0].appendChild(e)}),e()})})}function j(){return new Promise(function(e){f.initTrayObj(function(e,t){A("loading tray-obj : "+e.toString()+" / "+t.toString())}).then(function(t){t.forEach(function(e){document.getElementsByClassName("tray-items")[0].appendChild(e)}),e()})})}function A(e){document.getElementsByClassName("loading")[0].innerHTML="Loading...<br />"+e}function C(){k.hideLoading()}function M(e){document.querySelector(".tray-active")&&document.querySelector(".tray-active").classList.remove("tray-active"),document.querySelector('[data-block="'+e+'"]').classList.add("tray-active")}function T(){document.getElementById("conv-new").value=JSON.stringify(c.csv2Json(document.getElementById("conv-old").value).exportJson())}function O(e){h.stageEffects.skybox=e.target.value,B(p.getPackPath(o.defaultPackName)+o.pack.skyboxes.get(h.stageEffects.skybox).data.filename)}function z(){var e=h.blockAttrs.getMaxAttrId(o.editingBlockId);h.blockAttrs.push(o.editingBlockId,e,new h.Attr),y.renderAttributeUI(e)}function D(e){h.changeActiveStageLayer(parseInt(e.target.value))}i(function(){v.set(e),document.getElementById("pla-ver").innerHTML="Planet "+g.version+" by "+g.author,s.addEventListenerforQuery(".ins-show-btn","click",I),s.addEventListenerforQuery(".io-hf","change",P),s.addEventListenerforQuery(".tray-list-tool","click",L),document.head.appendChild(l("bower_components/move.js/move.js")),window.onbeforeunload=function(e){e.returnValue="ページを移動しますか？"},r.raiseEvent("initDom",null)}),e.setupCanvas=n,e.togglefullScreen=a,e.closeInspector=w,e.showInspector=E,e.clickExport=S,e.clickImport=x,e.clickInsShowBtn=I,e.changeHeaderorFooterValue=P,e.clickTrayTool=L,e.setSkybox=B,e.initTrayBlock=N,e.initTrayObj=j,e.changeLoadingStatus=A,e.hideLoading=C,e.changeActiveBlock=M,r.addEventListener("clickTrayToolbtn",function(t){var n={io:"io",setting:"inspector"};e.showInspector(n[t])}),e.clickConvertOldFile=T,e.changeSkybox=O,e.clickAddAttr=z,e.changeActiveStageLayer=D,t()}(a||(a={})),t.exports=a},{"./modules/classes/vector2":6,"./modules/compiler":7,"./modules/data":8,"./modules/editBlock":9,"./modules/elem":10,"./modules/evElems":11,"./modules/event":12,"./modules/importJS":14,"./modules/initDOM":15,"./modules/jsonPlanet":16,"./modules/packUtil/packManager":19,"./modules/planet":20,"./modules/stage":22,"./modules/tray":23,"./modules/ui/anim":25,"./modules/util":27,"./modules/version":28}]},{},[1]);