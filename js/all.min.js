!function e(t,a,n){function o(s,r){if(!a[s]){if(!t[s]){var d="function"==typeof require&&require;if(!r&&d)return d(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=a[s]={exports:{}};t[s][0].call(l.exports,function(e){var a=t[s][1][e];return o(a?a:e)},l,l.exports,e,t,a,n)}return a[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,t,a){var n,o=e("./ui"),i=e("./modules/initDOM"),s=e("./modules/packUtil/packLoader"),r=e("./modules/packUtil/packManager"),d=e("./modules/event"),c=e("./modules/stage"),l=e("./modules/model/stageEffectsModel"),u=e("./modules/model/stageItemsModel"),f=e("./modules/data"),m=e("./modules/makePrefabDataUrls"),g=e("./modules/tray"),p=e("./modules/classes/prefab"),h=e("./modules/classes/vector2"),v=e("./modules/classes/rect"),k=e("./modules/canvas"),y=e("./modules/editBlock"),b=e("./modules/ui/focusGuide");!function(e){function t(){f.data.dataInit()}t(),i["default"](function(){o.setupCanvas(),s["default"](f.data.defaultPackName).then(function(e){f.data.pack=new r.packModule(e),d.raiseEvent("packLoaded",null),l.stageEffects.skyboxes=[f.data.pack.editor.defaultSkybox],o.setSkybox(r.getPackPath(f.data.defaultPackName)+f.data.pack.skyboxes.get(f.data.pack.editor.defaultSkybox).data.filename),d.raiseEvent("initedPack",null),d.raiseEvent("initedUI",null),o.initTrayBlock().then(function(){o.initTrayObj().then(function(){d.raiseEvent("initedTray",null)})})}),d.addEventListener("initedTray",function(){o.changeLoadingStatus("making DataURL"),f.data.trayItemDataURLs=m["default"]();var e=f.data.pack.blocks.get(f.data.pack.editor.defaultBlock);g.updateActiveBlock(f.data.pack.editor.defaultBlock,e.data.filename,e.data.bName),o.changeLoadingStatus("Are you ready?"),d.raiseEvent("ready",null)}),d.addEventListener("ready",function(){o.hideLoading()}),d.addEventListener("gridCanvas",function(e){var t=new p["default"](e.gridPos.x,e.gridPos.y,f.data.selectBlock.fileName,f.data.selectBlock.blockName,c.toGridPos(f.data.selectBlock.width),c.toGridPos(f.data.selectBlock.height)),a=c.getPrefabFromGrid(new h["default"](t.gridX,t.gridY),f.data.activeStageLayer),n=c.toDrawRect(new v["default"](t.gridX,t.gridY,t.gridW,t.gridH));switch(b.hide(),f.data.activeToolName){case"pencil":"down"===e.eventName?a.contains?(u.remove(a.id,f.data.activeStageLayer),c.renderStage(f.data.activeStageLayer)):(k.render(f.data.selectImage,n),u.push(u.getId(),t,f.data.activeStageLayer)):"hovering"===e.eventName&&b.focus(new h["default"](n.x,n.y),new h["default"](n.width,n.height),a.contains?"rgba(240,0,0,0.6)":"rgba(0,240,0,0.6)");break;case"choice":if("down"===e.eventName&&a.prefab){if(f.data.pack.objs.contains(a.prefab.blockName)){var i=f.data.pack.objs.get(a.prefab.blockName);g.updateActiveBlock(a.prefab.blockName,i.data.oName,r.getPackPath(f.data.defaultPackName)+i.data.filename,i.data.width,i.data.height)}else{var s=f.data.pack.blocks.get(a.prefab.blockName);g.updateActiveBlock(a.prefab.blockName,s.data.bName,r.getPackPath(f.data.defaultPackName)+s.data.filename)}o.changeActiveBlock(a.prefab.blockName)}break;case"hand":"move"===e.eventName&&(c.scrollX+=e.mousePos.x-c.scrollBeforeX,c.scrollY+=e.mousePos.y-c.scrollBeforeY,c.renderStage(f.data.activeStageLayer)),c.scrollBeforeX=e.mousePos.x,c.scrollBeforeY=e.mousePos.y;break;case"edit":"down"===e.eventName&&a.contains&&(o.showInspector("edit-block"),f.data.editingBlockId=a.id,y.updateEditBlock(new y.EditBlock(a.prefab.blockName,new h["default"](a.prefab.gridX,a.prefab.gridY),a.id)));break;default:("move"===e.eventName||"down"===e.eventName)&&("brush"===f.data.activeToolName?(a.contains&&a.prefab.blockName!==f.data.selectBlock.blockName&&(u.remove(a.id,f.data.activeStageLayer),c.renderStage(f.data.activeStageLayer)),a.contains||(k.render(f.data.selectImage,n),u.push(u.getId(),t,f.data.activeStageLayer))):"erase"===f.data.activeToolName&&a.contains&&(u.remove(a.id,f.data.activeStageLayer),c.renderStage(f.data.activeStageLayer)))}})})}(n||(n={})),t.exports=n},{"./modules/canvas":2,"./modules/classes/prefab":4,"./modules/classes/rect":5,"./modules/classes/vector2":7,"./modules/data":8,"./modules/editBlock":9,"./modules/event":12,"./modules/initDOM":14,"./modules/makePrefabDataUrls":16,"./modules/model/stageEffectsModel":18,"./modules/model/stageItemsModel":19,"./modules/packUtil/packLoader":20,"./modules/packUtil/packManager":21,"./modules/stage":23,"./modules/tray":24,"./modules/ui/focusGuide":26,"./ui":29}],2:[function(e,t,a){function n(){r.width=window.innerWidth,r.height=window.innerHeight,a.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight}}function o(e,t){d.drawImage(e,t.x,t.y,t.width,t.height)}function i(e){d.clearRect(e.x,e.y,e.width,e.height)}function s(){d.clearRect(0,0,r.width,r.height)}var r,d,c=e("./initDOM");c["default"](function(){r=document.getElementById("pla-canvas"),a.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight},n(),r&&r.getContext&&(d=r.getContext("2d"),d.imageSmoothingEnabled=!1,d.mozImageSmoothingEnabled=!1,d.webkitImageSmoothingEnabled=!1,d.msImageSmoothingEnabled=!1)}),window.addEventListener("resize",n),a.render=o,a.clearByRect=i,a.clear=s},{"./initDOM":14}],3:[function(e,t,a){var n=function(){function e(){this.data={}}return e.prototype.push=function(e,t){this.data[e]=t},e.prototype.update=function(e,t){this.data[e]=t},e.prototype.get=function(e){return this.data[e]},e.prototype.getAll=function(){return this.data},e.prototype.remove=function(e){delete this.data[e]},e.prototype.clear=function(){this.data={}},e.prototype.contains=function(e){return this.data.hasOwnProperty(e)},e.prototype.toSimple=function(){return this.data},e}();Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{}],4:[function(e,t,a){var n=function(){function e(e,t,a,n,o,i){this.gridX=e,this.gridY=t,this.fileName=a,this.blockName=n,this.gridW=o,this.gridH=i}return e}();Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{}],5:[function(e,t,a){var n=function(){function e(e,t,a,n){this.x=e,this.y=t,this.width=a,this.height=n}return e}();Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{}],6:[function(e,t,a){var n=function(){function e(e,t,a,n,o){this.blockName=e,this.fileName=t,this.label=a,this.width=n,this.height=o}return e}();Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{}],7:[function(e,t,a){var n=function(){function e(e,t){this.x=e,this.y=t}return Object.defineProperty(e,"zero",{get:function(){return new e(0,0)},enumerable:!0,configurable:!0}),e}();Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{}],8:[function(e,t,a){var n=e("./classes/list"),o=function(){function e(){}return e.dataInit=function(){this.trayItemDataURLs=new n["default"],this.defaultPackName="oa",this.defaultGridSize=25,this.defaultBlockSize=50,this.activeToolName="pencil",this.isObjMode=!1,this.isFullscreenTray=!1,this.isShowInspector=!1,this.activeStageLayer=0},e}();a.data=o},{"./classes/list":3}],9:[function(e,t,a){function n(e){m=e,i()}function o(){return m}function i(){if(document.getElementById("ed-name").textContent="Name: "+m.blockName,document.getElementById("ed-pos").textContent="Pos: "+m.blockPos.x+", "+m.blockPos.y,document.getElementById("ed-id").textContent="ID: "+m.blockId,document.getElementsByClassName("ed-attr-view")[0].innerHTML="",u.containsBlock(l.data.editingBlockId)){var e=u.getBlock(l.data.editingBlockId);Object.keys(e).forEach(function(e){var t=u.getAttr(l.data.editingBlockId,parseInt(e));s(parseInt(e),t.attrName,t.attrVal)})}}function s(e,t,a){var n=document.createElement("section");n.id="ed-attr-field-"+e;var o=document.createElement("input");o.type="text",o.id="ed-attr-name-"+e,o.classList.add("ed-attr-name"),o.placeholder="name","undefined"!=typeof t&&(o.value=t),o.addEventListener("keydown",d);var i=document.createElement("input");i.type="text",i.id="ed-attr-"+e,i.classList.add("ed-attr-val"),i.placeholder="value","undefined"!=typeof a&&(i.value=a),i.addEventListener("keydown",r);var s=document.createElement("button");s.innerHTML='<i class="fa fa-minus"></i>',s.classList.add("pla-btn"),s.id="ed-attr-remove-"+e,s.addEventListener("click",c),n.appendChild(s),n.appendChild(o),n.appendChild(document.createTextNode(":")),n.appendChild(i),document.getElementsByClassName("ed-attr-view")[0].appendChild(n)}function r(e){console.log("hg!!"),u.update(l.data.editingBlockId,parseInt(e.target.id.replace("ed-attr-","")),{attrVal:e.target.value})}function d(e){u.update(l.data.editingBlockId,parseInt(e.target.id.replace("ed-attr-name-","")),{attrName:e.target.value})}function c(e){var t=parseInt(e.target.id.replace("ed-attr-remove-",""));u.removeAttr(l.data.editingBlockId,t),document.getElementsByClassName("ed-attr-view")[0].removeChild(document.getElementById("ed-attr-field-"+t))}var l=e("./data"),u=e("./model/stageAttrsModel"),f=function(){function e(e,t,a){this.blockName=e,this.blockPos=t,this.blockId=a}return e}();a.EditBlock=f;var m;a.updateEditBlock=n,a.getCurrentEditBlock=o,a.updateEditBlockUI=i,a.renderAttributeUI=s,a.changeAttrVal=r,a.changeAttrName=d,a.clickRemoveAttr=c},{"./data":8,"./model/stageAttrsModel":17}],10:[function(e,t,a){function n(e,t,a){o(e,function(e){e.addEventListener(t,a)})}function o(e,t){Array.prototype.forEach.call(document.querySelectorAll(e),t)}a.addEventListenerforQuery=n,a.forEachforQuery=o},{}],11:[function(e,t,a){function n(e){o.forEachforQuery(".ev-btn",function(t){t.addEventListener("click",e[t.dataset.listener])}),o.forEachforQuery(".ev-input",function(t){var a=t;"undefined"!=typeof a.dataset["default"]&&(a.value=a.dataset["default"]),"undefined"!=typeof a.dataset.change&&a.addEventListener("change",e[a.dataset.change])})}var o=e("./elem");Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{"./elem":10}],12:[function(e,t,a){function n(e,t){-1!==e.indexOf("|")?e.split("|").forEach(function(e){n(e,t)}):s.contains(e)?s.get(e).push(t):s.push(e,[t])}function o(e,t){s.contains(e)&&s.get(e).forEach(function(a){a(t,e)})}var i=e("./classes/list"),s=new i["default"];a.addEventListener=n,a.raiseEvent=o},{"./classes/list":3}],13:[function(e,t,a){function n(e,t,a){var o=new Image;if(o.src=e,t){var i,s,r=(o.width+a.x)/2,d=(o.height+a.y)/2;return i=document.createElement("canvas"),i.width=r,i.height=d,s=i.getContext("2d"),s.drawImage(o,0,0,r,d),n(i.toDataURL("image/png"))}return o}Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{}],14:[function(e,t,a){function n(e){o.push(e)}var o=new Array;Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n,document.addEventListener("DOMContentLoaded",function(){o.forEach(function(e){e()})})},{}],15:[function(e,t,a){var n=e("./version"),o=function(){function e(e,t,a,n,o){this.blockName=e,this.posX=t,this.posY=a,this.name=n,this.attr=o}return e.prototype.toArray=function(){var e=[this.blockName,this.posX,this.posY];return"undefined"!=typeof this.name?e.push(this.name):e.push(""),"undefined"!=typeof this.attr&&e.push(this.attr),e},e.fromArray=function(t){var a=new e(t[0],t[1],t[2],t[3]);return"undefined"!=typeof t[4]&&(a.attr=t[4]),a},e}();a.jsonBlockItem=o;var i=function(){function e(e,t,a){void 0===t&&(t=[]),void 0===a&&(a=[]),this.jsonPlanetVersion=e,this.stage=t,this.skyboxes=a}return e.prototype.exportJson=function(){var e={};e.jsonPlanetVersion=this.jsonPlanetVersion,this.skyboxes!==[]&&(e.skyboxes=this.skyboxes),e.stage=[];for(var t=0;t<this.stage.length;t++)e.stage[t]=[],this.stage[t].forEach(function(a){e.stage[t].push(a.toArray())});return e},e.importJson=function(t){for(var a=new e(t.jsonPlanetVersion||n.jsonPlanetVersion),i=t.stage,s=0;s<i.length;s++)a.stage[s]=[],i[s].forEach(function(e){a.stage[s].push(o.fromArray(e))});var r=t.skyboxes,d=0;return r.forEach(function(e){a.skyboxes[d++]=e}),a},e.fromCSV=function(t){var a=new e(n.jsonPlanetVersion,[[]]),i=t.split("\n");return i.forEach(function(e){if(""!==e&&"*"!==e.substring(0,1)&&"//"!==e.substring(0,2)){var t=e.split("="),n=t[0].split(",");a.stage[0].push(new o(n[0],parseInt(n[1]),parseInt(n[2]),t[1]))}}),a},e}();a.jsonPlanet=i},{"./version":28}],16:[function(e,t,a){function n(){var e=new i["default"],t=o.data.pack.blocks.getAll();Object.keys(t).forEach(function(t){e.push(t,d["default"](s.getPackPath(o.data.defaultPackName)+o.data.pack.blocks.get(t).data.filename,!0,new r["default"](o.data.defaultGridSize,o.data.defaultGridSize)).src)});var a=o.data.pack.objs.getAll();return Object.keys(a).forEach(function(t){var a=o.data.pack.objs.get(t).data;e.push(t,d["default"](s.getPackPath(o.data.defaultPackName)+a.filename,!0,new r["default"](a.width,a.height)).src)}),e}var o=e("./data"),i=e("./classes/list"),s=e("./packUtil/packManager"),r=e("./classes/vector2"),d=e("./image");Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{"./classes/list":3,"./classes/vector2":7,"./data":8,"./image":13,"./packUtil/packManager":21}],17:[function(e,t,a){function n(e){v=e}function o(e,t,a){"undefined"==typeof v[e]&&(v[e]={}),v[e][t]=a}function i(e,t,a){if(a instanceof h)v[e][t]=a;else{var n=v[e][t];"undefined"!=typeof a.attrName&&(n.attrName=a.attrName),"undefined"!=typeof a.attrVal&&(n.attrVal=a.attrVal),v[e][t]=n}}function s(e,t){return"undefined"==typeof v[e]?!1:"undefined"!=typeof v[e][t]}function r(e){return"undefined"!=typeof v[e]}function d(e,t){delete v[e][t]}function c(e){delete v[e]}function l(e){return v[e]}function u(e,t){return v[e][t]}function f(){return v}function m(){v={}}function g(e){return"undefined"==typeof v[e]?0:Object.keys(v[e]).length}function p(){v={}}var h=function(){function e(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this.attrName=e,this.attrVal=t}return e}();a.Attr=h;var v;a.setAll=n,a.push=o,a.update=i,a.containsAttr=s,a.containsBlock=r,a.removeAttr=d,a.removeBlock=c,a.getBlock=l,a.getAttr=u,a.getAll=f,a.clear=m,a.getMaxAttrId=g,a.init=p},{}],18:[function(e,t,a){function n(e){a.stageEffects=e}var o=function(){function e(){this.skyboxes=[""]}return e}();a.StageEffects=o,a.stageEffects=new o,a.setStageEffects=n},{}],19:[function(e,t,a){function n(e,t,a){void 0===a&&(a=0),p[e]=t,c(a,e)}function o(){return p}function i(e,t){h[t].splice(h[t].indexOf(e),1),delete p[e]}function s(){p={}}function r(e){return p[e]}function d(e){var t=l(e),a=new v["default"];return t.forEach(function(e){a.push(e.toString(),r(e))}),a}function c(e,t){"undefined"==typeof h[e]&&(h[e]=[]),h[e].push(t)}function l(e){return"undefined"==typeof h[e]&&(h[e]=[]),h[e]}function u(){return h}function f(){return k++}function m(){k=0}function g(){p={},h=new Array,k=0}var p,h,v=e("./../classes/list");a.push=n,a.all=o,a.remove=i,a.clear=s,a.get=r,a.getLayerItems=d,a.pushStageLayer=c,a.getLayerIds=l,a.getAllLayer=u;var k;a.getId=f,a.resetId=m,a.init=g},{"./../classes/list":3}],20:[function(e,t,a){function n(e){return new Promise(function(t){var a=new XMLHttpRequest;a.open("GET",o.getPackPath(e)+"packinfo.json"),a.onreadystatechange=function(){4===a.readyState&&200===a.status&&t(JSON.parse(a.responseText))},a.send(null)})}var o=e("./../packUtil/packManager");Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{"./../packUtil/packManager":21}],21:[function(e,t,a){function n(e){return"pack/"+e+"/"}var o=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)},i=e("./../classes/list");a.getPackPath=n;var s=function(){function e(e){var t=this;this.pack=new d(e.pack),this.blocks=new i["default"],Object.keys(e.blocks).forEach(function(a){t.blocks.push(a,new l({bName:e.blocks[a].name,filename:e.blocks[a].filename}))}),this.objs=new i["default"],Object.keys(e.objs).forEach(function(a){var n=e.objs[a];n.hidden?t.objs.push(a,new u({oName:n.name,filename:n.filename,width:n.width,height:n.height,type:n.type})):t.objs.push(a,new u({oName:n.name,filename:n.filename,width:n.width,height:n.height,type:n.type,hidden:n.hidden}))}),this.descriptions=new i["default"],Object.keys(e.descriptions).forEach(function(a){var n=e.descriptions[a];t.descriptions.push(a,new f(n))}),this.skyboxes=new g,Object.keys(e.skyboxes).forEach(function(a){t.skyboxes.push(a,new m(e.skyboxes[a]))}),this.editor=e.editor}return e}();a.packModule=s;var r=function(){function e(e,t,a,n){this.defaultSkybox=e,this.defaultBlock=t,this.skyboxMode=a,this.skyboxSize=n}return e}();a.packEditorInfo=r;var d=function(){function e(e){this.pName=e.name,this.version=e.version,this.author=e.author,this.exportType=e.exportType}return e}();a.packInfo=d;var c=function(){function e(e){this.data=e}return e}();a.packItem=c;var l=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(c);a.blockInfo=l;var u=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(c);a.objInfo=u;var f=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(c);a.desInfo=f;var m=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(c);a.skyboxInfo=m;var g=function(e){function t(){e.call(this)}return o(t,e),t.prototype.toSimple=function(){var e=this,t={};return Object.keys(this.getAll()).forEach(function(a){t[e.get(a).data.label]=a}),t},t}(i["default"]);a.skyboxInfoList=g},{"./../classes/list":3}],22:[function(e,t,a){function n(){var e=new u.jsonPlanet(f.jsonPlanetVersion);Object.keys(s.stageEffects.skyboxes).forEach(function(t){e.skyboxes.push(s.stageEffects.skyboxes[parseInt(t)])});for(var t=r.getAllLayer(),a=0;a<t.length;a++)e.stage[a]=[],t[a].forEach(function(t){var n=r.get(t);if(d.containsBlock(t)){var o={},i=d.getBlock(t);Object.keys(i).forEach(function(e){o[i[parseInt(e)].attrName]=i[parseInt(e)].attrVal}),e.stage[a].push(new u.jsonBlockItem(n.blockName,n.gridX,n.gridY,t.toString(),o))}else e.stage[a].push(new u.jsonBlockItem(n.blockName,n.gridX,n.gridY,t.toString()))});return e}function o(e){r.clear(),d.clear(),r.resetId();for(var t=0;t<e.stage.length;t++)e.stage[t].forEach(function(e){var a=r.getId();if(l.data.pack.objs.contains(e.blockName)){var n=l.data.pack.objs.get(e.blockName);r.push(a,new c["default"](e.posX,e.posY,n.data.filename,e.blockName,i.toGridPos(n.data.width),i.toGridPos(n.data.height)),t)}else{var o=l.data.pack.blocks.get(e.blockName);r.push(a,new c["default"](e.posX,e.posY,o.data.filename,e.blockName,i.toGridPos(l.data.defaultBlockSize),i.toGridPos(l.data.defaultBlockSize)),t)}"undefined"!=typeof e.attr&&Object.keys(e.attr).forEach(function(t){d.push(a,d.getMaxAttrId(a),new d.Attr(t,e.attr[t]))})});l.data.activeStageLayer=0;var a=new s.StageEffects;return a.skyboxes=e.skyboxes,a}var i=e("./stage"),s=e("./model/stageEffectsModel"),r=e("./model/stageItemsModel"),d=e("./model/stageAttrsModel"),c=e("./classes/prefab"),l=e("./data"),u=e("./jsonPlanet"),f=e("./version");a.toJsonPlanet=n,a.fromJsonPlanet=o},{"./classes/prefab":4,"./data":8,"./jsonPlanet":15,"./model/stageAttrsModel":17,"./model/stageEffectsModel":18,"./model/stageItemsModel":19,"./stage":23,"./version":28}],23:[function(e,t,a){var n,o=e("./canvas"),i=e("./image"),s=e("./data"),r=e("./classes/rect"),d=e("./event"),c=e("./classes/vector2"),l=e("./model/stageAttrsModel"),u=e("./model/stageItemsModel");!function(e){function t(e){s.data.activeStageLayer=e,n(e)}function a(){u.init(),l.init()}function n(t){void 0===t&&(t=0),o.clear();var a=u.getLayerItems(t).getAll();Object.keys(a).forEach(function(t){var a=u.get(parseInt(t)),n=e.scrollX+e.getMousePosFromCenterAndSize(e.toMousePos(a.gridX),e.toMousePos(a.gridW)),d=e.scrollY+e.getMousePosFromCenterAndSize(e.toMousePos(a.gridY),e.toMousePos(a.gridH)),c=e.toMousePos(a.gridW),l=e.toMousePos(a.gridH);n+c>=0&&n<=o.canvasRect.width&&d+l>=0&&d<=o.canvasRect.height&&o.render(i["default"](s.data.trayItemDataURLs.get(a.blockName)),new r["default"](n,d,c,l))})}function f(e,t){return e-(t-s.data.defaultGridSize)/2}function m(t){var a=t.x-e.scrollX,n=t.y-e.scrollY,o=a-a%s.data.defaultGridSize,i=n-n%s.data.defaultGridSize,r=o/s.data.defaultGridSize,d=i/s.data.defaultGridSize;return new c["default"](r,d)}function g(e,t){var a=new E(!1,-1,null),n={};try{Object.keys(u.getLayerItems(t).getAll()).forEach(function(t){var o=u.get(parseInt(t));if(e.x>=o.gridX&&e.x<o.gridX+o.gridW&&e.y>=o.gridY&&e.y<o.gridY+o.gridH)throw a=new E(!0,parseInt(t),o),n})}catch(o){if(o!==n)throw o}return a}function p(e){return e*s.data.defaultGridSize}function h(e){return(e-e%s.data.defaultGridSize)/s.data.defaultGridSize}function v(t){return new r["default"](e.scrollX+f(p(t.x),p(t.width)),e.scrollY+f(p(t.y),p(t.height)),p(t.width),p(t.height))}e.changeActiveStageLayer=t,a(),e.renderStage=n;var k,y=!1;d.addEventListener("resize",function(){y&&clearTimeout(k),y=!0,k=setTimeout(function(){y=!1,n(s.data.activeStageLayer)},100)});var b=function(){function e(e,t,a){this.gridPos=e,this.eventName=t,this.mousePos=a}return e}();e.gridDetail=b,e.getMousePosFromCenterAndSize=f,e.scrollX=0,e.scrollY=0,e.scrollBeforeX=0,e.scrollBeforeY=0,e.getGridPosFromMousePos=m;var E=function(){function e(e,t,a){this.contains=e,this.id=t,this.prefab=a}return e}();e.getPrefabFromGridDetails=E,e.getPrefabFromGrid=g,e.toMousePos=p,e.toGridPos=h,e.toDrawRect=v}(n||(n={})),t.exports=n},{"./canvas":2,"./classes/rect":5,"./classes/vector2":7,"./data":8,"./event":12,"./image":13,"./model/stageAttrsModel":17,"./model/stageItemsModel":19}],24:[function(e,t,a){function n(e,t,a,n,i){var s=n||c.data.defaultBlockSize,r=i||c.data.defaultBlockSize;c.data.selectBlock=new d["default"](e,t,a,s,r),o()}function o(){c.data.selectImage=r["default"](c.data.trayItemDataURLs.get(c.data.selectBlock.blockName))}function i(e){return new Promise(function(t){var a=Object.keys(c.data.pack.blocks.getAll()),n=[],o=function(i){var s=a[i],r=document.createElement("div");r.classList.add("tray-list","tray-list-block"),r.addEventListener("mousedown",function(e){l.raiseEvent("ui_clickTray",e)});var d=document.createElement("img");d.src=u.getPackPath(c.data.defaultPackName)+c.data.pack.blocks.get(s).data.filename,d.onload=function(){d.alt=c.data.pack.blocks.get(s).data.bName,d.dataset.block=s,r.appendChild(d),n.push(r),i===a.length-1?t(n):(e(i,a.length-1),o(i+1))}};o(0)})}function s(e){return new Promise(function(t){var a=Object.keys(c.data.pack.objs.getAll()),n=[],o=function(i){var s=a[i],r=document.createElement("div");r.classList.add("tray-list","tray-list-obj"),r.addEventListener("click",function(e){l.raiseEvent("ui_clickTray",e)});var d=document.createElement("img");d.src=u.getPackPath(c.data.defaultPackName)+c.data.pack.objs.get(s).data.filename,d.onload=function(){d.alt=c.data.pack.objs.get(s).data.oName,d.dataset.block=s,r.style.width=d.style.width=c.data.pack.objs.get(s).data.width/(c.data.pack.objs.get(s).data.height/50)+"px",r.style.height=d.style.height="50px",r.appendChild(d),n.push(r),i===a.length-1?t(n):(e(i,a.length-1),o(i+1))}};o(0)})}var r=e("./image"),d=e("./classes/trayBlockDetails"),c=e("./data"),l=e("./event"),u=e("./packUtil/packManager");a.updateActiveBlock=n,a.updateSelectImage=o,a.initTrayBlock=i,a.initTrayObj=s},{"./classes/trayBlockDetails":6,"./data":8,"./event":12,"./image":13,"./packUtil/packManager":21}],25:[function(e,t,a){function n(){move(".pla-footer").set("height","100%").duration("0.5s").end()}function o(){move(".pla-footer").set("height","50px").duration("0.5s").end()}function i(){move(".pla-inspector").set("left","80%").duration("0.5s").end()}function s(){move(".pla-inspector").set("left","100%").duration("0.5s").end()}function r(){move(".loading").set("opacity",0).duration("1s").then().set("display","none").pop().end()}a.showTrayFull=n,a.hideTrayFull=o,a.showInspector=i,a.hideInspector=s,a.hideLoading=r},{}],26:[function(e,t,a){function n(e,t,a){i.style.visibility="visible",i.style.left=e.x+"px",i.style.top=e.y+"px",i.style.width=t.x+"px",i.style.height=t.y+"px",i.style.backgroundColor=a}function o(){i.style.visibility="hidden"}var i,s=e("./../initDOM");s["default"](function(){i=document.createElement("div"),i.id="guide",i.style.position="fixed",i.style.backgroundColor="rgba(240,0,0,0.6)",i.style.pointerEvents="none",document.body.appendChild(i)}),a.focus=n,a.hide=o},{"./../initDOM":14}],27:[function(e,t,a){function n(e){var t=[];return Object.keys(e).forEach(function(a){e[a].constructor==={}.constructor?(t.push('<optgroup label="'+a+'">'),t.push(n(e[a])),t.push("</optgroup>")):t.push('<option value="'+e[a]+'">'+a+"</option>")}),t.join("\n")}Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{}],28:[function(e,t,a){a.version="v1.0",a.author="shundroid",a.jsonPlanetVersion=.1},{}],29:[function(e,t,a){var n,o=e("./modules/data"),i=e("./modules/initDOM"),s=e("./modules/event"),r=e("./modules/elem"),d=e("./modules/util"),c=e("./modules/classes/vector2"),l=e("./modules/tray"),u=e("./modules/packUtil/packManager"),f=e("./modules/planet"),m=e("./modules/stage"),g=e("./modules/model/stageEffectsModel"),p=e("./modules/model/stageAttrsModel"),h=e("./modules/version"),v=e("./modules/evElems"),k=e("./modules/ui/anim"),y=e("./modules/editBlock"),b=e("./modules/jsonPlanet");!function(e){function t(){window.addEventListener("resize",function(){s.raiseEvent("resize",null)}),s.addEventListener("ui_clickTray",function(e){var t=e.target;if(o.data.isObjMode=t.parentElement.classList.contains("tray-list-obj"),o.data.isObjMode){var a=o.data.pack.objs.get(t.dataset.block).data;l.updateActiveBlock(t.dataset.block,a.filename,a.oName,a.width,a.height)}else{var a=o.data.pack.blocks.get(t.dataset.block).data;l.updateActiveBlock(t.dataset.block,a.filename,a.bName)}A(t.dataset.block)}),s.addEventListener("ui_downCanvas|ui_moveCanvas|ui_upCanvas|ui_hoveringCanvas",function(e,t){var a=m.getGridPosFromMousePos(new c["default"](e.clientX,e.clientY));s.raiseEvent("gridCanvas",new m.gridDetail(a,t.replace("ui_","").replace("Canvas",""),new c["default"](e.clientX,e.clientY)))}),s.addEventListener("initedPack",function(){"undefined"!=typeof o.data.pack.editor.skyboxMode&&"repeat"===o.data.pack.editor.skyboxMode&&(document.body.style.backgroundRepeat="repeat","undefined"!=typeof o.data.pack.editor.skyboxSize?document.body.style.backgroundSize=o.data.pack.editor.skyboxSize:document.body.style.backgroundSize="auto"),r.forEachforQuery(".pack-select",function(e){var t=e;t.innerHTML=d["default"](o.data.pack[t.dataset.items].toSimple())}),document.getElementById("stg-skybox").value=o.data.pack.editor.defaultSkybox})}function a(){e.canvas=document.getElementById("pla-canvas"),e.canvas.addEventListener("mousedown",function(e){s.raiseEvent("ui_downCanvas",e)}),e.canvas.addEventListener("mousemove",function(e){1===e.buttons?s.raiseEvent("ui_moveCanvas",e):s.raiseEvent("ui_hoveringCanvas",e)}),e.canvas.addEventListener("mouseup",function(e){s.raiseEvent("ui_upCanvas",e)})}function n(e){o.data.isFullscreenTray?(k.hideTrayFull(),e.target.textContent="↑"):(E(),k.showTrayFull(),e.target.textContent="↓"),o.data.isFullscreenTray=!o.data.isFullscreenTray}function E(){o.data.isShowInspector&&(o.data.isShowInspector=!1,k.hideInspector())}function w(e){document.querySelector(".ins-article-active")&&document.querySelector(".ins-article-active").classList.remove("ins-article-active"),document.getElementById("ins-"+e).classList.add("ins-article-active"),o.data.isShowInspector||(o.data.isShowInspector=!0,k.showInspector())}function P(){document.getElementById("pla-io").value=JSON.stringify(f.toJsonPlanet().exportJson())}function I(){var e=f.fromJsonPlanet(b.jsonPlanet.importJson(JSON.parse(document.getElementById("pla-io").value)));g.setStageEffects(e),L(u.getPackPath(o.data.defaultPackName)+o.data.pack.skyboxes.get(e.skyboxes[0]).data.filename),m.renderStage(0)}function S(e){w(e.target.dataset.ins)}function x(e){var t=e.target;return"I"===t.nodeName&&(t=t.parentElement),t.classList.contains("tool-btn")?void s.raiseEvent("clickTrayToolbtn",t.dataset.toolname):(document.getElementsByClassName("tool-active")[0].classList.remove("tool-active"),t.classList.add("tool-active"),void(o.data.activeToolName=t.dataset.toolname))}function L(e){document.body.style.backgroundImage="url('"+e+"')"}function N(){return new Promise(function(e){l.initTrayBlock(function(e,t){j("loading tray-block : "+e.toString()+" / "+t.toString())}).then(function(t){t.forEach(function(e){document.getElementsByClassName("tray-items")[0].appendChild(e)}),e()})})}function B(){return new Promise(function(e){l.initTrayObj(function(e,t){j("loading tray-obj : "+e.toString()+" / "+t.toString())}).then(function(t){t.forEach(function(e){document.getElementsByClassName("tray-items")[0].appendChild(e)}),e()})})}function j(e){document.getElementsByClassName("loading")[0].innerHTML="Loading...<br />"+e}function M(){k.hideLoading()}function A(e){document.querySelector(".tray-active")&&document.querySelector(".tray-active").classList.remove("tray-active"),document.querySelector('[data-block="'+e+'"]').classList.add("tray-active")}function O(){document.getElementById("conv-new").value=JSON.stringify(b.jsonPlanet.fromCSV(document.getElementById("conv-old").value).exportJson())}function C(e){g.stageEffects.skyboxes[o.data.activeStageLayer]=e.target.value,L(u.getPackPath(o.data.defaultPackName)+o.data.pack.skyboxes.get(g.stageEffects.skyboxes[o.data.activeStageLayer]).data.filename)}function T(){var e=p.getMaxAttrId(o.data.editingBlockId);p.push(o.data.editingBlockId,e,new p.Attr),y.renderAttributeUI(e)}function _(e){m.changeActiveStageLayer(parseInt(e.target.value)),"undefined"==typeof g.stageEffects.skyboxes[o.data.activeStageLayer]&&(g.stageEffects.skyboxes[o.data.activeStageLayer]=o.data.pack.editor.defaultSkybox),L(u.getPackPath(o.data.defaultPackName)+o.data.pack.skyboxes.get(g.stageEffects.skyboxes[o.data.activeStageLayer]).data.filename),document.getElementById("stg-skybox").value=g.stageEffects.skyboxes[o.data.activeStageLayer]}i["default"](function(){v["default"](e),document.getElementById("pla-ver").innerHTML="Planet "+h.version+" by "+h.author,r.addEventListenerforQuery(".ins-show-btn","click",S),r.addEventListenerforQuery(".tray-list-tool","mousedown",x);var t=document.createElement("script");t.src="bower_components/move.js/move.js",document.head.appendChild(t),window.onbeforeunload=function(e){e.returnValue="ページを移動しますか？"},s.raiseEvent("initDom",null)}),e.setupCanvas=a,e.togglefullScreen=n,e.closeInspector=E,e.showInspector=w,e.clickExport=P,e.clickImport=I,e.clickInsShowBtn=S,e.clickTrayTool=x,e.setSkybox=L,e.initTrayBlock=N,e.initTrayObj=B,e.changeLoadingStatus=j,e.hideLoading=M,e.changeActiveBlock=A,s.addEventListener("clickTrayToolbtn",function(t){var a={io:"io",setting:"inspector"};e.showInspector(a[t])}),e.clickConvertOldFile=O,e.changeSkybox=C,e.clickAddAttr=T,e.changeActiveStageLayer=_,t()}(n||(n={})),t.exports=n},{"./modules/classes/vector2":7,"./modules/data":8,"./modules/editBlock":9,"./modules/elem":10,"./modules/evElems":11,"./modules/event":12,"./modules/initDOM":14,"./modules/jsonPlanet":15,"./modules/model/stageAttrsModel":17,"./modules/model/stageEffectsModel":18,"./modules/packUtil/packManager":21,"./modules/planet":22,"./modules/stage":23,"./modules/tray":24,"./modules/ui/anim":25,"./modules/util":27,"./modules/version":28}]},{},[1]);