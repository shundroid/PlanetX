!function e(t,n,o){function a(r,s){if(!n[r]){if(!t[r]){var c="function"==typeof require&&require;if(!s&&c)return c(r,!0);if(i)return i(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[r]={exports:{}};t[r][0].call(l.exports,function(e){var n=t[r][1][e];return a(n?n:e)},l,l.exports,e,t,n,o)}return n[r].exports}for(var i="function"==typeof require&&require,r=0;r<o.length;r++)a(o[r]);return a}({1:[function(e,t,n){var o,a=e("./ui"),i=e("./modules/initDOM"),r=e("./modules/packUtil/packLoader"),s=e("./modules/packUtil/packManager"),c=e("./modules/event"),u=e("./modules/classes/list"),l=e("./modules/stage"),d=e("./modules/data"),f=e("./modules/makePrefabDataUrls"),p=e("./modules/tray"),m=e("./modules/prefab"),h=e("./modules/classes/vector2"),g=e("./modules/classes/rect"),v=e("./modules/canvas"),k=e("./modules/editBlock");!function(e){function t(){d.trayItemDataURLs=new u,d.defaultPackName="oa",d.defaultGridSize=25,d.defaultBlockSize=50,d.activeToolName="pencil",d.isObjMode=!1,d.isFullscreenTray=!1,d.isShowInspector=!1}t(),i(function(){a.setupCanvas(),r(d.defaultPackName).then(function(e){d.pack=new s.packModule(e),c.raiseEvent("packLoaded",null),l.stageEffects.skybox=d.pack.editor.defaultSkybox,a.setSkybox(s.getPackPath(d.defaultPackName)+d.pack.skyboxes.get(d.pack.editor.defaultSkybox).data.filename),c.raiseEvent("initedPack",null),c.raiseEvent("initedUI",null),a.initTrayBlock().then(function(){a.initTrayObj().then(function(){c.raiseEvent("initedTray",null)})})}),c.addEventListener("initedTray",function(){a.changeLoadingStatus("making DataURL"),d.trayItemDataURLs=f(),p.updateActiveBlock("w1/block2","pack/halstar/images/mapicons/w1block2-2.png","W1草付ブロック"),a.changeLoadingStatus("Are you ready?"),c.raiseEvent("ready",null)}),c.addEventListener("ready",function(){a.hideLoading()}),c.addEventListener("gridCanvas",function(e){var t=new m(e.gridPos.x,e.gridPos.y,d.selectBlock.fileName,d.selectBlock.blockName,l.toGridPos(d.selectBlock.width),l.toGridPos(d.selectBlock.height)),n=l.getPrefabFromGrid(new h(t.gridX,t.gridY)),o=l.toDrawRect(new g(t.gridX,t.gridY,t.gridW,t.gridH));switch(d.activeToolName){case"pencil":"mousedown"===e.eventName&&(n.contains?(l.items.remove(n.id),l.renderStage()):(v.render(d.selectImage,o),l.items.push(l.getId(),t)));break;case"choice":if("mousedown"===e.eventName&&n.prefab){if(d.pack.objs.contains(n.prefab.blockName)){var i=d.pack.objs.get(n.prefab.blockName);p.updateActiveBlock(n.prefab.blockName,i.data.oName,s.getPackPath(d.defaultPackName)+i.data.filename,i.data.width,i.data.height)}else{var r=d.pack.blocks.get(n.prefab.blockName);p.updateActiveBlock(n.prefab.blockName,r.data.bName,s.getPackPath(d.defaultPackName)+r.data.filename)}a.changeActiveBlock(n.prefab.blockName)}break;case"hand":"mousemove"===e.eventName&&(l.scrollX+=e.mousePos.x-l.scrollBeforeX,l.scrollY+=e.mousePos.y-l.scrollBeforeY,l.renderStage()),l.scrollBeforeX=e.mousePos.x,l.scrollBeforeY=e.mousePos.y;break;case"edit":"mousedown"===e.eventName&&n.contains&&(a.showInspector("edit-block"),d.editingBlockId=n.id,k.updateEditBlock(new k.EditBlock(n.prefab.blockName,new h(n.prefab.gridX,n.prefab.gridY),n.id)));break;default:("mousemove"===e.eventName||"mousedown"===e.eventName)&&("brush"===d.activeToolName?(n.contains&&n.prefab.blockName!==d.selectBlock.blockName&&(l.items.remove(n.id),l.renderStage()),n.contains||(v.render(d.selectImage,o),l.items.add(l.getId(),t))):"erase"===d.activeToolName&&n.contains&&(l.items.remove(n.id),l.renderStage()))}})})}(o||(o={})),t.exports=o},{"./modules/canvas":2,"./modules/classes/list":6,"./modules/classes/rect":8,"./modules/classes/vector2":10,"./modules/data":12,"./modules/editBlock":13,"./modules/event":16,"./modules/initDOM":19,"./modules/makePrefabDataUrls":20,"./modules/packUtil/packLoader":22,"./modules/packUtil/packManager":23,"./modules/prefab":25,"./modules/stage":26,"./modules/tray":27,"./ui":32}],2:[function(e,t,n){var o,a=e("./initDOM");!function(e){function t(){r.width=window.innerWidth,r.height=window.innerHeight,e.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight}}function n(e,t){s.drawImage(e,t.x,t.y,t.width,t.height)}function o(e){s.clearRect(e.x,e.y,e.width,e.height)}function i(){s.clearRect(0,0,r.width,r.height)}var r,s;a(function(){r=document.getElementById("pla-canvas"),e.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight},t(),r&&r.getContext&&(s=r.getContext("2d"))}),window.addEventListener("resize",t),e.render=n,e.clearByRect=o,e.clear=i}(o||(o={})),t.exports=o},{"./initDOM":19}],3:[function(e,t,n){var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},a=e("./../list"),i=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.toSimple=function(){var e=this,t=this.getAll(),n={};return Object.keys(t).forEach(function(t){n[e.get(t).label]=t}),n},t}(a);t.exports=i},{"./../list":6}],4:[function(e,t,n){var o=function(){function e(e,t,n,o){this.label=e,this.type=t,this.placeholder=n,this.defaultValue=o}return e}();t.exports=o},{}],5:[function(e,t,n){var o=function(){function e(e,t,n){this.blockId=e,this.attr=t,this.attrValue=n}return e}();t.exports=o},{}],6:[function(e,t,n){var o=function(){function e(){this.data={}}return e.prototype.push=function(e,t){this.data[e]=t},e.prototype.update=function(e,t){this.data[e]=t},e.prototype.get=function(e){return this.data[e]},e.prototype.getAll=function(){return this.data},e.prototype.remove=function(e){delete this.data[e]},e.prototype.clear=function(){this.data={}},e.prototype.contains=function(e){return this.data.hasOwnProperty(e)},e.prototype.toSimple=function(){return this.data},e}();t.exports=o},{}],7:[function(e,t,n){var o=function(){function e(e,t,n){this.x=e,this.y=t,this.blockName=n}return e}();t.exports=o},{}],8:[function(e,t,n){var o=function(){function e(e,t,n,o){this.x=e,this.y=t,this.width=n,this.height=o}return e}();t.exports=o},{}],9:[function(e,t,n){var o=function(){function e(e,t,n,o,a){this.blockName=e,this.fileName=t,this.label=n,this.width=o,this.height=a}return e}();t.exports=o},{}],10:[function(e,t,n){var o=function(){function e(e,t){this.x=e,this.y=t}return Object.defineProperty(e,"zero",{get:function(){return new e(0,0)},enumerable:!0,configurable:!0}),e}();t.exports=o},{}],11:[function(e,t,n){var o,a=e("./classes/list"),i=e("./classes/prefabMini"),r=e("./stage"),s=e("./data");!function(e){function t(e){switch(e){case"//:csv":return u.CSV}return u.unknown}function n(e,t){switch(e){case u.CSV:return o(t)}return null}function o(e){var t=e.replace(/;/g,"").split("\n"),n=new a,o=[],c=[],u=new r.StageEffects,d=0,f=new a,p=s.pack.attributes.getAll(),m=[];return Object.keys(p).forEach(function(e){var t=[];m.push(t.join(","))}),t.forEach(function(e){if(0===d)if("//:header"===e)d=1;else if("//:footer"===e)d=2;else{if(e=e.replace(/ /g,""),""===e)return;if("//"===e.substring(0,2))return;var t=e.split(",");if("*"===t[0].substring(0,1)){if("*skybox"===t[0])u.skybox=t[1];else if(-1!==Object.keys(s.pack.attributes.getAll()).indexOf(t[1])){var r;r=f.contains(t[2])?f.get(t[2]):new a,r.push(t[1],t[3]),f.push(t[2],r)}return}n.push(e,new i(parseInt(t[1]),parseInt(t[2]),t[0]))}else if(1===d){if("//:/header"===e)return void(d=0);o.push(e)}else if(2===d){if("//:/footer"===e)return void(d=0);c.push(e)}}),new l(n,o.join("\n"),c.join("\n"),u,f)}function c(e){var t=e.split("\n"),n=[],o=0,a=-1,i=0;return n.push("//:csv"),t.forEach(function(e){if(""!==e)if(-1===a)i++,5===i&&a++;else if(0===a)5===i&&"// stageCTRL::edit not_header"===e?a++:5===i?(n.push("//:header"),n.push(e),i++):"// stageCTRL::edit /header"===e?(n.push("//:/header"),a++):n.push(e);else if(1===a){if("// stageCTRL::edit footer"===e)return a++,void(i=10);if("// stageCTRL::edit not_footer"===e)return void(a+=2);if("*"===e.substring(0,1))return void(-1!==e.indexOf("*skybox,")?n.push(e):n.push(e));if(":"===e.substring(0,1))return;if(e=e.replace(/ /g,""),"//"===e.substring(0,2))return;e=e.split("=")[0];var t=e.split(",");t[2]=(-parseInt(t[2])).toString(),n.push([[t[0],t[1],t[2]].join(","),o++].join("="))}else 2===a&&(10===i?(i++,n.push("//:footer"),n.push(e)):"// stageCTRL::edit /footer"===e?(n.push("//:/footer"),a++):n.push(e))}),n.join("\n")}e.getLangAuto=t,function(e){e[e.CSV=0]="CSV",e[e.JsWithPla=1]="JsWithPla",e[e.yaml=2]="yaml",e[e.unknown=3]="unknown",e[e.auto=4]="auto"}(e.compileLangs||(e.compileLangs={}));var u=e.compileLangs,l=function(){function e(e,t,n,o,a){this.prefabList=e,this.header=t,this.footer=n,this.effects=o,this.attrList=a}return e}();e.centerLang=l,e.toCenterLang=n,e.CSV2CenterLang=o,e.old2CSV=c}(o||(o={})),t.exports=o},{"./classes/list":6,"./classes/prefabMini":7,"./data":12,"./stage":26}],12:[function(e,t,n){var o=function(){function e(){}return e}();t.exports=o},{}],13:[function(e,t,n){var o,a=e("./data"),i=e("./stage");!function(e){function t(e){l=e,o()}function n(){return l}function o(){if(document.getElementById("ed-name").textContent="Name: "+l.blockName,document.getElementById("ed-pos").textContent="Pos: "+l.blockPos.x+", "+l.blockPos.y,document.getElementById("ed-id").textContent="ID: "+l.blockId,document.getElementsByClassName("ed-attr-view")[0].innerHTML="",i.blockAttrs.containsBlock(a.editingBlockId)){var e=i.blockAttrs.getBlock(a.editingBlockId).getAll();Object.keys(e).forEach(function(e){r(e,i.blockAttrs.getAttr(a.editingBlockId,e))})}}function r(e,t){var n=a.pack.attributes.get(e),o=document.createElement("section");o.id="ed-attr-field-"+e;var i=document.createElement("input");i.type=n.type,i.id="ed-attr-"+e,"undefined"!=typeof n.placeholder&&(i.placeholder=n.placeholder),"undefined"!=typeof t?(console.log("hoge"),i.value=t):"undefined"!=typeof n.defaultValue?i.value=n.defaultValue:"number"===i.type&&(i.value="0"),i.addEventListener("change",s);var r=document.createElement("label");r.htmlFor=i.id,r.textContent=" "+n.label+": ";var u=document.createElement("button");u.innerHTML='<i class="fa fa-minus"></i>',u.classList.add("pla-btn"),u.id="ed-attr-remove-"+e,u.addEventListener("click",c),o.appendChild(u),o.appendChild(r),o.appendChild(i),document.getElementsByClassName("ed-attr-view")[0].appendChild(o)}function s(e){i.blockAttrs.update(a.editingBlockId,e.target.id.replace("ed-attr-",""),e.target.value)}function c(e){var t=e.target.id.replace("ed-attr-remove-","");i.blockAttrs.removeAttr(a.editingBlockId,t),document.getElementsByClassName("ed-attr-view")[0].removeChild(document.getElementById("ed-attr-field-"+t))}var u=function(){function e(e,t,n){this.blockName=e,this.blockPos=t,this.blockId=n}return e}();e.EditBlock=u;var l;e.updateEditBlock=t,e.getCurrentEditBlock=n,e.updateEditBlockUI=o,e.renderAttributeUI=r,e.changeAttrInput=s,e.clickRemoveAttr=c}(o||(o={})),t.exports=o},{"./data":12,"./stage":26}],14:[function(e,t,n){var o;!function(e){function t(e,t,o){n(e,function(e){e.addEventListener(t,o)})}function n(e,t){Array.prototype.forEach.call(document.querySelectorAll(e),t)}e.addEventListenerforQuery=t,e.forEachforQuery=n}(o||(o={})),t.exports=o},{}],15:[function(e,t,n){var o,a=e("./elem");!function(e){function t(e){a.forEachforQuery(".ev-btn",function(t){t.addEventListener("click",e[t.dataset.listener])}),a.forEachforQuery(".ev-input",function(e){var t=e;"undefined"!=typeof t.dataset["default"]&&(t.value=t.dataset["default"])})}e.set=t}(o||(o={})),t.exports=o},{"./elem":14}],16:[function(e,t,n){var o,a=e("./classes/list");!function(e){function t(e,n){-1!==e.indexOf("|")?e.split("|").forEach(function(e){t(e,n)}):o.contains(e)?o.get(e).push(n):o.push(e,[n])}function n(e,t){o.contains(e)&&o.get(e).forEach(function(e){e(t)})}var o=new a;e.addEventListener=t,e.raiseEvent=n}(o||(o={})),t.exports=o},{"./classes/list":6}],17:[function(e,t,n){function o(e,t,n){var a=new Image;if(a.src=e,t){var i,r,s=(a.width+n.x)/2,c=(a.height+n.y)/2;return i=document.createElement("canvas"),i.width=s,i.height=c,r=i.getContext("2d"),r.drawImage(a,0,0,s,c),o(i.toDataURL("image/png"))}return a}t.exports=o},{}],18:[function(e,t,n){function o(e){var t=document.createElement("script");return t.src=e,t}t.exports=o},{}],19:[function(e,t,n){function o(e){a.push(e)}var a=new Array;document.addEventListener("DOMContentLoaded",function(){a.forEach(function(e){e()})}),t.exports=o},{}],20:[function(e,t,n){function o(){var e=new i,t=a.pack.blocks.getAll();Object.keys(t).forEach(function(t){e.push(t,c(r.getPackPath(a.defaultPackName)+a.pack.blocks.get(t).data.filename,!0,new s(a.defaultGridSize,a.defaultGridSize)).src)});var n=a.pack.objs.getAll();return Object.keys(n).forEach(function(t){var n=a.pack.objs.get(t).data;e.push(t,c(r.getPackPath(a.defaultPackName)+n.filename,!0,new s(n.width,n.height)).src)}),e}var a=e("./data"),i=e("./classes/list"),r=e("./packUtil/packManager"),s=e("./classes/vector2"),c=e("./image");t.exports=o},{"./classes/list":6,"./classes/vector2":10,"./data":12,"./image":17,"./packUtil/packManager":23}],21:[function(e,t,n){},{}],22:[function(e,t,n){function o(e){return new Promise(function(t){var n=new XMLHttpRequest;n.open("GET",a.getPackPath(e)+"packinfo.json"),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&t(JSON.parse(n.responseText))},n.send(null)})}var a=e("./packManager");t.exports=o},{"./packManager":23}],23:[function(e,t,n){var o,a=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("./../classes/list"),r=e("./../classes/blockAttr/attrList");!function(e){function t(e){return"pack/"+e+"/"}e.getPackPath=t;var n=function(){function e(e){var t=this;this.pack=new s(e.pack),this.blocks=new i,Object.keys(e.blocks).forEach(function(n){t.blocks.push(n,new u({bName:e.blocks[n].name,filename:e.blocks[n].filename}))}),this.objs=new i,Object.keys(e.objs).forEach(function(n){var o=e.objs[n];o.hidden?t.objs.push(n,new l({oName:o.name,filename:o.filename,width:o.width,height:o.height,type:o.type})):t.objs.push(n,new l({oName:o.name,filename:o.filename,width:o.width,height:o.height,type:o.type,hidden:o.hidden}))}),this.descriptions=new i,Object.keys(e.descriptions).forEach(function(n){var o=e.descriptions[n];t.descriptions.push(n,new d(o))}),this.attributes=new r,Object.keys(e.attributes).forEach(function(n){var o=e.attributes[n];t.attributes.push(n,o)}),this.skyboxes=new p,Object.keys(e.skyboxes).forEach(function(n){t.skyboxes.push(n,new f(e.skyboxes[n]))}),this.editor=new o(e.editor.defaultSkybox)}return e}();e.packModule=n;var o=function(){function e(e,t){this.defaultSkybox=e,this.skyboxMode=t}return e}();e.packEditorInfo=o;var s=function(){function e(e){this.pName=e.name,this.version=e.version,this.author=e.author,this.exportType=e.exportType}return e}();e.packInfo=s;var c=function(){function e(e){this.data=e}return e}();e.packItem=c;var u=function(e){function t(){e.apply(this,arguments)}return a(t,e),t}(c);e.blockInfo=u;var l=function(e){function t(){e.apply(this,arguments)}return a(t,e),t}(c);e.objInfo=l;var d=function(e){function t(){e.apply(this,arguments)}return a(t,e),t}(c);e.desInfo=d;var f=function(e){function t(){e.apply(this,arguments)}return a(t,e),t}(c);e.skyboxInfo=f;var p=function(e){function t(){e.call(this)}return a(t,e),t.prototype.toSimple=function(){var e=this,t={};return Object.keys(this.getAll()).forEach(function(n){t[e.get(n).data.label]=n}),t},t}(i);e.skyboxInfoList=p}(o||(o={})),t.exports=o},{"./../classes/blockAttr/attrList":3,"./../classes/list":6}],24:[function(e,t,n){var o,a=e("./stage"),i=e("./prefab"),r=e("./compiler"),s=e("./data");!function(e){function t(){var e=[];if(e.push("//:csv"),""!==a.header.replace(/ /g,"").replace(/\n/g,"")){e.push("//:header");var t=a.header.split("\n");t.forEach(function(t){e.push(t)}),e.push("//:/header")}e.push(["*skybox",a.stageEffects.skybox].join(","));var n=a.items.getAll();Object.keys(n).forEach(function(t){var n=a.items.get(parseInt(t));e.push([[n.blockName,n.gridX,n.gridY].join(","),t].join("="))});var o=a.blockAttrs.getAll();if(o&&Object.keys(o).forEach(function(t){var n=a.blockAttrs.getBlock(parseInt(t)).getAll();Object.keys(n).forEach(function(n){e.push(["*custom",n,t,a.blockAttrs.getBlock(parseInt(t)).get(n)].join(","))})}),""!==a.footer.replace(/ /g,"").replace(/\n/g,"")){e.push("//:footer");var i=a.footer.split("\n");i.forEach(function(t){e.push(t)}),e.push("//:/footer")}return e.join("\n")}function n(e){a.items.clear(),a.resetId();var t=r.toCenterLang(r.getLangAuto(e.split("\n")[0]),e);a.header=t.header,a.footer=t.footer;var n=t.prefabList.getAll(),o=t.effects;return Object.keys(n).forEach(function(e){var n=t.prefabList.get(e);if(s.pack.objs.contains(n.blockName)){var o=s.pack.objs.get(n.blockName);a.items.push(a.getId(),new i(n.x,n.y,o.data.filename,n.blockName,a.toGridPos(o.data.width),a.toGridPos(o.data.height)))}else{var r=s.pack.blocks.get(n.blockName);a.items.push(a.getId(),new i(n.x,n.y,r.data.filename,n.blockName,a.toGridPos(s.defaultBlockSize),a.toGridPos(s.defaultBlockSize)))}}),a.blockAttrs.setAll(t.attrList),o}e.exportText=t,e.importText=n}(o||(o={})),t.exports=o},{"./compiler":11,"./data":12,"./prefab":25,"./stage":26}],25:[function(e,t,n){var o=function(){function e(e,t,n,o,a,i){this.gridX=e,this.gridY=t,this.fileName=n,this.blockName=o,this.gridW=a,this.gridH=i}return e}();t.exports=o},{}],26:[function(e,t,n){var o,a=e("./classes/list"),i=e("./canvas"),r=e("./image"),s=e("./data"),c=e("./classes/rect"),u=e("./event"),l=e("./classes/vector2");!function(e){function t(){w=new a,b=new a,e.header="",e.footer="",x=0}function n(){return x++}function o(){x=0}function d(){i.clear();var t=E.getAll();Object.keys(t).forEach(function(t){var n=E.get(parseInt(t)),o=e.scrollX+e.getMousePosFromCenterAndSize(e.toMousePos(n.gridX),e.toMousePos(n.gridW)),a=e.scrollY+e.getMousePosFromCenterAndSize(e.toMousePos(n.gridY),e.toMousePos(n.gridH)),u=e.toMousePos(n.gridW),l=e.toMousePos(n.gridH);o+u>=0&&o<=i.canvasRect.width&&a+l>=0&&a<=i.canvasRect.height&&i.render(r(s.trayItemDataURLs.get(n.blockName)),new c(o,a,u,l))})}function f(e,t){return e-(t-s.defaultGridSize)/2}function p(t){var n=t.x-e.scrollX,o=t.y-e.scrollY,a=n-n%s.defaultGridSize,i=o-o%s.defaultGridSize,r=a/s.defaultGridSize,c=i/s.defaultGridSize;return new l(r,c)}function m(e){var t=new B(!1,-1,null),n={};try{Object.keys(E.getAll()).forEach(function(o){var a=E.get(parseInt(o));if(e.x>=a.gridX&&e.x<a.gridX+a.gridW&&e.y>=a.gridY&&e.y<a.gridY+a.gridH)throw t=new B(!0,parseInt(o),a),n})}catch(o){if(o!==n)throw o}return t}function h(e){return e*s.defaultGridSize}function g(e){return(e-e%s.defaultGridSize)/s.defaultGridSize}function v(t){return new c(e.scrollX+f(h(t.x),h(t.width)),e.scrollY+f(h(t.y),h(t.height)),h(t.width),h(t.height))}var k=function(){function e(){this.skybox=""}return e}();e.StageEffects=k,e.stageEffects=new k;var b,y;!function(e){function t(e){b=e}function n(e,t,n){var o;o=r(e)?u(e):new a,o.push(t,n),b.push(e.toString(),o)}function o(e,t,n){var o=u(e);o.update(t,n),b.update(e.toString(),o)}function i(e,t){if(r(e)){var n=u(e);return n.contains(t)}return!1}function r(e){return b.contains(e.toString())}function s(e,t){var n=u(e);n.remove(t),b.update(e.toString(),n)}function c(e){b.remove(e.toString())}function u(e){return b.get(e.toString())}function l(e,t){return b.get(e.toString()).get(t)}function d(){var e=b.getAll(),t={};return Object.keys(e).forEach(function(e){t[e]=b.get(e).getAll()}),t}e.setAll=t,e.push=n,e.update=o,e.containsAttr=i,e.containsBlock=r,e.removeAttr=s,e.removeBlock=c,e.getBlock=u,e.getAttr=l,e.getAll=d}(y=e.blockAttrs||(e.blockAttrs={}));var w,E;!function(e){function t(e,t){n(e,t)}function n(e,t){w.push(e.toString(),t)}function o(){return w.getAll()}function a(e){return w.remove(e.toString())}function i(){w.clear()}function r(e){return w.get(e.toString())}e.add=t,e.push=n,e.getAll=o,e.remove=a,e.clear=i,e.get=r}(E=e.items||(e.items={}));var x;t(),e.getId=n,e.resetId=o,e.renderStage=d;var I,P=!1;u.addEventListener("resize",function(){P&&clearTimeout(I),P=!0,I=setTimeout(function(){P=!1,d()},100)});var S=function(){function e(e,t,n){this.gridPos=e,this.eventName=t,this.mousePos=n}return e}();e.gridDetail=S,e.getMousePosFromCenterAndSize=f,e.scrollX=0,e.scrollY=0,e.scrollBeforeX=0,e.scrollBeforeY=0,e.getGridPosFromMousePos=p;var B=function(){function e(e,t,n){this.contains=e,this.id=t,this.prefab=n}return e}();e.getPrefabFromGridDetails=B,e.getPrefabFromGrid=m,e.toMousePos=h,e.toGridPos=g,e.toDrawRect=v}(o||(o={})),t.exports=o},{"./canvas":2,"./classes/list":6,"./classes/rect":8,"./classes/vector2":10,"./data":12,"./event":16,"./image":17}],27:[function(e,t,n){var o,a=e("./image"),i=e("./classes/trayBlockDetails"),r=e("./data"),s=e("./uiWaitMode"),c=e("./event"),u=e("./packUtil/packManager");!function(e){function t(e,t,o,a,s){var c=a||r.defaultBlockSize,u=s||r.defaultBlockSize;r.selectBlock=new i(e,t,o,c,u),n()}function n(){r.selectImage=a(r.trayItemDataURLs.get(r.selectBlock.blockName)),s.start(),r.selectImage.onload=function(){s.end()}}function o(e){return new Promise(function(t){var n=Object.keys(r.pack.blocks.getAll()),o=[],a=function(i){var s=n[i],l=document.createElement("div");l.classList.add("tray-list","tray-list-block"),l.addEventListener("click",function(e){c.raiseEvent("ui_clickTray",e)});var d=document.createElement("img");d.src=u.getPackPath(r.defaultPackName)+r.pack.blocks.get(s).data.filename,d.onload=function(){d.alt=r.pack.blocks.get(s).data.bName,d.dataset.block=s,l.appendChild(d),o.push(l),i===n.length-1?t(o):(e(i,n.length-1),a(i+1))}};a(0)})}function l(e){return new Promise(function(t){var n=Object.keys(r.pack.objs.getAll()),o=[],a=function(i){var s=n[i],l=document.createElement("div");l.classList.add("tray-list","tray-list-obj"),l.addEventListener("click",function(e){c.raiseEvent("ui_clickTray",e)});var d=document.createElement("img");d.src=u.getPackPath(r.defaultPackName)+r.pack.objs.get(s).data.filename,d.onload=function(){d.alt=r.pack.objs.get(s).data.oName,d.dataset.block=s,l.style.width=d.style.width=r.pack.objs.get(s).data.width/(r.pack.objs.get(s).data.height/50)+"px",l.style.height=d.style.height="50px",l.appendChild(d),o.push(l),i===n.length-1?t(o):(e(i,n.length-1),a(i+1))}};a(0)})}e.updateActiveBlock=t,e.updateSelectImage=n,e.initTrayBlock=o,e.initTrayObj=l}(o||(o={})),t.exports=o},{"./classes/trayBlockDetails":9,"./data":12,"./event":16,"./image":17,"./packUtil/packManager":23,"./uiWaitMode":28}],28:[function(e,t,n){var o;!function(e){function t(){document.getElementById("pla-canvas").style.cursor="wait"}function n(){document.getElementById("pla-canvas").style.cursor="crosshair"}e.start=t,e.end=n}(o||(o={})),t.exports=o},{}],29:[function(e,t,n){var o;!function(e){function t(){move(".pla-footer").set("height","100%").duration("0.5s").end()}function n(){move(".pla-footer").set("height","50px").duration("0.5s").end()}function o(){move(".pla-inspector").set("left","80%").duration("0.5s").end()}function a(){move(".pla-inspector").set("left","100%").duration("0.5s").end()}function i(){move(".loading").set("opacity",0).duration("1s").then().set("display","none").pop().end()}e.showTrayFull=t,e.hideTrayFull=n,e.showInspector=o,e.hideInspector=a,e.hideLoading=i}(o||(o={})),t.exports=o},{}],30:[function(e,t,n){var o;!function(e){function t(e){var n=[];return Object.keys(e).forEach(function(o){e[o].constructor==={}.constructor?(n.push('<optgroup label="'+o+'">'),n.push(t(e[o])),n.push("</optgroup>")):n.push('<option value="'+e[o]+'">'+o+"</option>")}),n.join("\n")}e.obj2SelectElem=t}(o||(o={})),t.exports=o},{}],31:[function(e,t,n){var o;!function(e){e.version="v1.0",e.author="shundroid"}(o||(o={})),t.exports=o},{}],32:[function(e,t,n){var o,a=e("./modules/data"),i=e("./modules/initDOM"),r=e("./modules/event"),s=e("./modules/elem"),c=e("./modules/compiler"),u=e("./modules/importJS"),l=e("./modules/util"),d=e("./modules/classes/vector2"),f=e("./modules/tray"),p=e("./modules/packUtil/packManager"),m=e("./modules/planet"),h=e("./modules/stage"),g=e("./modules/version"),v=e("./modules/evElems"),k=e("./modules/ui/anim"),b=e("./modules/editBlock");!function(e){function t(){window.addEventListener("resize",function(){r.raiseEvent("resize",null)}),r.addEventListener("ui_clickTray",function(e){var t=e.target;if(a.isObjMode=t.parentElement.classList.contains("tray-list-obj"),a.isObjMode){var n=a.pack.objs.get(t.dataset.block).data;f.updateActiveBlock(t.dataset.block,n.filename,n.oName,n.width,n.height)}else{var n=a.pack.blocks.get(t.dataset.block).data;f.updateActiveBlock(t.dataset.block,n.filename,n.bName)}C(t.dataset.block)}),r.addEventListener("ui_mousedownCanvas|ui_mousemoveanddownCanvas|ui_mouseupCanvas",function(e){var t=h.getGridPosFromMousePos(new d(e.clientX,e.clientY));r.raiseEvent("gridCanvas",new h.gridDetail(t,e.type,new d(e.clientX,e.clientY)))}),r.addEventListener("initedPack",function(){console.log(a.pack.editor.skyboxMode),"undefined"!=typeof a.pack.editor.skyboxMode&&"repeat"===a.pack.editor.skyboxMode&&(document.body.style.backgroundRepeat="repeat",document.body.style.backgroundSize="auto"),s.forEachforQuery(".pack-select",function(t){var n=t;n.innerHTML=l.obj2SelectElem(a.pack[n.dataset.items].toSimple()),n.dataset.change&&n.addEventListener("change",e[n.dataset.change]),n.dataset["default"]&&(n.value=n.dataset["default"])}),document.getElementById("stg-skybox").value=a.pack.editor.defaultSkybox})}function n(){e.canvas=document.getElementById("pla-canvas"),e.canvas.addEventListener("mousedown",function(e){r.raiseEvent("ui_mousedownCanvas",e)}),e.canvas.addEventListener("mousemove",function(e){1===e.buttons&&r.raiseEvent("ui_mousemoveanddownCanvas",e)}),e.canvas.addEventListener("mouseup",function(e){r.raiseEvent("ui_mouseupCanvas",e)})}function o(e){console.log(a.isFullscreenTray),a.isFullscreenTray?(k.hideTrayFull(),e.target.textContent="↑"):(y(),k.showTrayFull(),e.target.textContent="↓"),a.isFullscreenTray=!a.isFullscreenTray}function y(){a.isShowInspector&&(a.isShowInspector=!1,k.hideInspector())}function w(e){document.querySelector(".ins-article-active")&&document.querySelector(".ins-article-active").classList.remove("ins-article-active"),document.getElementById("ins-"+e).classList.add("ins-article-active"),a.isShowInspector||(a.isShowInspector=!0,k.showInspector())}function E(){document.getElementById("pla-io").value=m.exportText()}function x(){var e=m.importText(document.getElementById("pla-io").value);h.stageEffects=e,B(p.getPackPath(a.defaultPackName)+a.pack.skyboxes.get(e.skybox).data.filename),h.renderStage()}function I(e){w(e.target.dataset.ins)}function P(e){var t=e.target;"io-header"===t.id?h.header=t.value:"io-footer"===t.id&&(h.footer=t.value)}function S(e){var t=e.target;return"I"===t.nodeName&&(t=t.parentElement),t.classList.contains("tool-btn")?void r.raiseEvent("clickTrayToolbtn",t.dataset.toolname):(document.getElementsByClassName("tool-active")[0].classList.remove("tool-active"),t.classList.add("tool-active"),void(a.activeToolName=t.dataset.toolname))}function B(e){document.body.style.backgroundImage="url('"+e+"')"}function L(){return new Promise(function(e){f.initTrayBlock(function(e,t){j("loading tray-block : "+e.toString()+" / "+t.toString())}).then(function(t){t.forEach(function(e){document.getElementsByClassName("tray-items")[0].appendChild(e)}),e()})})}function N(){return new Promise(function(e){f.initTrayObj(function(e,t){j("loading tray-obj : "+e.toString()+" / "+t.toString())}).then(function(t){t.forEach(function(e){document.getElementsByClassName("tray-items")[0].appendChild(e)}),e()})})}function j(e){document.getElementsByClassName("loading")[0].innerHTML="Loading...<br />"+e}function A(){document.getElementsByClassName("loading")[0];k.hideLoading()}function C(e){document.querySelector(".tray-active")&&document.querySelector(".tray-active").classList.remove("tray-active"),document.querySelector('[data-block="'+e+'"]').classList.add("tray-active")}function T(){document.getElementById("conv-new").value=c.old2CSV(document.getElementById("conv-old").value)}function O(e){h.stageEffects.skybox=e.target.value,B(p.getPackPath(a.defaultPackName)+a.pack.skyboxes.get(h.stageEffects.skybox).data.filename)}function M(){var e=document.getElementsByClassName("ed-attr")[0].value;h.blockAttrs.containsAttr(a.editingBlockId,e)||(b.renderAttributeUI(e),h.blockAttrs.push(a.editingBlockId,e,""))}function D(e){h.blockAttrs.update(a.editingBlockId,e.target.id.replace("ed-attr-",""),e.target.value)}i(function(){v.set(e),document.getElementById("pla-ver").innerHTML="Planet "+g.version+" by "+g.author,s.addEventListenerforQuery(".ins-show-btn","click",I),s.addEventListenerforQuery(".io-hf","change",P),s.addEventListenerforQuery(".tray-list-tool","click",S),document.head.appendChild(u("bower_components/move.js/move.js")),window.onbeforeunload=function(e){e.returnValue="ページを移動しますか？"},r.raiseEvent("initDom",null)}),e.setupCanvas=n,e.togglefullScreen=o,e.closeInspector=y,e.showInspector=w,e.clickExport=E,e.clickImport=x,e.clickInsShowBtn=I,e.changeHeaderorFooterValue=P,e.clickTrayTool=S,e.setSkybox=B,e.initTrayBlock=L,e.initTrayObj=N,e.changeLoadingStatus=j,e.hideLoading=A,e.changeActiveBlock=C,r.addEventListener("clickTrayToolbtn",function(t){var n={io:"io",setting:"inspector"};e.showInspector(n[t])}),e.clickConvertOldFile=T,e.changeSkybox=O,e.clickAddAttr=M,e.changeAttrInput=D,t()}(o||(o={})),t.exports=o},{"./modules/classes/vector2":10,"./modules/compiler":11,"./modules/data":12,"./modules/editBlock":13,"./modules/elem":14,"./modules/evElems":15,"./modules/event":16,"./modules/importJS":18,"./modules/initDOM":19,"./modules/packUtil/packManager":23,"./modules/planet":24,"./modules/stage":26,"./modules/tray":27,"./modules/ui/anim":29,"./modules/util":30,"./modules/version":31}]},{},[1,2,4,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,29,28,30,31,32]);