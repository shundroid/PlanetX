!function e(t,n,o){function a(r,s){if(!n[r]){if(!t[r]){var c="function"==typeof require&&require;if(!s&&c)return c(r,!0);if(i)return i(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var l=n[r]={exports:{}};t[r][0].call(l.exports,function(e){var n=t[r][1][e];return a(n?n:e)},l,l.exports,e,t,n,o)}return n[r].exports}for(var i="function"==typeof require&&require,r=0;r<o.length;r++)a(o[r]);return a}({1:[function(e,t,n){var o,a=e("./ui"),i=e("./modules/initDOM"),r=e("./modules/packUtil/packLoader"),s=e("./modules/packUtil/packManager"),c=e("./modules/event"),d=e("./modules/stage"),l=e("./modules/model/stageEffectsModel"),u=e("./modules/model/stageItemsModel"),f=e("./modules/data"),m=e("./modules/makePrefabDataUrls"),p=e("./modules/tray"),g=e("./modules/classes/prefab"),v=e("./modules/classes/vector2"),h=e("./modules/classes/rect"),k=e("./modules/canvas"),y=e("./modules/editBlock"),b=e("./modules/ui/focusGuide"),E=e("./modules/model/editorModel"),w=e("./modules/view/stageRenderView"),I=e("./modules/model/packModel"),M=e("./modules/model/trayModel"),P=e("./modules/model/preferencesModel");!function(e){function t(){f.data.dataInit()}t(),i["default"](function(){a.setupCanvas(),r["default"](P.currentPackName).then(function(e){I.setPack(new s.packModule(e)),c.raiseEvent("packLoaded",null),l.stageEffects.skyboxes=[I.pack.editor.defaultSkybox],a.setSkybox(s.getPackPath(P.currentPackName)+I.pack.skyboxes.get(I.pack.editor.defaultSkybox).data.filename),c.raiseEvent("initedPack",null),c.raiseEvent("initedUI",null),a.initTrayBlock().then(function(){a.initTrayObj().then(function(){c.raiseEvent("initedTray",null)})})}),c.addEventListener("initedTray",function(){a.changeLoadingStatus("making DataURL"),M.setTrayBlockDataUrls(m["default"]());var e=I.pack.blocks.get(I.pack.editor.defaultBlock);p.updateActiveBlock(I.pack.editor.defaultBlock,e.data.filename,e.data.bName),a.changeLoadingStatus("Are you ready?"),c.raiseEvent("ready",null)}),c.addEventListener("ready",function(){a.hideLoading()}),c.addEventListener("gridCanvas",function(e){var t=new g["default"](e.gridPos.x,e.gridPos.y,M.activeBlock.fileName,M.activeBlock.blockName,d.toGridPos(M.activeBlock.width),d.toGridPos(M.activeBlock.height)),n=d.getPrefabFromGrid(new v["default"](t.gridX,t.gridY),E.activeStageLayerInEditor),o=d.toDrawRect(new h["default"](t.gridX,t.gridY,t.gridW,t.gridH));switch(b.hide(),M.activeToolName){case"pencil":"down"===e.eventName?n.contains?(u.remove(n.id,E.activeStageLayerInEditor),w["default"](E.activeStageLayerInEditor)):(k.render(M.activeBlockImage,o),u.push(u.getId(),t,E.activeStageLayerInEditor)):"hovering"===e.eventName&&b.focus(new v["default"](o.x,o.y),new v["default"](o.width,o.height),n.contains?"rgba(240,0,0,0.6)":"rgba(0,240,0,0.6)");break;case"choice":if("down"===e.eventName&&n.prefab){if(I.pack.objs.contains(n.prefab.blockName)){var i=I.pack.objs.get(n.prefab.blockName);p.updateActiveBlock(n.prefab.blockName,i.data.oName,s.getPackPath(P.currentPackName)+i.data.filename,i.data.width,i.data.height)}else{var r=I.pack.blocks.get(n.prefab.blockName);p.updateActiveBlock(n.prefab.blockName,r.data.bName,s.getPackPath(P.currentPackName)+r.data.filename)}a.changeActiveBlock(n.prefab.blockName)}break;case"hand":"move"===e.eventName&&(d.scrollX+=e.mousePos.x-d.scrollBeforeX,d.scrollY+=e.mousePos.y-d.scrollBeforeY,w["default"](E.activeStageLayerInEditor)),d.scrollBeforeX=e.mousePos.x,d.scrollBeforeY=e.mousePos.y;break;case"edit":"down"===e.eventName&&n.contains&&(a.showInspector("edit-block"),E.setEditingBlockId(n.id),y.updateEditBlock(new y.EditBlock(n.prefab.blockName,new v["default"](n.prefab.gridX,n.prefab.gridY),n.id)));break;default:("move"===e.eventName||"down"===e.eventName)&&("brush"===M.activeToolName?(n.contains&&n.prefab.blockName!==M.activeBlock.blockName&&(u.remove(n.id,E.activeStageLayerInEditor),w["default"](E.activeStageLayerInEditor)),n.contains||(k.render(M.activeBlockImage,o),u.push(u.getId(),t,E.activeStageLayerInEditor))):"erase"===M.activeToolName&&n.contains&&(u.remove(n.id,E.activeStageLayerInEditor),w["default"](E.activeStageLayerInEditor)))}})})}(o||(o={})),t.exports=o},{"./modules/canvas":2,"./modules/classes/prefab":4,"./modules/classes/rect":5,"./modules/classes/vector2":7,"./modules/data":8,"./modules/editBlock":9,"./modules/event":12,"./modules/initDOM":14,"./modules/makePrefabDataUrls":16,"./modules/model/editorModel":17,"./modules/model/packModel":18,"./modules/model/preferencesModel":19,"./modules/model/stageEffectsModel":21,"./modules/model/stageItemsModel":22,"./modules/model/trayModel":23,"./modules/packUtil/packLoader":24,"./modules/packUtil/packManager":25,"./modules/stage":27,"./modules/tray":28,"./modules/ui/focusGuide":30,"./modules/view/stageRenderView":33,"./ui":34}],2:[function(e,t,n){function o(){s.width=window.innerWidth,s.height=window.innerHeight,n.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight}}function a(e,t){c.drawImage(e,t.x,t.y,t.width,t.height)}function i(e){c.clearRect(e.x,e.y,e.width,e.height)}function r(){c.clearRect(0,0,s.width,s.height)}var s,c,d=e("./initDOM");d["default"](function(){s=document.getElementById("pla-canvas"),n.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight},o(),s&&s.getContext&&(c=s.getContext("2d"),c.imageSmoothingEnabled=!1,c.mozImageSmoothingEnabled=!1,c.webkitImageSmoothingEnabled=!1,c.msImageSmoothingEnabled=!1)}),window.addEventListener("resize",o),n.render=a,n.clearByRect=i,n.clear=r},{"./initDOM":14}],3:[function(e,t,n){var o=function(){function e(){this.data={}}return e.prototype.push=function(e,t){this.data[e]=t},e.prototype.update=function(e,t){this.data[e]=t},e.prototype.get=function(e){return this.data[e]},e.prototype.getAll=function(){return this.data},e.prototype.remove=function(e){delete this.data[e]},e.prototype.clear=function(){this.data={}},e.prototype.contains=function(e){return this.data.hasOwnProperty(e)},e.prototype.toSimple=function(){return this.data},e}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o},{}],4:[function(e,t,n){var o=function(){function e(e,t,n,o,a,i){this.gridX=e,this.gridY=t,this.fileName=n,this.blockName=o,this.gridW=a,this.gridH=i}return e}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o},{}],5:[function(e,t,n){var o=function(){function e(e,t,n,o){this.x=e,this.y=t,this.width=n,this.height=o}return e}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o},{}],6:[function(e,t,n){var o=function(){function e(e,t,n,o,a){this.blockName=e,this.fileName=t,this.label=n,this.width=o,this.height=a}return e}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o},{}],7:[function(e,t,n){var o=function(){function e(e,t){this.x=e,this.y=t}return Object.defineProperty(e,"zero",{get:function(){return new e(0,0)},enumerable:!0,configurable:!0}),e}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o},{}],8:[function(e,t,n){var o=e("./model/editorModel"),a=e("./model/preferencesModel"),i=e("./model/trayModel"),r=function(){function e(){}return e.dataInit=function(){a.setDefaultValues(),o.setDefaultValues(),i.setDefaultValues(),o.setActiveStageLayer(0)},e}();n.data=r},{"./model/editorModel":17,"./model/preferencesModel":19,"./model/trayModel":23}],9:[function(e,t,n){function o(e){m=e,i()}function a(){return m}function i(){if(document.getElementById("ed-name").textContent="Name: "+m.blockName,document.getElementById("ed-pos").textContent="Pos: "+m.blockPos.x+", "+m.blockPos.y,document.getElementById("ed-id").textContent="ID: "+m.blockId,document.getElementsByClassName("ed-attr-view")[0].innerHTML="",l.containsBlock(u.editingBlockIdByInspector)){var e=l.getBlock(u.editingBlockIdByInspector);Object.keys(e).forEach(function(e){var t=l.getAttr(u.editingBlockIdByInspector,parseInt(e));r(parseInt(e),t.attrName,t.attrVal)})}}function r(e,t,n){var o=document.createElement("section");o.id="ed-attr-field-"+e;var a=document.createElement("input");a.type="text",a.id="ed-attr-name-"+e,a.classList.add("ed-attr-name"),a.placeholder="name","undefined"!=typeof t&&(a.value=t),a.addEventListener("keydown",c);var i=document.createElement("input");i.type="text",i.id="ed-attr-"+e,i.classList.add("ed-attr-val"),i.placeholder="value","undefined"!=typeof n&&(i.value=n),i.addEventListener("keydown",s);var r=document.createElement("button");r.innerHTML='<i class="fa fa-minus"></i>',r.classList.add("pla-btn"),r.id="ed-attr-remove-"+e,r.addEventListener("click",d),o.appendChild(r),o.appendChild(a),o.appendChild(document.createTextNode(":")),o.appendChild(i),document.getElementsByClassName("ed-attr-view")[0].appendChild(o)}function s(e){console.log("hg!!"),l.update(u.editingBlockIdByInspector,parseInt(e.target.id.replace("ed-attr-","")),{attrVal:e.target.value})}function c(e){l.update(u.editingBlockIdByInspector,parseInt(e.target.id.replace("ed-attr-name-","")),{attrName:e.target.value})}function d(e){var t=parseInt(e.target.id.replace("ed-attr-remove-",""));l.removeAttr(u.editingBlockIdByInspector,t),document.getElementsByClassName("ed-attr-view")[0].removeChild(document.getElementById("ed-attr-field-"+t))}var l=e("./model/stageAttrsModel"),u=e("./model/editorModel"),f=function(){function e(e,t,n){this.blockName=e,this.blockPos=t,this.blockId=n}return e}();n.EditBlock=f;var m;n.updateEditBlock=o,n.getCurrentEditBlock=a,n.updateEditBlockUI=i,n.renderAttributeUI=r,n.changeAttrVal=s,n.changeAttrName=c,n.clickRemoveAttr=d},{"./model/editorModel":17,"./model/stageAttrsModel":20}],10:[function(e,t,n){function o(e,t,n){a(e,function(e){e.addEventListener(t,n)})}function a(e,t){Array.prototype.forEach.call(document.querySelectorAll(e),t)}n.addEventListenerforQuery=o,n.forEachforQuery=a},{}],11:[function(e,t,n){function o(e){a.forEachforQuery(".ev-btn",function(t){t.addEventListener("click",e[t.dataset.listener])}),a.forEachforQuery(".ev-input",function(t){var n=t;"undefined"!=typeof n.dataset["default"]&&(n.value=n.dataset["default"]),"undefined"!=typeof n.dataset.change&&n.addEventListener("change",e[n.dataset.change])})}var a=e("./elem");Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o},{"./elem":10}],12:[function(e,t,n){function o(e,t){-1!==e.indexOf("|")?e.split("|").forEach(function(e){o(e,t)}):r.contains(e)?r.get(e).push(t):r.push(e,[t])}function a(e,t){r.contains(e)&&r.get(e).forEach(function(n){n(t,e)})}var i=e("./classes/list"),r=new i["default"];n.addEventListener=o,n.raiseEvent=a},{"./classes/list":3}],13:[function(e,t,n){function o(e,t,n){var a=new Image;if(a.src=e,t){var i,r,s=(a.width+n.x)/2,c=(a.height+n.y)/2;return i=document.createElement("canvas"),i.width=s,i.height=c,r=i.getContext("2d"),r.drawImage(a,0,0,s,c),o(i.toDataURL("image/png"))}return a}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o},{}],14:[function(e,t,n){function o(e){a.push(e)}var a=new Array;Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o,document.addEventListener("DOMContentLoaded",function(){a.forEach(function(e){e()})})},{}],15:[function(e,t,n){var o=e("./version"),a=function(){function e(e,t,n,o,a){this.blockName=e,this.posX=t,this.posY=n,this.name=o,this.attr=a}return e.prototype.toArray=function(){var e=[this.blockName,this.posX,this.posY];return"undefined"!=typeof this.name?e.push(this.name):e.push(""),"undefined"!=typeof this.attr&&e.push(this.attr),e},e.fromArray=function(t){var n=new e(t[0],t[1],t[2],t[3]);return"undefined"!=typeof t[4]&&(n.attr=t[4]),n},e}();n.jsonBlockItem=a;var i=function(){function e(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=[]),this.jsonPlanetVersion=e,this.stage=t,this.skyboxes=n}return e.prototype.exportJson=function(){var e={};e.jsonPlanetVersion=this.jsonPlanetVersion,this.skyboxes!==[]&&(e.skyboxes=this.skyboxes),e.stage=[];for(var t=0;t<this.stage.length;t++)e.stage[t]=[],this.stage[t].forEach(function(n){e.stage[t].push(n.toArray())});return e},e.importJson=function(t){for(var n=new e(t.jsonPlanetVersion||o.jsonPlanetVersion),i=t.stage,r=0;r<i.length;r++)n.stage[r]=[],i[r].forEach(function(e){n.stage[r].push(a.fromArray(e))});var s=t.skyboxes,c=0;return s.forEach(function(e){n.skyboxes[c++]=e}),n},e.fromCSV=function(t){var n=new e(o.jsonPlanetVersion,[[]]),i=t.split("\n");return i.forEach(function(e){if(""!==e&&"*"!==e.substring(0,1)&&"//"!==e.substring(0,2)){var t=e.split("="),o=t[0].split(",");n.stage[0].push(new a(o[0],parseInt(o[1]),parseInt(o[2]),t[1]))}}),n},e}();n.jsonPlanet=i},{"./version":32}],16:[function(e,t,n){function o(){var e,t=s.pack.blocks.getAll();Object.keys(t).forEach(function(t){e[t]=r["default"](a.getPackPath(c.currentPackName)+s.pack.blocks.get(t).data.filename,!0,new i["default"](c.defaultGridSize,c.defaultGridSize)).src});var n=s.pack.objs.getAll();return Object.keys(n).forEach(function(t){var n=s.pack.objs.get(t).data;e[t]=r["default"](a.getPackPath(c.currentPackName)+n.filename,!0,new i["default"](n.width,n.height)).src}),e}var a=e("./packUtil/packManager"),i=e("./classes/vector2"),r=e("./image"),s=e("./model/packModel"),c=e("./model/preferencesModel");Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o},{"./classes/vector2":7,"./image":13,"./model/packModel":18,"./model/preferencesModel":19,"./packUtil/packManager":25}],17:[function(e,t,n){function o(e){n.activeStageLayerInEditor=e}function a(e){n.isTrayFullscreen=e}function i(e){n.isVisibleInspector=e}function r(e){n.editingBlockIdByInspector=e}function s(e){n.isObjModeInEditor=e}function c(){n.activeStageLayerInEditor=0,n.isTrayFullscreen=!1,n.isObjModeInEditor=!1,n.isVisibleInspector=!1}n.setActiveStageLayer=o,n.setIsTrayFullscreen=a,n.setIsVisibleInspector=i,n.setEditingBlockId=r,n.setIsObjMode=s,n.setDefaultValues=c},{}],18:[function(e,t,n){function o(e){n.pack=e}n.setPack=o},{}],19:[function(e,t,n){function o(e){n.currentPackName=e}function a(e){n.defaultGridSize=e}function i(e){n.defaultBlockSize=e}function r(){n.currentPackName="oa",n.defaultGridSize=25,n.defaultBlockSize=50}n.setCurrentPackName=o,n.setDefaultGridSize=a,n.setDefaultBlockSize=i,n.setDefaultValues=r},{}],20:[function(e,t,n){function o(e){h=e}function a(e,t,n){"undefined"==typeof h[e]&&(h[e]={}),h[e][t]=n}function i(e,t,n){if(n instanceof v)h[e][t]=n;else{var o=h[e][t];"undefined"!=typeof n.attrName&&(o.attrName=n.attrName),"undefined"!=typeof n.attrVal&&(o.attrVal=n.attrVal),h[e][t]=o}}function r(e,t){return"undefined"==typeof h[e]?!1:"undefined"!=typeof h[e][t]}function s(e){return"undefined"!=typeof h[e]}function c(e,t){delete h[e][t]}function d(e){delete h[e]}function l(e){return h[e]}function u(e,t){return h[e][t]}function f(){return h}function m(){h={}}function p(e){return"undefined"==typeof h[e]?0:Object.keys(h[e]).length}function g(){h={}}var v=function(){function e(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this.attrName=e,this.attrVal=t}return e}();n.Attr=v;var h;n.setAll=o,n.push=a,n.update=i,n.containsAttr=r,n.containsBlock=s,n.removeAttr=c,n.removeBlock=d,n.getBlock=l,n.getAttr=u,n.getAll=f,n.clear=m,n.getMaxAttrId=p,n.init=g},{}],21:[function(e,t,n){function o(e){n.stageEffects=e}var a=function(){function e(){this.skyboxes=[""]}return e}();n.StageEffects=a,n.stageEffects=new a,n.setStageEffects=o},{}],22:[function(e,t,n){function o(e,t,n){void 0===n&&(n=0),g[e]=t,d(n,e)}function a(){return g}function i(e,t){v[t].splice(v[t].indexOf(e),1),delete g[e]}function r(){g={}}function s(e){return g[e]}function c(e){var t=l(e),n=new h["default"];return t.forEach(function(e){n.push(e.toString(),s(e))}),n}function d(e,t){"undefined"==typeof v[e]&&(v[e]=[]),v[e].push(t)}function l(e){return"undefined"==typeof v[e]&&(v[e]=[]),v[e]}function u(){return v}function f(){return k++}function m(){k=0}function p(){g={},v=new Array,k=0}var g,v,h=e("./../classes/list");n.push=o,n.all=a,n.remove=i,n.clear=r,n.get=s,n.getLayerItems=c,n.pushStageLayer=d,n.getLayerIds=l,n.getAllLayer=u;var k;n.getId=f,n.resetId=m,n.init=p},{"./../classes/list":3}],23:[function(e,t,n){function o(e){n.activeBlock=e}function a(e){n.activeBlockImage=e}function i(e){}function r(e){}function s(){n.activeToolName="pencil",n.trayBlockDataUrls={}}n.setActiveBlock=o,n.setActiveBlockImage=a,n.setActiveToolName=i,n.setTrayBlockDataUrls=r,n.setDefaultValues=s},{}],24:[function(e,t,n){function o(e){return new Promise(function(t){var n=new XMLHttpRequest;n.open("GET",a.getPackPath(e)+"packinfo.json"),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&t(JSON.parse(n.responseText))},n.send(null)})}var a=e("./../packUtil/packManager");Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o},{"./../packUtil/packManager":25}],25:[function(e,t,n){function o(e){return"pack/"+e+"/"}var a=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("./../classes/list");n.getPackPath=o;var r=function(){function e(e){var t=this;this.pack=new c(e.pack),this.blocks=new i["default"],Object.keys(e.blocks).forEach(function(n){t.blocks.push(n,new l({bName:e.blocks[n].name,filename:e.blocks[n].filename}))}),this.objs=new i["default"],Object.keys(e.objs).forEach(function(n){var o=e.objs[n];o.hidden?t.objs.push(n,new u({oName:o.name,filename:o.filename,width:o.width,height:o.height,type:o.type})):t.objs.push(n,new u({oName:o.name,filename:o.filename,width:o.width,height:o.height,type:o.type,hidden:o.hidden}))}),this.descriptions=new i["default"],Object.keys(e.descriptions).forEach(function(n){var o=e.descriptions[n];t.descriptions.push(n,new f(o))}),this.skyboxes=new p,Object.keys(e.skyboxes).forEach(function(n){t.skyboxes.push(n,new m(e.skyboxes[n]))}),this.editor=e.editor}return e}();n.packModule=r;var s=function(){function e(e,t,n,o){this.defaultSkybox=e,this.defaultBlock=t,this.skyboxMode=n,this.skyboxSize=o}return e}();n.packEditorInfo=s;var c=function(){function e(e){this.pName=e.name,this.version=e.version,this.author=e.author,this.exportType=e.exportType}return e}();n.packInfo=c;var d=function(){function e(e){this.data=e}return e}();n.packItem=d;var l=function(e){function t(){e.apply(this,arguments)}return a(t,e),t}(d);n.blockInfo=l;var u=function(e){function t(){e.apply(this,arguments)}return a(t,e),t}(d);n.objInfo=u;var f=function(e){function t(){e.apply(this,arguments)}return a(t,e),t}(d);n.desInfo=f;var m=function(e){function t(){e.apply(this,arguments)}return a(t,e),t}(d);n.skyboxInfo=m;var p=function(e){function t(){e.call(this)}return a(t,e),t.prototype.toSimple=function(){var e=this,t={};return Object.keys(this.getAll()).forEach(function(n){t[e.get(n).data.label]=n}),t},t}(i["default"]);n.skyboxInfoList=p},{"./../classes/list":3}],26:[function(e,t,n){function o(){var e=new l.jsonPlanet(u.jsonPlanetVersion);Object.keys(r.stageEffects.skyboxes).forEach(function(t){e.skyboxes.push(r.stageEffects.skyboxes[parseInt(t)])});for(var t=s.getAllLayer(),n=0;n<t.length;n++)e.stage[n]=[],t[n].forEach(function(t){var o=s.get(t);if(c.containsBlock(t)){var a={},i=c.getBlock(t);Object.keys(i).forEach(function(e){a[i[parseInt(e)].attrName]=i[parseInt(e)].attrVal}),e.stage[n].push(new l.jsonBlockItem(o.blockName,o.gridX,o.gridY,t.toString(),a))}else e.stage[n].push(new l.jsonBlockItem(o.blockName,o.gridX,o.gridY,t.toString()))});return e}function a(e){s.clear(),c.clear(),s.resetId();for(var t=0;t<e.stage.length;t++)e.stage[t].forEach(function(e){var n=s.getId();if(m.pack.objs.contains(e.blockName)){var o=m.pack.objs.get(e.blockName);s.push(n,new d["default"](e.posX,e.posY,o.data.filename,e.blockName,i.toGridPos(o.data.width),i.toGridPos(o.data.height)),t)}else{var a=m.pack.blocks.get(e.blockName);s.push(n,new d["default"](e.posX,e.posY,a.data.filename,e.blockName,i.toGridPos(p.defaultBlockSize),i.toGridPos(p.defaultBlockSize)),t)}"undefined"!=typeof e.attr&&Object.keys(e.attr).forEach(function(t){c.push(n,c.getMaxAttrId(n),new c.Attr(t,e.attr[t]))})});f.setActiveStageLayer(0);var n=new r.StageEffects;return n.skyboxes=e.skyboxes,n}var i=e("./stage"),r=e("./model/stageEffectsModel"),s=e("./model/stageItemsModel"),c=e("./model/stageAttrsModel"),d=e("./classes/prefab"),l=e("./jsonPlanet"),u=e("./version"),f=e("./model/editorModel"),m=e("./model/packModel"),p=e("./model/preferencesModel");n.toJsonPlanet=o,n.fromJsonPlanet=a},{"./classes/prefab":4,"./jsonPlanet":15,"./model/editorModel":17,"./model/packModel":18,"./model/preferencesModel":19,"./model/stageAttrsModel":20,"./model/stageEffectsModel":21,"./model/stageItemsModel":22,"./stage":27,"./version":32}],27:[function(e,t,n){var o,a=e("./classes/rect"),i=e("./event"),r=e("./classes/vector2"),s=e("./model/stageAttrsModel"),c=e("./model/stageItemsModel"),d=e("./model/editorModel"),l=e("./view/stageRenderView"),u=e("./model/preferencesModel");!function(e){function t(e){d.setActiveStageLayer(e),l["default"](e)}function n(){c.init(),s.init()}function o(e,t){return e-(t-u.defaultGridSize)/2}function f(t){var n=t.x-e.scrollX,o=t.y-e.scrollY,a=n-n%u.defaultGridSize,i=o-o%u.defaultGridSize,s=a/u.defaultGridSize,c=i/u.defaultGridSize;return new r["default"](s,c)}function m(e,t){var n=new b(!1,-1,null),o={};try{Object.keys(c.getLayerItems(t).getAll()).forEach(function(t){var a=c.get(parseInt(t));if(e.x>=a.gridX&&e.x<a.gridX+a.gridW&&e.y>=a.gridY&&e.y<a.gridY+a.gridH)throw n=new b(!0,parseInt(t),a),o})}catch(a){if(a!==o)throw a}return n}function p(e){return e*u.defaultGridSize}function g(e){return(e-e%u.defaultGridSize)/u.defaultGridSize}function v(t){return new a["default"](e.scrollX+o(p(t.x),p(t.width)),e.scrollY+o(p(t.y),p(t.height)),p(t.width),p(t.height))}e.changeActiveStageLayer=t,n();var h,k=!1;i.addEventListener("resize",function(){k&&clearTimeout(h),k=!0,h=setTimeout(function(){k=!1,l["default"](d.activeStageLayerInEditor)},100)});var y=function(){function e(e,t,n){this.gridPos=e,this.eventName=t,this.mousePos=n}return e}();e.gridDetail=y,e.getMousePosFromCenterAndSize=o,e.scrollX=0,e.scrollY=0,e.scrollBeforeX=0,e.scrollBeforeY=0,e.getGridPosFromMousePos=f;var b=function(){function e(e,t,n){this.contains=e,this.id=t,this.prefab=n}return e}();e.getPrefabFromGridDetails=b,e.getPrefabFromGrid=m,e.toMousePos=p,e.toGridPos=g,e.toDrawRect=v}(o||(o={})),t.exports=o},{"./classes/rect":5,"./classes/vector2":7,"./event":12,"./model/editorModel":17,"./model/preferencesModel":19,"./model/stageAttrsModel":20,"./model/stageItemsModel":22,"./view/stageRenderView":33}],28:[function(e,t,n){function o(e,t,n,o,i){var r=o||m.defaultBlockSize,s=i||m.defaultBlockSize;f.setActiveBlock(new c["default"](e,t,n,r,s)),a()}function a(){f.setActiveBlockImage(s["default"](f.trayBlockDataUrls[f.activeBlock.blockName]))}function i(e){return new Promise(function(t){var n=Object.keys(u.pack.blocks.getAll()),o=[],a=function(i){var r=n[i],s=document.createElement("div");s.classList.add("tray-list","tray-list-block"),s.addEventListener("mousedown",function(e){d.raiseEvent("ui_clickTray",e)});var c=document.createElement("img");c.src=l.getPackPath(m.currentPackName)+u.pack.blocks.get(r).data.filename,c.onload=function(){c.alt=u.pack.blocks.get(r).data.bName,c.dataset.block=r,s.appendChild(c),o.push(s),i===n.length-1?t(o):(e(i,n.length-1),a(i+1))}};a(0)})}function r(e){return new Promise(function(t){var n=Object.keys(u.pack.objs.getAll()),o=[],a=function(i){var r=n[i],s=document.createElement("div");s.classList.add("tray-list","tray-list-obj"),s.addEventListener("click",function(e){d.raiseEvent("ui_clickTray",e)});var c=document.createElement("img");c.src=l.getPackPath(m.currentPackName)+u.pack.objs.get(r).data.filename,c.onload=function(){c.alt=u.pack.objs.get(r).data.oName,c.dataset.block=r,s.style.width=c.style.width=u.pack.objs.get(r).data.width/(u.pack.objs.get(r).data.height/50)+"px",s.style.height=c.style.height="50px",s.appendChild(c),o.push(s),i===n.length-1?t(o):(e(i,n.length-1),a(i+1))}};a(0)})}var s=e("./image"),c=e("./classes/trayBlockDetails"),d=e("./event"),l=e("./packUtil/packManager"),u=e("./model/packModel"),f=e("./model/trayModel"),m=e("./model/preferencesModel");n.updateActiveBlock=o,n.updateSelectImage=a,n.initTrayBlock=i,n.initTrayObj=r},{"./classes/trayBlockDetails":6,"./event":12,"./image":13,"./model/packModel":18,"./model/preferencesModel":19,"./model/trayModel":23,"./packUtil/packManager":25}],29:[function(e,t,n){function o(){move(".pla-footer").set("height","100%").duration("0.5s").end()}function a(){move(".pla-footer").set("height","50px").duration("0.5s").end()}function i(){move(".pla-inspector").set("left","80%").duration("0.5s").end()}function r(){move(".pla-inspector").set("left","100%").duration("0.5s").end()}function s(){move(".loading").set("opacity",0).duration("1s").then().set("display","none").pop().end()}n.showTrayFull=o,n.hideTrayFull=a,n.showInspector=i,n.hideInspector=r,n.hideLoading=s},{}],30:[function(e,t,n){function o(e,t,n){i.style.visibility="visible",i.style.left=e.x+"px",i.style.top=e.y+"px",i.style.width=t.x+"px",i.style.height=t.y+"px",i.style.backgroundColor=n}function a(){i.style.visibility="hidden"}var i,r=e("./../initDOM");r["default"](function(){i=document.createElement("div"),i.id="guide",i.style.position="fixed",i.style.backgroundColor="rgba(240,0,0,0.6)",i.style.pointerEvents="none",document.body.appendChild(i)}),n.focus=o,n.hide=a},{"./../initDOM":14}],31:[function(e,t,n){function o(e){var t=[];return Object.keys(e).forEach(function(n){e[n].constructor==={}.constructor?(t.push('<optgroup label="'+n+'">'),t.push(o(e[n])),t.push("</optgroup>")):t.push('<option value="'+e[n]+'">'+n+"</option>")}),t.join("\n")}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o},{}],32:[function(e,t,n){n.version="v1.0",n.author="shundroid",n.jsonPlanetVersion=.1},{}],33:[function(e,t,n){function o(e){void 0===e&&(e=0),i.clear();var t=r.getLayerItems(e).getAll();Object.keys(t).forEach(function(e){var t=r.get(parseInt(e)),n=a.scrollX+a.getMousePosFromCenterAndSize(a.toMousePos(t.gridX),a.toMousePos(t.gridW)),o=a.scrollY+a.getMousePosFromCenterAndSize(a.toMousePos(t.gridY),a.toMousePos(t.gridH)),l=a.toMousePos(t.gridW),u=a.toMousePos(t.gridH);n+l>=0&&n<=i.canvasRect.width&&o+u>=0&&o<=i.canvasRect.height&&i.render(s["default"](d.trayBlockDataUrls[t.blockName]),new c["default"](n,o,l,u))})}var a=e("./../stage"),i=e("./../canvas"),r=e("./../model/stageItemsModel"),s=e("./../image"),c=e("./../classes/rect"),d=e("./../model/trayModel");Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=o},{"./../canvas":2,"./../classes/rect":5,"./../image":13,"./../model/stageItemsModel":22,"./../model/trayModel":23,"./../stage":27}],34:[function(e,t,n){var o,a=e("./modules/initDOM"),i=e("./modules/event"),r=e("./modules/elem"),s=e("./modules/util"),c=e("./modules/classes/vector2"),d=e("./modules/tray"),l=e("./modules/packUtil/packManager"),u=e("./modules/planet"),f=e("./modules/stage"),m=e("./modules/model/stageEffectsModel"),p=e("./modules/model/stageAttrsModel"),g=e("./modules/version"),v=e("./modules/evElems"),h=e("./modules/ui/anim"),k=e("./modules/editBlock"),y=e("./modules/jsonPlanet"),b=e("./modules/model/editorModel"),E=e("./modules/view/stageRenderView"),w=e("./modules/model/packModel"),I=e("./modules/model/preferencesModel"),M=e("./modules/model/trayModel");!function(e){function t(){window.addEventListener("resize",function(){i.raiseEvent("resize",null)}),i.addEventListener("ui_clickTray",function(e){var t=e.target;if(b.setIsObjMode(t.parentElement.classList.contains("tray-list-obj")),b.isObjModeInEditor){var n=w.pack.objs.get(t.dataset.block).data;d.updateActiveBlock(t.dataset.block,n.filename,n.oName,n.width,n.height)}else{var n=w.pack.blocks.get(t.dataset.block).data;d.updateActiveBlock(t.dataset.block,n.filename,n.bName)}_(t.dataset.block)}),i.addEventListener("ui_downCanvas|ui_moveCanvas|ui_upCanvas|ui_hoveringCanvas",function(e,t){var n=f.getGridPosFromMousePos(new c["default"](e.clientX,e.clientY));i.raiseEvent("gridCanvas",new f.gridDetail(n,t.replace("ui_","").replace("Canvas",""),new c["default"](e.clientX,e.clientY)))}),i.addEventListener("initedPack",function(){"undefined"!=typeof w.pack.editor.skyboxMode&&"repeat"===w.pack.editor.skyboxMode&&(document.body.style.backgroundRepeat="repeat","undefined"!=typeof w.pack.editor.skyboxSize?document.body.style.backgroundSize=w.pack.editor.skyboxSize:document.body.style.backgroundSize="auto"),r.forEachforQuery(".pack-select",function(e){var t=e;t.innerHTML=s["default"](w.pack[t.dataset.items].toSimple())}),document.getElementById("stg-skybox").value=w.pack.editor.defaultSkybox})}function n(){e.canvas=document.getElementById("pla-canvas"),e.canvas.addEventListener("mousedown",function(e){i.raiseEvent("ui_downCanvas",e)}),e.canvas.addEventListener("mousemove",function(e){1===e.buttons?i.raiseEvent("ui_moveCanvas",e):i.raiseEvent("ui_hoveringCanvas",e)}),e.canvas.addEventListener("mouseup",function(e){i.raiseEvent("ui_upCanvas",e)})}function o(e){b.isTrayFullscreen?(h.hideTrayFull(),e.target.textContent="↑"):(P(),h.showTrayFull(),e.target.textContent="↓"),b.setIsTrayFullscreen(!b.isTrayFullscreen)}function P(){b.isVisibleInspector&&(b.setIsVisibleInspector(!1),h.hideInspector())}function B(e){document.querySelector(".ins-article-active")&&document.querySelector(".ins-article-active").classList.remove("ins-article-active"),document.getElementById("ins-"+e).classList.add("ins-article-active"),b.isVisibleInspector||(b.setIsVisibleInspector(!0),h.showInspector())}function x(){document.getElementById("pla-io").value=JSON.stringify(u.toJsonPlanet().exportJson())}function S(){var e=u.fromJsonPlanet(y.jsonPlanet.importJson(JSON.parse(document.getElementById("pla-io").value)));m.setStageEffects(e),j(l.getPackPath(I.currentPackName)+w.pack.skyboxes.get(e.skyboxes[0]).data.filename),E["default"](0)}function L(e){B(e.target.dataset.ins)}function N(e){var t=e.target;return"I"===t.nodeName&&(t=t.parentElement),t.classList.contains("tool-btn")?void i.raiseEvent("clickTrayToolbtn",t.dataset.toolname):(document.getElementsByClassName("tool-active")[0].classList.remove("tool-active"),t.classList.add("tool-active"),void M.setActiveToolName(t.dataset.toolname))}function j(e){document.body.style.backgroundImage="url('"+e+"')"}function A(){return new Promise(function(e){d.initTrayBlock(function(e,t){C("loading tray-block : "+e.toString()+" / "+t.toString())}).then(function(t){t.forEach(function(e){document.getElementsByClassName("tray-items")[0].appendChild(e)}),e()})})}function O(){return new Promise(function(e){d.initTrayObj(function(e,t){C("loading tray-obj : "+e.toString()+" / "+t.toString())}).then(function(t){t.forEach(function(e){document.getElementsByClassName("tray-items")[0].appendChild(e)}),e()})})}function C(e){document.getElementsByClassName("loading")[0].innerHTML="Loading...<br />"+e}function T(){h.hideLoading()}function _(e){document.querySelector(".tray-active")&&document.querySelector(".tray-active").classList.remove("tray-active"),document.querySelector('[data-block="'+e+'"]').classList.add("tray-active")}function V(){document.getElementById("conv-new").value=JSON.stringify(y.jsonPlanet.fromCSV(document.getElementById("conv-old").value).exportJson())}function D(e){m.stageEffects.skyboxes[b.activeStageLayerInEditor]=e.target.value,j(l.getPackPath(I.currentPackName)+w.pack.skyboxes.get(m.stageEffects.skyboxes[b.activeStageLayerInEditor]).data.filename)}function z(){var e=p.getMaxAttrId(b.editingBlockIdByInspector);p.push(b.editingBlockIdByInspector,e,new p.Attr),k.renderAttributeUI(e)}function G(e){f.changeActiveStageLayer(parseInt(e.target.value)),"undefined"==typeof m.stageEffects.skyboxes[b.activeStageLayerInEditor]&&(m.stageEffects.skyboxes[b.activeStageLayerInEditor]=w.pack.editor.defaultSkybox),j(l.getPackPath(I.currentPackName)+w.pack.skyboxes.get(m.stageEffects.skyboxes[b.activeStageLayerInEditor]).data.filename),document.getElementById("stg-skybox").value=m.stageEffects.skyboxes[b.activeStageLayerInEditor]}a["default"](function(){v["default"](e),document.getElementById("pla-ver").innerHTML="Planet "+g.version+" by "+g.author,
r.addEventListenerforQuery(".ins-show-btn","click",L),r.addEventListenerforQuery(".tray-list-tool","mousedown",N);var t=document.createElement("script");t.src="bower_components/move.js/move.js",document.head.appendChild(t),window.onbeforeunload=function(e){e.returnValue="ページを移動しますか？"},i.raiseEvent("initDom",null)}),e.setupCanvas=n,e.togglefullScreen=o,e.closeInspector=P,e.showInspector=B,e.clickExport=x,e.clickImport=S,e.clickInsShowBtn=L,e.clickTrayTool=N,e.setSkybox=j,e.initTrayBlock=A,e.initTrayObj=O,e.changeLoadingStatus=C,e.hideLoading=T,e.changeActiveBlock=_,i.addEventListener("clickTrayToolbtn",function(t){var n={io:"io",setting:"inspector"};e.showInspector(n[t])}),e.clickConvertOldFile=V,e.changeSkybox=D,e.clickAddAttr=z,e.changeActiveStageLayer=G,t()}(o||(o={})),t.exports=o},{"./modules/classes/vector2":7,"./modules/editBlock":9,"./modules/elem":10,"./modules/evElems":11,"./modules/event":12,"./modules/initDOM":14,"./modules/jsonPlanet":15,"./modules/model/editorModel":17,"./modules/model/packModel":18,"./modules/model/preferencesModel":19,"./modules/model/stageAttrsModel":20,"./modules/model/stageEffectsModel":21,"./modules/model/trayModel":23,"./modules/packUtil/packManager":25,"./modules/planet":26,"./modules/stage":27,"./modules/tray":28,"./modules/ui/anim":29,"./modules/util":31,"./modules/version":32,"./modules/view/stageRenderView":33}]},{},[1]);