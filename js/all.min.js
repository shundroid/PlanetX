!function e(t,n,a){function o(s,r){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!r&&c)return c(s,!0);if(i)return i(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return o(n?n:e)},d,d.exports,e,t,n,a)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<a.length;s++)o(a[s]);return o}({1:[function(e,t,n){var a,o=e("./ui"),i=e("./modules/initDOM"),s=e("./modules/packUtil/packLoader"),r=e("./modules/packUtil/packManager"),c=e("./modules/event"),l=e("./modules/stage"),d=e("./modules/data"),u=e("./modules/makePrefabDataUrls"),f=e("./modules/tray"),m=e("./modules/classes/prefab"),p=e("./modules/classes/vector2"),g=e("./modules/classes/rect"),h=e("./modules/canvas"),v=e("./modules/editBlock"),k=e("./modules/ui/focusGuide"),y=e("./modules/model/pack"),b=e("./modules/model/pack");!function(e){function t(){d.dataInit()}t(),i(function(){o.setupCanvas(),s(d.defaultPackName).then(function(e){b["default"](new r.packModule(e)),c.raiseEvent("packLoaded",null),l.stageEffects.skyboxes=[y.packModel.editor.defaultSkybox],o.setSkybox(r.getPackPath(d.defaultPackName)+y.packModel.skyboxes.get(y.packModel.editor.defaultSkybox).data.filename),c.raiseEvent("initedPack",null),c.raiseEvent("initedUI",null),o.initTrayBlock().then(function(){o.initTrayObj().then(function(){c.raiseEvent("initedTray",null)})})}),c.addEventListener("initedTray",function(){o.changeLoadingStatus("making DataURL"),d.trayItemDataURLs=u();var e=y.packModel.blocks.get(y.packModel.editor.defaultBlock);f.updateActiveBlock(y.packModel.editor.defaultBlock,e.data.filename,e.data.bName),o.changeLoadingStatus("Are you ready?"),c.raiseEvent("ready",null)}),c.addEventListener("ready",function(){o.hideLoading()}),c.addEventListener("gridCanvas",function(e){var t=new m(e.gridPos.x,e.gridPos.y,d.selectBlock.fileName,d.selectBlock.blockName,l.toGridPos(d.selectBlock.width),l.toGridPos(d.selectBlock.height)),n=l.getPrefabFromGrid(new p(t.gridX,t.gridY),d.activeStageLayer),a=l.toDrawRect(new g(t.gridX,t.gridY,t.gridW,t.gridH));switch(k.hide(),d.activeToolName){case"pencil":"down"===e.eventName?n.contains?(l.items.remove(n.id,d.activeStageLayer),l.renderStage(d.activeStageLayer)):(h.render(d.selectImage,a),l.items.push(l.getId(),t,d.activeStageLayer)):"hovering"===e.eventName&&k.focus(new p(a.x,a.y),new p(a.width,a.height),n.contains?"rgba(240,0,0,0.6)":"rgba(0,240,0,0.6)");break;case"choice":if("down"===e.eventName&&n.prefab){if(y.packModel.objs.contains(n.prefab.blockName)){var i=y.packModel.objs.get(n.prefab.blockName);f.updateActiveBlock(n.prefab.blockName,i.data.oName,r.getPackPath(d.defaultPackName)+i.data.filename,i.data.width,i.data.height)}else{var s=y.packModel.blocks.get(n.prefab.blockName);f.updateActiveBlock(n.prefab.blockName,s.data.bName,r.getPackPath(d.defaultPackName)+s.data.filename)}o.changeActiveBlock(n.prefab.blockName)}break;case"hand":"move"===e.eventName&&(l.scrollX+=e.mousePos.x-l.scrollBeforeX,l.scrollY+=e.mousePos.y-l.scrollBeforeY,l.renderStage(d.activeStageLayer)),l.scrollBeforeX=e.mousePos.x,l.scrollBeforeY=e.mousePos.y;break;case"edit":"down"===e.eventName&&n.contains&&(o.showInspector("edit-block"),d.editingBlockId=n.id,v.updateEditBlock(new v.EditBlock(n.prefab.blockName,new p(n.prefab.gridX,n.prefab.gridY),n.id)));break;default:("move"===e.eventName||"down"===e.eventName)&&("brush"===d.activeToolName?(n.contains&&n.prefab.blockName!==d.selectBlock.blockName&&(l.items.remove(n.id,d.activeStageLayer),l.renderStage(d.activeStageLayer)),n.contains||(h.render(d.selectImage,a),l.items.push(l.getId(),t,d.activeStageLayer))):"erase"===d.activeToolName&&n.contains&&(l.items.remove(n.id,d.activeStageLayer),l.renderStage(d.activeStageLayer)))}})})}(a||(a={})),t.exports=a},{"./modules/canvas":2,"./modules/classes/prefab":4,"./modules/classes/rect":5,"./modules/classes/vector2":7,"./modules/data":8,"./modules/editBlock":9,"./modules/event":12,"./modules/initDOM":14,"./modules/makePrefabDataUrls":16,"./modules/model/pack":17,"./modules/packUtil/packLoader":18,"./modules/packUtil/packManager":19,"./modules/stage":21,"./modules/tray":22,"./modules/ui/focusGuide":24,"./ui":27}],2:[function(e,t,n){var a,o=e("./initDOM");!function(e){function t(){s.width=window.innerWidth,s.height=window.innerHeight,e.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight}}function n(e,t){r.drawImage(e,t.x,t.y,t.width,t.height)}function a(e){r.clearRect(e.x,e.y,e.width,e.height)}function i(){r.clearRect(0,0,s.width,s.height)}var s,r;o(function(){s=document.getElementById("pla-canvas"),e.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight},t(),s&&s.getContext&&(r=s.getContext("2d"),r.imageSmoothingEnabled=!1,r.mozImageSmoothingEnabled=!1,r.webkitImageSmoothingEnabled=!1,r.msImageSmoothingEnabled=!1)}),window.addEventListener("resize",t),e.render=n,e.clearByRect=a,e.clear=i}(a||(a={})),t.exports=a},{"./initDOM":14}],3:[function(e,t,n){var a=function(){function e(){this.data={}}return e.prototype.push=function(e,t){this.data[e]=t},e.prototype.update=function(e,t){this.data[e]=t},e.prototype.get=function(e){return this.data[e]},e.prototype.getAll=function(){return this.data},e.prototype.remove=function(e){delete this.data[e]},e.prototype.clear=function(){this.data={}},e.prototype.contains=function(e){return this.data.hasOwnProperty(e)},e.prototype.toSimple=function(){return this.data},e}();t.exports=a},{}],4:[function(e,t,n){var a=function(){function e(e,t,n,a,o,i){this.gridX=e,this.gridY=t,this.fileName=n,this.blockName=a,this.gridW=o,this.gridH=i}return e}();t.exports=a},{}],5:[function(e,t,n){var a=function(){function e(e,t,n,a){this.x=e,this.y=t,this.width=n,this.height=a}return e}();t.exports=a},{}],6:[function(e,t,n){var a=function(){function e(e,t,n,a,o){this.blockName=e,this.fileName=t,this.label=n,this.width=a,this.height=o}return e}();t.exports=a},{}],7:[function(e,t,n){var a=function(){function e(e,t){this.x=e,this.y=t}return Object.defineProperty(e,"zero",{get:function(){return new e(0,0)},enumerable:!0,configurable:!0}),e}();t.exports=a},{}],8:[function(e,t,n){var a=e("./classes/list"),o=function(){function e(){}return e.dataInit=function(){this.trayItemDataURLs=new a,this.defaultPackName="oa",this.defaultGridSize=25,this.defaultBlockSize=50,this.activeToolName="pencil",this.isObjMode=!1,this.isFullscreenTray=!1,this.isShowInspector=!1,this.activeStageLayer=0},e}();t.exports=o},{"./classes/list":3}],9:[function(e,t,n){var a,o=e("./data"),i=e("./stage");!function(e){function t(e){u=e,a()}function n(){return u}function a(){if(document.getElementById("ed-name").textContent="Name: "+u.blockName,document.getElementById("ed-pos").textContent="Pos: "+u.blockPos.x+", "+u.blockPos.y,document.getElementById("ed-id").textContent="ID: "+u.blockId,document.getElementsByClassName("ed-attr-view")[0].innerHTML="",i.blockAttrs.containsBlock(o.editingBlockId)){var e=i.blockAttrs.getBlock(o.editingBlockId);Object.keys(e).forEach(function(e){var t=i.blockAttrs.getAttr(o.editingBlockId,parseInt(e));s(parseInt(e),t.attrName,t.attrVal)})}}function s(e,t,n){var a=document.createElement("section");a.id="ed-attr-field-"+e;var o=document.createElement("input");o.type="text",o.id="ed-attr-name-"+e,o.classList.add("ed-attr-name"),o.placeholder="name","undefined"!=typeof t&&(o.value=t),o.addEventListener("keydown",c);var i=document.createElement("input");i.type="text",i.id="ed-attr-"+e,i.classList.add("ed-attr-val"),i.placeholder="value","undefined"!=typeof n&&(i.value=n),i.addEventListener("keydown",r);var s=document.createElement("button");s.innerHTML='<i class="fa fa-minus"></i>',s.classList.add("pla-btn"),s.id="ed-attr-remove-"+e,s.addEventListener("click",l),a.appendChild(s),a.appendChild(o),a.appendChild(document.createTextNode(":")),a.appendChild(i),document.getElementsByClassName("ed-attr-view")[0].appendChild(a)}function r(e){console.log("hg!!"),i.blockAttrs.update(o.editingBlockId,parseInt(e.target.id.replace("ed-attr-","")),{attrVal:e.target.value})}function c(e){i.blockAttrs.update(o.editingBlockId,parseInt(e.target.id.replace("ed-attr-name-","")),{attrName:e.target.value})}function l(e){var t=parseInt(e.target.id.replace("ed-attr-remove-",""));i.blockAttrs.removeAttr(o.editingBlockId,t),document.getElementsByClassName("ed-attr-view")[0].removeChild(document.getElementById("ed-attr-field-"+t))}var d=function(){function e(e,t,n){this.blockName=e,this.blockPos=t,this.blockId=n}return e}();e.EditBlock=d;var u;e.updateEditBlock=t,e.getCurrentEditBlock=n,e.updateEditBlockUI=a,e.renderAttributeUI=s,e.changeAttrVal=r,e.changeAttrName=c,e.clickRemoveAttr=l}(a||(a={})),t.exports=a},{"./data":8,"./stage":21}],10:[function(e,t,n){var a;!function(e){function t(e,t,a){n(e,function(e){e.addEventListener(t,a)})}function n(e,t){Array.prototype.forEach.call(document.querySelectorAll(e),t)}e.addEventListenerforQuery=t,e.forEachforQuery=n}(a||(a={})),t.exports=a},{}],11:[function(e,t,n){var a,o=e("./elem");!function(e){function t(e){o.forEachforQuery(".ev-btn",function(t){t.addEventListener("click",e[t.dataset.listener])}),o.forEachforQuery(".ev-input",function(t){var n=t;"undefined"!=typeof n.dataset["default"]&&(n.value=n.dataset["default"]),"undefined"!=typeof n.dataset.change&&n.addEventListener("change",e[n.dataset.change])})}e.set=t}(a||(a={})),t.exports=a},{"./elem":10}],12:[function(e,t,n){var a,o=e("./classes/list");!function(e){function t(e,n){-1!==e.indexOf("|")?e.split("|").forEach(function(e){t(e,n)}):a.contains(e)?a.get(e).push(n):a.push(e,[n])}function n(e,t){a.contains(e)&&a.get(e).forEach(function(n){n(t,e)})}var a=new o;e.addEventListener=t,e.raiseEvent=n}(a||(a={})),t.exports=a},{"./classes/list":3}],13:[function(e,t,n){function a(e,t,n){var o=new Image;if(o.src=e,t){var i,s,r=(o.width+n.x)/2,c=(o.height+n.y)/2;return i=document.createElement("canvas"),i.width=r,i.height=c,s=i.getContext("2d"),s.drawImage(o,0,0,r,c),a(i.toDataURL("image/png"))}return o}t.exports=a},{}],14:[function(e,t,n){function a(e){o.push(e)}var o=new Array;document.addEventListener("DOMContentLoaded",function(){o.forEach(function(e){e()})}),t.exports=a},{}],15:[function(e,t,n){var a,o=e("./version");!function(e){var t=function(){function e(e,t,n,a,o){this.blockName=e,this.posX=t,this.posY=n,this.name=a,this.attr=o}return e.prototype.toArray=function(){var e=[this.blockName,this.posX,this.posY];return"undefined"!=typeof this.name?e.push(this.name):e.push(""),"undefined"!=typeof this.attr&&e.push(this.attr),e},e.fromArray=function(t){var n=new e(t[0],t[1],t[2],t[3]);return"undefined"!=typeof t[4]&&(n.attr=t[4]),n},e}();e.jsonBlockItem=t;var n=function(){function e(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=[]),this.jsonPlanetVersion=e,this.stage=t,this.skyboxes=n}return e.prototype.exportJson=function(){var e={};e.jsonPlanetVersion=this.jsonPlanetVersion,this.skyboxes!==[]&&(e.skyboxes=this.skyboxes),e.stage=[];for(var t=0;t<this.stage.length;t++)e.stage[t]=[],this.stage[t].forEach(function(n){e.stage[t].push(n.toArray())});return e},e.importJson=function(n){for(var a=new e(n.jsonPlanetVersion||o.jsonPlanetVersion),i=n.stage,s=0;s<i.length;s++)a.stage[s]=[],i[s].forEach(function(e){a.stage[s].push(t.fromArray(e))});var r=n.skyboxes,c=0;return r.forEach(function(e){a.skyboxes[c++]=e}),a},e.fromCSV=function(n){var a=new e(o.jsonPlanetVersion,[[]]),i=n.split("\n");return i.forEach(function(e){if(""!==e&&"*"!==e.substring(0,1)&&"//"!==e.substring(0,2)){var n=e.split("="),o=n[0].split(",");a.stage[0].push(new t(o[0],parseInt(o[1]),parseInt(o[2]),n[1]))}}),a},e}();e.jsonPlanet=n}(a||(a={})),t.exports=a},{"./version":26}],16:[function(e,t,n){function a(){var e=new i,t=l.packModel.blocks.getAll();Object.keys(t).forEach(function(t){e.push(t,c(s.getPackPath(o.defaultPackName)+l.packModel.blocks.get(t).data.filename,!0,new r(o.defaultGridSize,o.defaultGridSize)).src)});var n=l.packModel.objs.getAll();return Object.keys(n).forEach(function(t){var n=l.packModel.objs.get(t).data;e.push(t,c(s.getPackPath(o.defaultPackName)+n.filename,!0,new r(n.width,n.height)).src)}),e}var o=e("./data"),i=e("./classes/list"),s=e("./packUtil/packManager"),r=e("./classes/vector2"),c=e("./image"),l=e("./model/pack");t.exports=a},{"./classes/list":3,"./classes/vector2":7,"./data":8,"./image":13,"./model/pack":17,"./packUtil/packManager":19}],17:[function(e,t,n){function a(e){n.packModel=e}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a},{}],18:[function(e,t,n){function a(e){return new Promise(function(t){var n=new XMLHttpRequest;n.open("GET",o.getPackPath(e)+"packinfo.json"),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&t(JSON.parse(n.responseText))},n.send(null)})}var o=e("./packManager");t.exports=a},{"./packManager":19}],19:[function(e,t,n){var a,o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("./../classes/list");!function(e){function t(e){return"pack/"+e+"/"}e.getPackPath=t;var n=function(){function e(e){var t=this;this.pack=new s(e.pack),this.blocks=new i,Object.keys(e.blocks).forEach(function(n){t.blocks.push(n,new c({bName:e.blocks[n].name,filename:e.blocks[n].filename}))}),this.objs=new i,Object.keys(e.objs).forEach(function(n){var a=e.objs[n];a.hidden?t.objs.push(n,new l({oName:a.name,filename:a.filename,width:a.width,height:a.height,type:a.type})):t.objs.push(n,new l({oName:a.name,filename:a.filename,width:a.width,height:a.height,type:a.type,hidden:a.hidden}))}),this.descriptions=new i,Object.keys(e.descriptions).forEach(function(n){var a=e.descriptions[n];t.descriptions.push(n,new d(a))}),this.skyboxes=new f,Object.keys(e.skyboxes).forEach(function(n){t.skyboxes.push(n,new u(e.skyboxes[n]))}),this.editor=e.editor}return e}();e.packModule=n;var a=function(){function e(e,t,n,a){this.defaultSkybox=e,this.defaultBlock=t,this.skyboxMode=n,this.skyboxSize=a}return e}();e.packEditorInfo=a;var s=function(){function e(e){this.pName=e.name,this.version=e.version,this.author=e.author,this.exportType=e.exportType}return e}();e.packInfo=s;var r=function(){function e(e){this.data=e}return e}();e.packItem=r;var c=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(r);e.blockInfo=c;var l=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(r);e.objInfo=l;var d=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(r);e.desInfo=d;var u=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(r);e.skyboxInfo=u;var f=function(e){function t(){e.call(this)}return o(t,e),t.prototype.toSimple=function(){var e=this,t={};return Object.keys(this.getAll()).forEach(function(n){t[e.get(n).data.label]=n}),t},t}(i);e.skyboxInfoList=f}(a||(a={})),t.exports=a},{"./../classes/list":3}],20:[function(e,t,n){var a,o=e("./stage"),i=e("./classes/prefab"),s=e("./data"),r=e("./jsonPlanet"),c=e("./version"),l=e("./model/pack");!function(e){function t(){var e=new r.jsonPlanet(c.jsonPlanetVersion);Object.keys(o.stageEffects.skyboxes).forEach(function(t){e.skyboxes.push(o.stageEffects.skyboxes[parseInt(t)])});for(var t=o.items.getAllLayer(),n=0;n<t.length;n++)e.stage[n]=[],t[n].forEach(function(t){var a=o.items.get(t);if(o.blockAttrs.containsBlock(t)){var i={},s=o.blockAttrs.getBlock(t);Object.keys(s).forEach(function(e){i[s[parseInt(e)].attrName]=s[parseInt(e)].attrVal}),e.stage[n].push(new r.jsonBlockItem(a.blockName,a.gridX,a.gridY,t.toString(),i))}else e.stage[n].push(new r.jsonBlockItem(a.blockName,a.gridX,a.gridY,t.toString()))});return e}function n(e){o.items.clear(),o.blockAttrs.clear(),o.resetId();for(var t=0;t<e.stage.length;t++)e.stage[t].forEach(function(e){var n=o.getId();if(l.packModel.objs.contains(e.blockName)){var a=l.packModel.objs.get(e.blockName);o.items.push(n,new i(e.posX,e.posY,a.data.filename,e.blockName,o.toGridPos(a.data.width),o.toGridPos(a.data.height)),t)}else{var r=l.packModel.blocks.get(e.blockName);o.items.push(n,new i(e.posX,e.posY,r.data.filename,e.blockName,o.toGridPos(s.defaultBlockSize),o.toGridPos(s.defaultBlockSize)),t)}"undefined"!=typeof e.attr&&Object.keys(e.attr).forEach(function(t){o.blockAttrs.push(n,o.blockAttrs.getMaxAttrId(n),new o.Attr(t,e.attr[t]))})});s.activeStageLayer=0;var n=new o.StageEffects;return n.skyboxes=e.skyboxes,n}e.toJsonPlanet=t,e.fromJsonPlanet=n}(a||(a={})),t.exports=a},{"./classes/prefab":4,"./data":8,"./jsonPlanet":15,"./model/pack":17,"./stage":21,"./version":26}],21:[function(e,t,n){var a,o=e("./classes/list"),i=e("./canvas"),s=e("./image"),r=e("./data"),c=e("./classes/rect"),l=e("./event"),d=e("./classes/vector2");!function(e){function t(e){r.activeStageLayer=e,f(e)}function n(){x={},w={},P=new Array,I=0}function a(){return I++}function u(){I=0}function f(t){void 0===t&&(t=0),i.clear();var n=S.getLayerItems(t).getAll();Object.keys(n).forEach(function(t){var n=S.get(parseInt(t)),a=e.scrollX+e.getMousePosFromCenterAndSize(e.toMousePos(n.gridX),e.toMousePos(n.gridW)),o=e.scrollY+e.getMousePosFromCenterAndSize(e.toMousePos(n.gridY),e.toMousePos(n.gridH)),l=e.toMousePos(n.gridW),d=e.toMousePos(n.gridH);a+l>=0&&a<=i.canvasRect.width&&o+d>=0&&o<=i.canvasRect.height&&i.render(s(r.trayItemDataURLs.get(n.blockName)),new c(a,o,l,d))})}function m(e,t){return e-(t-r.defaultGridSize)/2}function p(t){var n=t.x-e.scrollX,a=t.y-e.scrollY,o=n-n%r.defaultGridSize,i=a-a%r.defaultGridSize,s=o/r.defaultGridSize,c=i/r.defaultGridSize;return new d(s,c)}function g(e,t){var n=new M(!1,-1,null),a={};try{Object.keys(S.getLayerItems(t).getAll()).forEach(function(t){var o=S.get(parseInt(t));if(e.x>=o.gridX&&e.x<o.gridX+o.gridW&&e.y>=o.gridY&&e.y<o.gridY+o.gridH)throw n=new M(!0,parseInt(t),o),a})}catch(o){if(o!==a)throw o}return n}function h(e){return e*r.defaultGridSize}function v(e){return(e-e%r.defaultGridSize)/r.defaultGridSize}function k(t){return new c(e.scrollX+m(h(t.x),h(t.width)),e.scrollY+m(h(t.y),h(t.height)),h(t.width),h(t.height))}var y=function(){function e(){this.skyboxes=[""]}return e}();e.StageEffects=y,e.stageEffects=new y;var b=function(){function e(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this.attrName=e,this.attrVal=t}return e}();e.Attr=b;var w,E;!function(e){function t(e){w=e}function n(e,t,n){"undefined"==typeof w[e]&&(w[e]={}),w[e][t]=n}function a(e,t,n){if(n instanceof b)w[e][t]=n;else{var a=w[e][t];"undefined"!=typeof n.attrName&&(a.attrName=n.attrName),"undefined"!=typeof n.attrVal&&(a.attrVal=n.attrVal),w[e][t]=a}}function o(e,t){return"undefined"==typeof w[e]?!1:"undefined"!=typeof w[e][t]}function i(e){return"undefined"!=typeof w[e]}function s(e,t){delete w[e][t]}function r(e){delete w[e]}function c(e){return w[e]}function l(e,t){return w[e][t]}function d(){return w}function u(){w={}}function f(e){return"undefined"==typeof w[e]?0:Object.keys(w[e]).length}e.setAll=t,e.push=n,e.update=a,e.containsAttr=o,e.containsBlock=i,e.removeAttr=s,e.removeBlock=r,e.getBlock=c,e.getAttr=l,e.getAll=d,e.clear=u,e.getMaxAttrId=f}(E=e.blockAttrs||(e.blockAttrs={}));var x,P;e.changeActiveStageLayer=t;var S;!function(e){function t(e,t,n){void 0===n&&(n=0),x[e]=t,c(n,e)}function n(){return x}function a(e,t){P[t].splice(P[t].indexOf(e),1),delete x[e]}function i(){x={}}function s(e){return x[e]}function r(e){var t=l(e),n=new o;return t.forEach(function(e){n.push(e.toString(),s(e))}),n}function c(e,t){"undefined"==typeof P[e]&&(P[e]=[]),P[e].push(t)}function l(e){return"undefined"==typeof P[e]&&(P[e]=[]),P[e]}function d(){return P}e.push=t,e.all=n,e.remove=a,e.clear=i,e.get=s,e.getLayerItems=r,e.pushStageLayer=c,e.getLayerIds=l,e.getAllLayer=d}(S=e.items||(e.items={}));var I;n(),e.getId=a,e.resetId=u,e.renderStage=f;var L,N=!1;l.addEventListener("resize",function(){N&&clearTimeout(L),N=!0,L=setTimeout(function(){N=!1,f(r.activeStageLayer)},100)});var B=function(){function e(e,t,n){this.gridPos=e,this.eventName=t,this.mousePos=n}return e}();e.gridDetail=B,e.getMousePosFromCenterAndSize=m,e.scrollX=0,e.scrollY=0,e.scrollBeforeX=0,e.scrollBeforeY=0,e.getGridPosFromMousePos=p;var M=function(){function e(e,t,n){this.contains=e,this.id=t,this.prefab=n}return e}();e.getPrefabFromGridDetails=M,e.getPrefabFromGrid=g,e.toMousePos=h,e.toGridPos=v,e.toDrawRect=k}(a||(a={})),t.exports=a},{"./canvas":2,"./classes/list":3,"./classes/rect":5,"./classes/vector2":7,"./data":8,"./event":12,"./image":13}],22:[function(e,t,n){var a,o=e("./image"),i=e("./classes/trayBlockDetails"),s=e("./data"),r=e("./event"),c=e("./packUtil/packManager"),l=e("./model/pack");!function(e){function t(e,t,a,o,r){var c=o||s.defaultBlockSize,l=r||s.defaultBlockSize;s.selectBlock=new i(e,t,a,c,l),n()}function n(){s.selectImage=o(s.trayItemDataURLs.get(s.selectBlock.blockName))}function a(e){return new Promise(function(t){var n=Object.keys(l.packModel.blocks.getAll()),a=[],o=function(i){var d=n[i],u=document.createElement("div");u.classList.add("tray-list","tray-list-block"),u.addEventListener("mousedown",function(e){r.raiseEvent("ui_clickTray",e)});var f=document.createElement("img");f.src=c.getPackPath(s.defaultPackName)+l.packModel.blocks.get(d).data.filename,f.onload=function(){f.alt=l.packModel.blocks.get(d).data.bName,f.dataset.block=d,u.appendChild(f),a.push(u),i===n.length-1?t(a):(e(i,n.length-1),o(i+1))}};o(0)})}function d(e){return new Promise(function(t){var n=Object.keys(l.packModel.objs.getAll()),a=[],o=function(i){var d=n[i],u=document.createElement("div");u.classList.add("tray-list","tray-list-obj"),u.addEventListener("click",function(e){r.raiseEvent("ui_clickTray",e)});var f=document.createElement("img");f.src=c.getPackPath(s.defaultPackName)+l.packModel.objs.get(d).data.filename,f.onload=function(){f.alt=l.packModel.objs.get(d).data.oName,f.dataset.block=d,u.style.width=f.style.width=l.packModel.objs.get(d).data.width/(l.packModel.objs.get(d).data.height/50)+"px",u.style.height=f.style.height="50px",u.appendChild(f),a.push(u),i===n.length-1?t(a):(e(i,n.length-1),o(i+1))}};o(0)})}e.updateActiveBlock=t,e.updateSelectImage=n,e.initTrayBlock=a,e.initTrayObj=d}(a||(a={})),t.exports=a},{"./classes/trayBlockDetails":6,"./data":8,"./event":12,"./image":13,"./model/pack":17,"./packUtil/packManager":19}],23:[function(e,t,n){var a;!function(e){function t(){move(".pla-footer").set("height","100%").duration("0.5s").end()}function n(){move(".pla-footer").set("height","50px").duration("0.5s").end()}function a(){move(".pla-inspector").set("left","80%").duration("0.5s").end()}function o(){move(".pla-inspector").set("left","100%").duration("0.5s").end()}function i(){move(".loading").set("opacity",0).duration("1s").then().set("display","none").pop().end()}e.showTrayFull=t,e.hideTrayFull=n,e.showInspector=a,e.hideInspector=o,e.hideLoading=i}(a||(a={})),t.exports=a},{}],24:[function(e,t,n){var a,o=e("./../initDOM");!function(e){function t(e,t,n){a.style.visibility="visible",a.style.left=e.x+"px",a.style.top=e.y+"px",a.style.width=t.x+"px",a.style.height=t.y+"px",a.style.backgroundColor=n}function n(){a.style.visibility="hidden"}var a;o(function(){a=document.createElement("div"),a.id="guide",a.style.position="fixed",a.style.backgroundColor="rgba(240,0,0,0.6)",a.style.pointerEvents="none",document.body.appendChild(a)}),e.focus=t,e.hide=n}(a||(a={})),t.exports=a},{"./../initDOM":14}],25:[function(e,t,n){var a;!function(e){function t(e){var n=[];return Object.keys(e).forEach(function(a){e[a].constructor==={}.constructor?(n.push('<optgroup label="'+a+'">'),n.push(t(e[a])),n.push("</optgroup>")):n.push('<option value="'+e[a]+'">'+a+"</option>")}),n.join("\n")}e.obj2SelectElem=t}(a||(a={})),t.exports=a},{}],26:[function(e,t,n){var a;!function(e){e.version="v1.0",e.author="shundroid",e.jsonPlanetVersion=.1}(a||(a={})),t.exports=a},{}],27:[function(e,t,n){var a,o=e("./modules/data"),i=e("./modules/initDOM"),s=e("./modules/event"),r=e("./modules/elem"),c=e("./modules/util"),l=e("./modules/classes/vector2"),d=e("./modules/tray"),u=e("./modules/packUtil/packManager"),f=e("./modules/planet"),m=e("./modules/stage"),p=e("./modules/version"),g=e("./modules/evElems"),h=e("./modules/ui/anim"),v=e("./modules/editBlock"),k=e("./modules/jsonPlanet"),y=e("./modules/model/pack");!function(e){function t(){window.addEventListener("resize",function(){s.raiseEvent("resize",null)}),s.addEventListener("ui_clickTray",function(e){var t=e.target;if(o.isObjMode=t.parentElement.classList.contains("tray-list-obj"),o.isObjMode){var n=y.packModel.objs.get(t.dataset.block).data;d.updateActiveBlock(t.dataset.block,n.filename,n.oName,n.width,n.height)}else{var n=y.packModel.blocks.get(t.dataset.block).data;d.updateActiveBlock(t.dataset.block,n.filename,n.bName)}j(t.dataset.block)}),s.addEventListener("ui_downCanvas|ui_moveCanvas|ui_upCanvas|ui_hoveringCanvas",function(e,t){var n=m.getGridPosFromMousePos(new l(e.clientX,e.clientY));s.raiseEvent("gridCanvas",new m.gridDetail(n,t.replace("ui_","").replace("Canvas",""),new l(e.clientX,e.clientY)))}),s.addEventListener("initedPack",function(){"undefined"!=typeof y.packModel.editor.skyboxMode&&"repeat"===y.packModel.editor.skyboxMode&&(document.body.style.backgroundRepeat="repeat","undefined"!=typeof y.packModel.editor.skyboxSize?document.body.style.backgroundSize=y.packModel.editor.skyboxSize:document.body.style.backgroundSize="auto"),r.forEachforQuery(".pack-select",function(e){var t=e;t.innerHTML=c.obj2SelectElem(y.packModel[t.dataset.items].toSimple())}),document.getElementById("stg-skybox").value=y.packModel.editor.defaultSkybox})}function n(){e.canvas=document.getElementById("pla-canvas"),e.canvas.addEventListener("mousedown",function(e){s.raiseEvent("ui_downCanvas",e)}),e.canvas.addEventListener("mousemove",function(e){1===e.buttons?s.raiseEvent("ui_moveCanvas",e):s.raiseEvent("ui_hoveringCanvas",e)}),e.canvas.addEventListener("mouseup",function(e){s.raiseEvent("ui_upCanvas",e)})}function a(e){o.isFullscreenTray?(h.hideTrayFull(),e.target.textContent="↑"):(b(),h.showTrayFull(),e.target.textContent="↓"),o.isFullscreenTray=!o.isFullscreenTray}function b(){o.isShowInspector&&(o.isShowInspector=!1,h.hideInspector())}function w(e){document.querySelector(".ins-article-active")&&document.querySelector(".ins-article-active").classList.remove("ins-article-active"),document.getElementById("ins-"+e).classList.add("ins-article-active"),o.isShowInspector||(o.isShowInspector=!0,h.showInspector())}function E(){document.getElementById("pla-io").value=JSON.stringify(f.toJsonPlanet().exportJson())}function x(){var e=f.fromJsonPlanet(k.jsonPlanet.importJson(JSON.parse(document.getElementById("pla-io").value)));m.stageEffects=e,I(u.getPackPath(o.defaultPackName)+y.packModel.skyboxes.get(e.skyboxes[0]).data.filename),m.renderStage(0)}function P(e){w(e.target.dataset.ins)}function S(e){var t=e.target;return"I"===t.nodeName&&(t=t.parentElement),t.classList.contains("tool-btn")?void s.raiseEvent("clickTrayToolbtn",t.dataset.toolname):(document.getElementsByClassName("tool-active")[0].classList.remove("tool-active"),t.classList.add("tool-active"),void(o.activeToolName=t.dataset.toolname))}function I(e){document.body.style.backgroundImage="url('"+e+"')"}function L(){return new Promise(function(e){d.initTrayBlock(function(e,t){B("loading tray-block : "+e.toString()+" / "+t.toString())}).then(function(t){t.forEach(function(e){document.getElementsByClassName("tray-items")[0].appendChild(e)}),e()})})}function N(){return new Promise(function(e){d.initTrayObj(function(e,t){B("loading tray-obj : "+e.toString()+" / "+t.toString())}).then(function(t){t.forEach(function(e){document.getElementsByClassName("tray-items")[0].appendChild(e)}),e()})})}function B(e){document.getElementsByClassName("loading")[0].innerHTML="Loading...<br />"+e}function M(){h.hideLoading()}function j(e){document.querySelector(".tray-active")&&document.querySelector(".tray-active").classList.remove("tray-active"),document.querySelector('[data-block="'+e+'"]').classList.add("tray-active")}function A(){document.getElementById("conv-new").value=JSON.stringify(k.jsonPlanet.fromCSV(document.getElementById("conv-old").value).exportJson())}function C(e){m.stageEffects.skyboxes[o.activeStageLayer]=e.target.value,I(u.getPackPath(o.defaultPackName)+y.packModel.skyboxes.get(m.stageEffects.skyboxes[o.activeStageLayer]).data.filename)}function O(){var e=m.blockAttrs.getMaxAttrId(o.editingBlockId);m.blockAttrs.push(o.editingBlockId,e,new m.Attr),v.renderAttributeUI(e)}function T(e){m.changeActiveStageLayer(parseInt(e.target.value)),"undefined"==typeof m.stageEffects.skyboxes[o.activeStageLayer]&&(m.stageEffects.skyboxes[o.activeStageLayer]=y.packModel.editor.defaultSkybox),I(u.getPackPath(o.defaultPackName)+y.packModel.skyboxes.get(m.stageEffects.skyboxes[o.activeStageLayer]).data.filename),document.getElementById("stg-skybox").value=m.stageEffects.skyboxes[o.activeStageLayer]}i(function(){g.set(e),document.getElementById("pla-ver").innerHTML="Planet "+p.version+" by "+p.author,r.addEventListenerforQuery(".ins-show-btn","click",P),r.addEventListenerforQuery(".tray-list-tool","mousedown",S);var t=document.createElement("script");t.src="bower_components/move.js/move.js",document.head.appendChild(t),window.onbeforeunload=function(e){e.returnValue="ページを移動しますか？"},s.raiseEvent("initDom",null)}),e.setupCanvas=n,e.togglefullScreen=a,e.closeInspector=b,e.showInspector=w,e.clickExport=E,e.clickImport=x,e.clickInsShowBtn=P,e.clickTrayTool=S,e.setSkybox=I,e.initTrayBlock=L,e.initTrayObj=N,e.changeLoadingStatus=B,e.hideLoading=M,e.changeActiveBlock=j,s.addEventListener("clickTrayToolbtn",function(t){var n={io:"io",setting:"inspector"};e.showInspector(n[t])}),e.clickConvertOldFile=A,e.changeSkybox=C,e.clickAddAttr=O,e.changeActiveStageLayer=T,t()}(a||(a={})),t.exports=a},{"./modules/classes/vector2":7,"./modules/data":8,"./modules/editBlock":9,"./modules/elem":10,"./modules/evElems":11,"./modules/event":12,"./modules/initDOM":14,"./modules/jsonPlanet":15,"./modules/model/pack":17,"./modules/packUtil/packManager":19,"./modules/planet":20,"./modules/stage":21,"./modules/tray":22,"./modules/ui/anim":23,"./modules/util":25,"./modules/version":26}]},{},[1]);