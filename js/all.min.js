!function e(t,a,n){function o(s,r){if(!a[s]){if(!t[s]){var c="function"==typeof require&&require;if(!r&&c)return c(s,!0);if(i)return i(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var l=a[s]={exports:{}};t[s][0].call(l.exports,function(e){var a=t[s][1][e];return o(a?a:e)},l,l.exports,e,t,a,n)}return a[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,t,a){var n,o=e("./ui"),i=e("./modules/initDOM"),s=e("./modules/packUtil/packLoader"),r=e("./modules/packUtil/packManager"),c=e("./modules/event"),d=e("./modules/stage"),l=e("./modules/data"),u=e("./modules/makePrefabDataUrls"),f=e("./modules/tray"),m=e("./modules/classes/prefab"),p=e("./modules/classes/vector2"),g=e("./modules/classes/rect"),h=e("./modules/canvas"),v=e("./modules/editBlock"),k=e("./modules/ui/focusGuide");!function(e){function t(){l.data.dataInit()}t(),i["default"](function(){o.setupCanvas(),s["default"](l.data.defaultPackName).then(function(e){l.data.pack=new r.packModule(e),c.raiseEvent("packLoaded",null),d.stageEffects.skyboxes=[l.data.pack.editor.defaultSkybox],o.setSkybox(r.getPackPath(l.data.defaultPackName)+l.data.pack.skyboxes.get(l.data.pack.editor.defaultSkybox).data.filename),c.raiseEvent("initedPack",null),c.raiseEvent("initedUI",null),o.initTrayBlock().then(function(){o.initTrayObj().then(function(){c.raiseEvent("initedTray",null)})})}),c.addEventListener("initedTray",function(){o.changeLoadingStatus("making DataURL"),l.data.trayItemDataURLs=u["default"]();var e=l.data.pack.blocks.get(l.data.pack.editor.defaultBlock);f.updateActiveBlock(l.data.pack.editor.defaultBlock,e.data.filename,e.data.bName),o.changeLoadingStatus("Are you ready?"),c.raiseEvent("ready",null)}),c.addEventListener("ready",function(){o.hideLoading()}),c.addEventListener("gridCanvas",function(e){var t=new m["default"](e.gridPos.x,e.gridPos.y,l.data.selectBlock.fileName,l.data.selectBlock.blockName,d.toGridPos(l.data.selectBlock.width),d.toGridPos(l.data.selectBlock.height)),a=d.getPrefabFromGrid(new p["default"](t.gridX,t.gridY),l.data.activeStageLayer),n=d.toDrawRect(new g["default"](t.gridX,t.gridY,t.gridW,t.gridH));switch(k.hide(),l.data.activeToolName){case"pencil":"down"===e.eventName?a.contains?(d.items.remove(a.id,l.data.activeStageLayer),d.renderStage(l.data.activeStageLayer)):(h.render(l.data.selectImage,n),d.items.push(d.getId(),t,l.data.activeStageLayer)):"hovering"===e.eventName&&k.focus(new p["default"](n.x,n.y),new p["default"](n.width,n.height),a.contains?"rgba(240,0,0,0.6)":"rgba(0,240,0,0.6)");break;case"choice":if("down"===e.eventName&&a.prefab){if(l.data.pack.objs.contains(a.prefab.blockName)){var i=l.data.pack.objs.get(a.prefab.blockName);f.updateActiveBlock(a.prefab.blockName,i.data.oName,r.getPackPath(l.data.defaultPackName)+i.data.filename,i.data.width,i.data.height)}else{var s=l.data.pack.blocks.get(a.prefab.blockName);f.updateActiveBlock(a.prefab.blockName,s.data.bName,r.getPackPath(l.data.defaultPackName)+s.data.filename)}o.changeActiveBlock(a.prefab.blockName)}break;case"hand":"move"===e.eventName&&(d.scrollX+=e.mousePos.x-d.scrollBeforeX,d.scrollY+=e.mousePos.y-d.scrollBeforeY,d.renderStage(l.data.activeStageLayer)),d.scrollBeforeX=e.mousePos.x,d.scrollBeforeY=e.mousePos.y;break;case"edit":"down"===e.eventName&&a.contains&&(o.showInspector("edit-block"),l.data.editingBlockId=a.id,v.updateEditBlock(new v.EditBlock(a.prefab.blockName,new p["default"](a.prefab.gridX,a.prefab.gridY),a.id)));break;default:("move"===e.eventName||"down"===e.eventName)&&("brush"===l.data.activeToolName?(a.contains&&a.prefab.blockName!==l.data.selectBlock.blockName&&(d.items.remove(a.id,l.data.activeStageLayer),d.renderStage(l.data.activeStageLayer)),a.contains||(h.render(l.data.selectImage,n),d.items.push(d.getId(),t,l.data.activeStageLayer))):"erase"===l.data.activeToolName&&a.contains&&(d.items.remove(a.id,l.data.activeStageLayer),d.renderStage(l.data.activeStageLayer)))}})})}(n||(n={})),t.exports=n},{"./modules/canvas":2,"./modules/classes/prefab":4,"./modules/classes/rect":5,"./modules/classes/vector2":7,"./modules/data":8,"./modules/editBlock":9,"./modules/event":12,"./modules/initDOM":14,"./modules/makePrefabDataUrls":16,"./modules/packUtil/packLoader":17,"./modules/packUtil/packManager":18,"./modules/stage":20,"./modules/tray":21,"./modules/ui/focusGuide":23,"./ui":26}],2:[function(e,t,a){function n(){r.width=window.innerWidth,r.height=window.innerHeight,a.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight}}function o(e,t){c.drawImage(e,t.x,t.y,t.width,t.height)}function i(e){c.clearRect(e.x,e.y,e.width,e.height)}function s(){c.clearRect(0,0,r.width,r.height)}var r,c,d=e("./initDOM");d["default"](function(){r=document.getElementById("pla-canvas"),a.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight},n(),r&&r.getContext&&(c=r.getContext("2d"),c.imageSmoothingEnabled=!1,c.mozImageSmoothingEnabled=!1,c.webkitImageSmoothingEnabled=!1,c.msImageSmoothingEnabled=!1)}),window.addEventListener("resize",n),a.render=o,a.clearByRect=i,a.clear=s},{"./initDOM":14}],3:[function(e,t,a){var n=function(){function e(){this.data={}}return e.prototype.push=function(e,t){this.data[e]=t},e.prototype.update=function(e,t){this.data[e]=t},e.prototype.get=function(e){return this.data[e]},e.prototype.getAll=function(){return this.data},e.prototype.remove=function(e){delete this.data[e]},e.prototype.clear=function(){this.data={}},e.prototype.contains=function(e){return this.data.hasOwnProperty(e)},e.prototype.toSimple=function(){return this.data},e}();Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{}],4:[function(e,t,a){var n=function(){function e(e,t,a,n,o,i){this.gridX=e,this.gridY=t,this.fileName=a,this.blockName=n,this.gridW=o,this.gridH=i}return e}();Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{}],5:[function(e,t,a){var n=function(){function e(e,t,a,n){this.x=e,this.y=t,this.width=a,this.height=n}return e}();Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{}],6:[function(e,t,a){var n=function(){function e(e,t,a,n,o){this.blockName=e,this.fileName=t,this.label=a,this.width=n,this.height=o}return e}();Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{}],7:[function(e,t,a){var n=function(){function e(e,t){this.x=e,this.y=t}return Object.defineProperty(e,"zero",{get:function(){return new e(0,0)},enumerable:!0,configurable:!0}),e}();Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{}],8:[function(e,t,a){var n=e("./classes/list"),o=function(){function e(){}return e.dataInit=function(){this.trayItemDataURLs=new n["default"],this.defaultPackName="oa",this.defaultGridSize=25,this.defaultBlockSize=50,this.activeToolName="pencil",this.isObjMode=!1,this.isFullscreenTray=!1,this.isShowInspector=!1,this.activeStageLayer=0},e}();a.data=o},{"./classes/list":3}],9:[function(e,t,a){function n(e){m=e,i()}function o(){return m}function i(){if(document.getElementById("ed-name").textContent="Name: "+m.blockName,document.getElementById("ed-pos").textContent="Pos: "+m.blockPos.x+", "+m.blockPos.y,document.getElementById("ed-id").textContent="ID: "+m.blockId,document.getElementsByClassName("ed-attr-view")[0].innerHTML="",u.blockAttrs.containsBlock(l.data.editingBlockId)){var e=u.blockAttrs.getBlock(l.data.editingBlockId);Object.keys(e).forEach(function(e){var t=u.blockAttrs.getAttr(l.data.editingBlockId,parseInt(e));s(parseInt(e),t.attrName,t.attrVal)})}}function s(e,t,a){var n=document.createElement("section");n.id="ed-attr-field-"+e;var o=document.createElement("input");o.type="text",o.id="ed-attr-name-"+e,o.classList.add("ed-attr-name"),o.placeholder="name","undefined"!=typeof t&&(o.value=t),o.addEventListener("keydown",c);var i=document.createElement("input");i.type="text",i.id="ed-attr-"+e,i.classList.add("ed-attr-val"),i.placeholder="value","undefined"!=typeof a&&(i.value=a),i.addEventListener("keydown",r);var s=document.createElement("button");s.innerHTML='<i class="fa fa-minus"></i>',s.classList.add("pla-btn"),s.id="ed-attr-remove-"+e,s.addEventListener("click",d),n.appendChild(s),n.appendChild(o),n.appendChild(document.createTextNode(":")),n.appendChild(i),document.getElementsByClassName("ed-attr-view")[0].appendChild(n)}function r(e){console.log("hg!!"),u.blockAttrs.update(l.data.editingBlockId,parseInt(e.target.id.replace("ed-attr-","")),{attrVal:e.target.value})}function c(e){u.blockAttrs.update(l.data.editingBlockId,parseInt(e.target.id.replace("ed-attr-name-","")),{attrName:e.target.value})}function d(e){var t=parseInt(e.target.id.replace("ed-attr-remove-",""));u.blockAttrs.removeAttr(l.data.editingBlockId,t),document.getElementsByClassName("ed-attr-view")[0].removeChild(document.getElementById("ed-attr-field-"+t))}var l=e("./data"),u=e("./stage"),f=function(){function e(e,t,a){this.blockName=e,this.blockPos=t,this.blockId=a}return e}();a.EditBlock=f;var m;a.updateEditBlock=n,a.getCurrentEditBlock=o,a.updateEditBlockUI=i,a.renderAttributeUI=s,a.changeAttrVal=r,a.changeAttrName=c,a.clickRemoveAttr=d},{"./data":8,"./stage":20}],10:[function(e,t,a){function n(e,t,a){o(e,function(e){e.addEventListener(t,a)})}function o(e,t){Array.prototype.forEach.call(document.querySelectorAll(e),t)}a.addEventListenerforQuery=n,a.forEachforQuery=o},{}],11:[function(e,t,a){function n(e){o.forEachforQuery(".ev-btn",function(t){t.addEventListener("click",e[t.dataset.listener])}),o.forEachforQuery(".ev-input",function(t){var a=t;"undefined"!=typeof a.dataset["default"]&&(a.value=a.dataset["default"]),"undefined"!=typeof a.dataset.change&&a.addEventListener("change",e[a.dataset.change])})}var o=e("./elem");Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{"./elem":10}],12:[function(e,t,a){function n(e,t){-1!==e.indexOf("|")?e.split("|").forEach(function(e){n(e,t)}):s.contains(e)?s.get(e).push(t):s.push(e,[t])}function o(e,t){s.contains(e)&&s.get(e).forEach(function(a){a(t,e)})}var i=e("./classes/list"),s=new i["default"];a.addEventListener=n,a.raiseEvent=o},{"./classes/list":3}],13:[function(e,t,a){function n(e,t,a){var o=new Image;if(o.src=e,t){var i,s,r=(o.width+a.x)/2,c=(o.height+a.y)/2;return i=document.createElement("canvas"),i.width=r,i.height=c,s=i.getContext("2d"),s.drawImage(o,0,0,r,c),n(i.toDataURL("image/png"))}return o}Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{}],14:[function(e,t,a){function n(e){o.push(e)}var o=new Array;Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n,document.addEventListener("DOMContentLoaded",function(){o.forEach(function(e){e()})})},{}],15:[function(e,t,a){var n=e("./version"),o=function(){function e(e,t,a,n,o){this.blockName=e,this.posX=t,this.posY=a,this.name=n,this.attr=o}return e.prototype.toArray=function(){var e=[this.blockName,this.posX,this.posY];return"undefined"!=typeof this.name?e.push(this.name):e.push(""),"undefined"!=typeof this.attr&&e.push(this.attr),e},e.fromArray=function(t){var a=new e(t[0],t[1],t[2],t[3]);return"undefined"!=typeof t[4]&&(a.attr=t[4]),a},e}();a.jsonBlockItem=o;var i=function(){function e(e,t,a){void 0===t&&(t=[]),void 0===a&&(a=[]),this.jsonPlanetVersion=e,this.stage=t,this.skyboxes=a}return e.prototype.exportJson=function(){var e={};e.jsonPlanetVersion=this.jsonPlanetVersion,this.skyboxes!==[]&&(e.skyboxes=this.skyboxes),e.stage=[];for(var t=0;t<this.stage.length;t++)e.stage[t]=[],this.stage[t].forEach(function(a){e.stage[t].push(a.toArray())});return e},e.importJson=function(t){for(var a=new e(t.jsonPlanetVersion||n.jsonPlanetVersion),i=t.stage,s=0;s<i.length;s++)a.stage[s]=[],i[s].forEach(function(e){a.stage[s].push(o.fromArray(e))});var r=t.skyboxes,c=0;return r.forEach(function(e){a.skyboxes[c++]=e}),a},e.fromCSV=function(t){var a=new e(n.jsonPlanetVersion,[[]]),i=t.split("\n");return i.forEach(function(e){if(""!==e&&"*"!==e.substring(0,1)&&"//"!==e.substring(0,2)){var t=e.split("="),n=t[0].split(",");a.stage[0].push(new o(n[0],parseInt(n[1]),parseInt(n[2]),t[1]))}}),a},e}();a.jsonPlanet=i},{"./version":25}],16:[function(e,t,a){function n(){var e=new i["default"],t=o.data.pack.blocks.getAll();Object.keys(t).forEach(function(t){e.push(t,c["default"](s.getPackPath(o.data.defaultPackName)+o.data.pack.blocks.get(t).data.filename,!0,new r["default"](o.data.defaultGridSize,o.data.defaultGridSize)).src)});var a=o.data.pack.objs.getAll();return Object.keys(a).forEach(function(t){var a=o.data.pack.objs.get(t).data;e.push(t,c["default"](s.getPackPath(o.data.defaultPackName)+a.filename,!0,new r["default"](a.width,a.height)).src)}),e}var o=e("./data"),i=e("./classes/list"),s=e("./packUtil/packManager"),r=e("./classes/vector2"),c=e("./image");Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{"./classes/list":3,"./classes/vector2":7,"./data":8,"./image":13,"./packUtil/packManager":18}],17:[function(e,t,a){function n(e){return new Promise(function(t){var a=new XMLHttpRequest;a.open("GET",o.getPackPath(e)+"packinfo.json"),a.onreadystatechange=function(){4===a.readyState&&200===a.status&&t(JSON.parse(a.responseText))},a.send(null)})}var o=e("./../packUtil/packManager");Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{"./../packUtil/packManager":18}],18:[function(e,t,a){function n(e){return"pack/"+e+"/"}var o=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)},i=e("./../classes/list");a.getPackPath=n;var s=function(){function e(e){var t=this;this.pack=new c(e.pack),this.blocks=new i["default"],Object.keys(e.blocks).forEach(function(a){t.blocks.push(a,new l({bName:e.blocks[a].name,filename:e.blocks[a].filename}))}),this.objs=new i["default"],Object.keys(e.objs).forEach(function(a){var n=e.objs[a];n.hidden?t.objs.push(a,new u({oName:n.name,filename:n.filename,width:n.width,height:n.height,type:n.type})):t.objs.push(a,new u({oName:n.name,filename:n.filename,width:n.width,height:n.height,type:n.type,hidden:n.hidden}))}),this.descriptions=new i["default"],Object.keys(e.descriptions).forEach(function(a){var n=e.descriptions[a];t.descriptions.push(a,new f(n))}),this.skyboxes=new p,Object.keys(e.skyboxes).forEach(function(a){t.skyboxes.push(a,new m(e.skyboxes[a]))}),this.editor=e.editor}return e}();a.packModule=s;var r=function(){function e(e,t,a,n){this.defaultSkybox=e,this.defaultBlock=t,this.skyboxMode=a,this.skyboxSize=n}return e}();a.packEditorInfo=r;var c=function(){function e(e){this.pName=e.name,this.version=e.version,this.author=e.author,this.exportType=e.exportType}return e}();a.packInfo=c;var d=function(){function e(e){this.data=e}return e}();a.packItem=d;var l=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(d);a.blockInfo=l;var u=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(d);a.objInfo=u;var f=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(d);a.desInfo=f;var m=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(d);a.skyboxInfo=m;var p=function(e){function t(){e.call(this)}return o(t,e),t.prototype.toSimple=function(){var e=this,t={};return Object.keys(this.getAll()).forEach(function(a){t[e.get(a).data.label]=a}),t},t}(i["default"]);a.skyboxInfoList=p},{"./../classes/list":3}],19:[function(e,t,a){function n(){var e=new c.jsonPlanet(d.jsonPlanetVersion);Object.keys(i.stageEffects.skyboxes).forEach(function(t){e.skyboxes.push(i.stageEffects.skyboxes[parseInt(t)])});for(var t=i.items.getAllLayer(),a=0;a<t.length;a++)e.stage[a]=[],t[a].forEach(function(t){var n=i.items.get(t);if(i.blockAttrs.containsBlock(t)){var o={},s=i.blockAttrs.getBlock(t);Object.keys(s).forEach(function(e){o[s[parseInt(e)].attrName]=s[parseInt(e)].attrVal}),e.stage[a].push(new c.jsonBlockItem(n.blockName,n.gridX,n.gridY,t.toString(),o))}else e.stage[a].push(new c.jsonBlockItem(n.blockName,n.gridX,n.gridY,t.toString()))});return e}function o(e){i.items.clear(),i.blockAttrs.clear(),i.resetId();for(var t=0;t<e.stage.length;t++)e.stage[t].forEach(function(e){var a=i.getId();if(r.data.pack.objs.contains(e.blockName)){var n=r.data.pack.objs.get(e.blockName);i.items.push(a,new s["default"](e.posX,e.posY,n.data.filename,e.blockName,i.toGridPos(n.data.width),i.toGridPos(n.data.height)),t)}else{var o=r.data.pack.blocks.get(e.blockName);i.items.push(a,new s["default"](e.posX,e.posY,o.data.filename,e.blockName,i.toGridPos(r.data.defaultBlockSize),i.toGridPos(r.data.defaultBlockSize)),t)}"undefined"!=typeof e.attr&&Object.keys(e.attr).forEach(function(t){i.blockAttrs.push(a,i.blockAttrs.getMaxAttrId(a),new i.Attr(t,e.attr[t]))})});r.data.activeStageLayer=0;var a=new i.StageEffects;return a.skyboxes=e.skyboxes,a}var i=e("./stage"),s=e("./classes/prefab"),r=e("./data"),c=e("./jsonPlanet"),d=e("./version");a.toJsonPlanet=n,a.fromJsonPlanet=o},{"./classes/prefab":4,"./data":8,"./jsonPlanet":15,"./stage":20,"./version":25}],20:[function(e,t,a){var n,o=e("./classes/list"),i=e("./canvas"),s=e("./image"),r=e("./data"),c=e("./classes/rect"),d=e("./event"),l=e("./classes/vector2");!function(e){function t(e){r.data.activeStageLayer=e,f(e)}function a(){P={},w={},x=new Array,I=0}function n(){return I++}function u(){I=0}function f(t){void 0===t&&(t=0),i.clear();var a=S.getLayerItems(t).getAll();Object.keys(a).forEach(function(t){var a=S.get(parseInt(t)),n=e.scrollX+e.getMousePosFromCenterAndSize(e.toMousePos(a.gridX),e.toMousePos(a.gridW)),o=e.scrollY+e.getMousePosFromCenterAndSize(e.toMousePos(a.gridY),e.toMousePos(a.gridH)),d=e.toMousePos(a.gridW),l=e.toMousePos(a.gridH);n+d>=0&&n<=i.canvasRect.width&&o+l>=0&&o<=i.canvasRect.height&&i.render(s["default"](r.data.trayItemDataURLs.get(a.blockName)),new c["default"](n,o,d,l))})}function m(e,t){return e-(t-r.data.defaultGridSize)/2}function p(t){var a=t.x-e.scrollX,n=t.y-e.scrollY,o=a-a%r.data.defaultGridSize,i=n-n%r.data.defaultGridSize,s=o/r.data.defaultGridSize,c=i/r.data.defaultGridSize;return new l["default"](s,c)}function g(e,t){var a=new j(!1,-1,null),n={};try{Object.keys(S.getLayerItems(t).getAll()).forEach(function(t){var o=S.get(parseInt(t));if(e.x>=o.gridX&&e.x<o.gridX+o.gridW&&e.y>=o.gridY&&e.y<o.gridY+o.gridH)throw a=new j(!0,parseInt(t),o),n})}catch(o){if(o!==n)throw o}return a}function h(e){return e*r.data.defaultGridSize}function v(e){return(e-e%r.data.defaultGridSize)/r.data.defaultGridSize}function k(t){return new c["default"](e.scrollX+m(h(t.x),h(t.width)),e.scrollY+m(h(t.y),h(t.height)),h(t.width),h(t.height))}var y=function(){function e(){this.skyboxes=[""]}return e}();e.StageEffects=y,e.stageEffects=new y;var b=function(){function e(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this.attrName=e,this.attrVal=t}return e}();e.Attr=b;var w,E;!function(e){function t(e){w=e}function a(e,t,a){"undefined"==typeof w[e]&&(w[e]={}),w[e][t]=a}function n(e,t,a){if(a instanceof b)w[e][t]=a;else{var n=w[e][t];"undefined"!=typeof a.attrName&&(n.attrName=a.attrName),"undefined"!=typeof a.attrVal&&(n.attrVal=a.attrVal),w[e][t]=n}}function o(e,t){return"undefined"==typeof w[e]?!1:"undefined"!=typeof w[e][t]}function i(e){return"undefined"!=typeof w[e]}function s(e,t){delete w[e][t]}function r(e){delete w[e]}function c(e){return w[e]}function d(e,t){return w[e][t]}function l(){return w}function u(){w={}}function f(e){return"undefined"==typeof w[e]?0:Object.keys(w[e]).length}e.setAll=t,e.push=a,e.update=n,e.containsAttr=o,e.containsBlock=i,e.removeAttr=s,e.removeBlock=r,e.getBlock=c,e.getAttr=d,e.getAll=l,e.clear=u,e.getMaxAttrId=f}(E=e.blockAttrs||(e.blockAttrs={}));var P,x;e.changeActiveStageLayer=t;var S;!function(e){function t(e,t,a){void 0===a&&(a=0),P[e]=t,c(a,e)}function a(){return P}function n(e,t){x[t].splice(x[t].indexOf(e),1),delete P[e]}function i(){P={}}function s(e){return P[e]}function r(e){var t=d(e),a=new o["default"];return t.forEach(function(e){a.push(e.toString(),s(e))}),a}function c(e,t){"undefined"==typeof x[e]&&(x[e]=[]),x[e].push(t)}function d(e){return"undefined"==typeof x[e]&&(x[e]=[]),x[e]}function l(){return x}e.push=t,e.all=a,e.remove=n,e.clear=i,e.get=s,e.getLayerItems=r,e.pushStageLayer=c,e.getLayerIds=d,e.getAllLayer=l}(S=e.items||(e.items={}));var I;a(),e.getId=n,e.resetId=u,e.renderStage=f;var L,N=!1;d.addEventListener("resize",function(){N&&clearTimeout(L),N=!0,L=setTimeout(function(){N=!1,f(r.data.activeStageLayer)},100)});var B=function(){function e(e,t,a){this.gridPos=e,this.eventName=t,this.mousePos=a}return e}();e.gridDetail=B,e.getMousePosFromCenterAndSize=m,e.scrollX=0,e.scrollY=0,e.scrollBeforeX=0,e.scrollBeforeY=0,e.getGridPosFromMousePos=p;var j=function(){function e(e,t,a){this.contains=e,this.id=t,this.prefab=a}return e}();e.getPrefabFromGridDetails=j,e.getPrefabFromGrid=g,e.toMousePos=h,e.toGridPos=v,e.toDrawRect=k}(n||(n={})),t.exports=n},{"./canvas":2,"./classes/list":3,"./classes/rect":5,"./classes/vector2":7,"./data":8,"./event":12,"./image":13}],21:[function(e,t,a){function n(e,t,a,n,i){var s=n||d.data.defaultBlockSize,r=i||d.data.defaultBlockSize;d.data.selectBlock=new c["default"](e,t,a,s,r),o()}function o(){d.data.selectImage=r["default"](d.data.trayItemDataURLs.get(d.data.selectBlock.blockName))}function i(e){return new Promise(function(t){var a=Object.keys(d.data.pack.blocks.getAll()),n=[],o=function(i){var s=a[i],r=document.createElement("div");r.classList.add("tray-list","tray-list-block"),r.addEventListener("mousedown",function(e){l.raiseEvent("ui_clickTray",e)});var c=document.createElement("img");c.src=u.getPackPath(d.data.defaultPackName)+d.data.pack.blocks.get(s).data.filename,c.onload=function(){c.alt=d.data.pack.blocks.get(s).data.bName,c.dataset.block=s,r.appendChild(c),n.push(r),i===a.length-1?t(n):(e(i,a.length-1),o(i+1))}};o(0)})}function s(e){return new Promise(function(t){var a=Object.keys(d.data.pack.objs.getAll()),n=[],o=function(i){var s=a[i],r=document.createElement("div");r.classList.add("tray-list","tray-list-obj"),r.addEventListener("click",function(e){l.raiseEvent("ui_clickTray",e)});var c=document.createElement("img");c.src=u.getPackPath(d.data.defaultPackName)+d.data.pack.objs.get(s).data.filename,c.onload=function(){c.alt=d.data.pack.objs.get(s).data.oName,c.dataset.block=s,r.style.width=c.style.width=d.data.pack.objs.get(s).data.width/(d.data.pack.objs.get(s).data.height/50)+"px",r.style.height=c.style.height="50px",r.appendChild(c),n.push(r),i===a.length-1?t(n):(e(i,a.length-1),o(i+1))}};o(0)})}var r=e("./image"),c=e("./classes/trayBlockDetails"),d=e("./data"),l=e("./event"),u=e("./packUtil/packManager");a.updateActiveBlock=n,a.updateSelectImage=o,a.initTrayBlock=i,a.initTrayObj=s},{"./classes/trayBlockDetails":6,"./data":8,"./event":12,"./image":13,"./packUtil/packManager":18}],22:[function(e,t,a){function n(){move(".pla-footer").set("height","100%").duration("0.5s").end()}function o(){move(".pla-footer").set("height","50px").duration("0.5s").end()}function i(){move(".pla-inspector").set("left","80%").duration("0.5s").end()}function s(){move(".pla-inspector").set("left","100%").duration("0.5s").end()}function r(){move(".loading").set("opacity",0).duration("1s").then().set("display","none").pop().end()}a.showTrayFull=n,a.hideTrayFull=o,a.showInspector=i,a.hideInspector=s,a.hideLoading=r},{}],23:[function(e,t,a){function n(e,t,a){i.style.visibility="visible",i.style.left=e.x+"px",i.style.top=e.y+"px",i.style.width=t.x+"px",i.style.height=t.y+"px",i.style.backgroundColor=a}function o(){i.style.visibility="hidden"}var i,s=e("./../initDOM");s["default"](function(){i=document.createElement("div"),i.id="guide",i.style.position="fixed",i.style.backgroundColor="rgba(240,0,0,0.6)",i.style.pointerEvents="none",document.body.appendChild(i)}),a.focus=n,a.hide=o},{"./../initDOM":14}],24:[function(e,t,a){function n(e){var t=[];return Object.keys(e).forEach(function(a){e[a].constructor==={}.constructor?(t.push('<optgroup label="'+a+'">'),t.push(n(e[a])),t.push("</optgroup>")):t.push('<option value="'+e[a]+'">'+a+"</option>")}),t.join("\n")}Object.defineProperty(a,"__esModule",{value:!0}),a["default"]=n},{}],25:[function(e,t,a){a.version="v1.0",a.author="shundroid",a.jsonPlanetVersion=.1},{}],26:[function(e,t,a){var n,o=e("./modules/data"),i=e("./modules/initDOM"),s=e("./modules/event"),r=e("./modules/elem"),c=e("./modules/util"),d=e("./modules/classes/vector2"),l=e("./modules/tray"),u=e("./modules/packUtil/packManager"),f=e("./modules/planet"),m=e("./modules/stage"),p=e("./modules/version"),g=e("./modules/evElems"),h=e("./modules/ui/anim"),v=e("./modules/editBlock"),k=e("./modules/jsonPlanet");!function(e){function t(){window.addEventListener("resize",function(){s.raiseEvent("resize",null)}),s.addEventListener("ui_clickTray",function(e){var t=e.target;if(o.data.isObjMode=t.parentElement.classList.contains("tray-list-obj"),o.data.isObjMode){var a=o.data.pack.objs.get(t.dataset.block).data;l.updateActiveBlock(t.dataset.block,a.filename,a.oName,a.width,a.height)}else{var a=o.data.pack.blocks.get(t.dataset.block).data;l.updateActiveBlock(t.dataset.block,a.filename,a.bName)}j(t.dataset.block)}),s.addEventListener("ui_downCanvas|ui_moveCanvas|ui_upCanvas|ui_hoveringCanvas",function(e,t){var a=m.getGridPosFromMousePos(new d["default"](e.clientX,e.clientY));s.raiseEvent("gridCanvas",new m.gridDetail(a,t.replace("ui_","").replace("Canvas",""),new d["default"](e.clientX,e.clientY)))}),s.addEventListener("initedPack",function(){"undefined"!=typeof o.data.pack.editor.skyboxMode&&"repeat"===o.data.pack.editor.skyboxMode&&(document.body.style.backgroundRepeat="repeat","undefined"!=typeof o.data.pack.editor.skyboxSize?document.body.style.backgroundSize=o.data.pack.editor.skyboxSize:document.body.style.backgroundSize="auto"),r.forEachforQuery(".pack-select",function(e){var t=e;t.innerHTML=c["default"](o.data.pack[t.dataset.items].toSimple())}),document.getElementById("stg-skybox").value=o.data.pack.editor.defaultSkybox})}function a(){e.canvas=document.getElementById("pla-canvas"),e.canvas.addEventListener("mousedown",function(e){s.raiseEvent("ui_downCanvas",e)}),e.canvas.addEventListener("mousemove",function(e){1===e.buttons?s.raiseEvent("ui_moveCanvas",e):s.raiseEvent("ui_hoveringCanvas",e)}),e.canvas.addEventListener("mouseup",function(e){s.raiseEvent("ui_upCanvas",e)})}function n(e){o.data.isFullscreenTray?(h.hideTrayFull(),e.target.textContent="↑"):(y(),h.showTrayFull(),e.target.textContent="↓"),o.data.isFullscreenTray=!o.data.isFullscreenTray}function y(){o.data.isShowInspector&&(o.data.isShowInspector=!1,h.hideInspector())}function b(e){document.querySelector(".ins-article-active")&&document.querySelector(".ins-article-active").classList.remove("ins-article-active"),document.getElementById("ins-"+e).classList.add("ins-article-active"),o.data.isShowInspector||(o.data.isShowInspector=!0,h.showInspector())}function w(){document.getElementById("pla-io").value=JSON.stringify(f.toJsonPlanet().exportJson())}function E(){var e=f.fromJsonPlanet(k.jsonPlanet.importJson(JSON.parse(document.getElementById("pla-io").value)));m.stageEffects=e,S(u.getPackPath(o.data.defaultPackName)+o.data.pack.skyboxes.get(e.skyboxes[0]).data.filename),m.renderStage(0)}function P(e){b(e.target.dataset.ins)}function x(e){var t=e.target;return"I"===t.nodeName&&(t=t.parentElement),t.classList.contains("tool-btn")?void s.raiseEvent("clickTrayToolbtn",t.dataset.toolname):(document.getElementsByClassName("tool-active")[0].classList.remove("tool-active"),t.classList.add("tool-active"),void(o.data.activeToolName=t.dataset.toolname))}function S(e){document.body.style.backgroundImage="url('"+e+"')"}function I(){return new Promise(function(e){l.initTrayBlock(function(e,t){N("loading tray-block : "+e.toString()+" / "+t.toString())}).then(function(t){t.forEach(function(e){document.getElementsByClassName("tray-items")[0].appendChild(e)}),e()})})}function L(){return new Promise(function(e){l.initTrayObj(function(e,t){N("loading tray-obj : "+e.toString()+" / "+t.toString())}).then(function(t){t.forEach(function(e){document.getElementsByClassName("tray-items")[0].appendChild(e)}),e()})})}function N(e){document.getElementsByClassName("loading")[0].innerHTML="Loading...<br />"+e}function B(){h.hideLoading()}function j(e){document.querySelector(".tray-active")&&document.querySelector(".tray-active").classList.remove("tray-active"),document.querySelector('[data-block="'+e+'"]').classList.add("tray-active")}function A(){document.getElementById("conv-new").value=JSON.stringify(k.jsonPlanet.fromCSV(document.getElementById("conv-old").value).exportJson())}function M(e){m.stageEffects.skyboxes[o.data.activeStageLayer]=e.target.value,S(u.getPackPath(o.data.defaultPackName)+o.data.pack.skyboxes.get(m.stageEffects.skyboxes[o.data.activeStageLayer]).data.filename)}function O(){var e=m.blockAttrs.getMaxAttrId(o.data.editingBlockId);m.blockAttrs.push(o.data.editingBlockId,e,new m.Attr),v.renderAttributeUI(e)}function C(e){m.changeActiveStageLayer(parseInt(e.target.value)),"undefined"==typeof m.stageEffects.skyboxes[o.data.activeStageLayer]&&(m.stageEffects.skyboxes[o.data.activeStageLayer]=o.data.pack.editor.defaultSkybox),S(u.getPackPath(o.data.defaultPackName)+o.data.pack.skyboxes.get(m.stageEffects.skyboxes[o.data.activeStageLayer]).data.filename),document.getElementById("stg-skybox").value=m.stageEffects.skyboxes[o.data.activeStageLayer]}i["default"](function(){g["default"](e),document.getElementById("pla-ver").innerHTML="Planet "+p.version+" by "+p.author,r.addEventListenerforQuery(".ins-show-btn","click",P),r.addEventListenerforQuery(".tray-list-tool","mousedown",x);var t=document.createElement("script");t.src="bower_components/move.js/move.js",document.head.appendChild(t),window.onbeforeunload=function(e){e.returnValue="ページを移動しますか？"},s.raiseEvent("initDom",null)}),e.setupCanvas=a,e.togglefullScreen=n,e.closeInspector=y,e.showInspector=b,e.clickExport=w,e.clickImport=E,e.clickInsShowBtn=P,e.clickTrayTool=x,e.setSkybox=S,e.initTrayBlock=I,e.initTrayObj=L,e.changeLoadingStatus=N,e.hideLoading=B,e.changeActiveBlock=j,s.addEventListener("clickTrayToolbtn",function(t){var a={io:"io",setting:"inspector"};e.showInspector(a[t])}),e.clickConvertOldFile=A,e.changeSkybox=M,e.clickAddAttr=O,e.changeActiveStageLayer=C,t()}(n||(n={})),t.exports=n},{"./modules/classes/vector2":7,"./modules/data":8,"./modules/editBlock":9,"./modules/elem":10,"./modules/evElems":11,"./modules/event":12,"./modules/initDOM":14,"./modules/jsonPlanet":15,"./modules/packUtil/packManager":18,"./modules/planet":19,"./modules/stage":20,"./modules/tray":21,"./modules/ui/anim":22,"./modules/util":24,"./modules/version":25}]},{},[1]);