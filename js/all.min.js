!function e(t,n,a){function o(s,r){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!r&&c)return c(s,!0);if(i)return i(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return o(n?n:e)},l,l.exports,e,t,n,a)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<a.length;s++)o(a[s]);return o}({1:[function(e,t,n){var a,o=e("./ui"),i=e("./modules/initDOM"),s=e("./modules/packUtil/packLoader"),r=e("./modules/packUtil/packManager"),c=e("./modules/event"),d=e("./modules/stage"),l=e("./modules/model/stageEffectsModel"),u=e("./modules/model/stageItemsModel"),f=e("./modules/data"),m=e("./modules/makePrefabDataUrls"),p=e("./modules/tray"),g=e("./modules/classes/prefab"),v=e("./modules/classes/vector2"),h=e("./modules/classes/rect"),k=e("./modules/canvas"),y=e("./modules/editBlock"),b=e("./modules/ui/focusGuide"),E=e("./modules/model/editorModel"),w=e("./modules/view/stageRenderView"),I=e("./modules/model/packModel"),M=e("./modules/model/trayModel"),P=e("./modules/model/preferencesModel");!function(e){function t(){f.data.dataInit()}t(),i["default"](function(){o.setupCanvas(),s["default"](P.currentPackName).then(function(e){I.setPack(new r.packModule(e)),c.raiseEvent("packLoaded",null),l.stageEffects.skyboxes=[I.pack.editor.defaultSkybox],o.setSkybox(r.getPackPath(P.currentPackName)+I.pack.skyboxes.get(I.pack.editor.defaultSkybox).data.filename),c.raiseEvent("initedPack",null),c.raiseEvent("initedUI",null),o.initTrayBlock().then(function(){o.initTrayObj().then(function(){c.raiseEvent("initedTray",null)})})}),c.addEventListener("initedTray",function(){o.changeLoadingStatus("making DataURL"),f.data.trayItemDataURLs=m["default"]();var e=I.pack.blocks.get(I.pack.editor.defaultBlock);p.updateActiveBlock(I.pack.editor.defaultBlock,e.data.filename,e.data.bName),o.changeLoadingStatus("Are you ready?"),c.raiseEvent("ready",null)}),c.addEventListener("ready",function(){o.hideLoading()}),c.addEventListener("gridCanvas",function(e){var t=new g["default"](e.gridPos.x,e.gridPos.y,M.activeBlock.fileName,M.activeBlock.blockName,d.toGridPos(M.activeBlock.width),d.toGridPos(M.activeBlock.height)),n=d.getPrefabFromGrid(new v["default"](t.gridX,t.gridY),E.activeStageLayerInEditor),a=d.toDrawRect(new h["default"](t.gridX,t.gridY,t.gridW,t.gridH));switch(b.hide(),f.data.activeToolName){case"pencil":"down"===e.eventName?n.contains?(u.remove(n.id,E.activeStageLayerInEditor),w["default"](E.activeStageLayerInEditor)):(k.render(M.activeBlockImage,a),u.push(u.getId(),t,E.activeStageLayerInEditor)):"hovering"===e.eventName&&b.focus(new v["default"](a.x,a.y),new v["default"](a.width,a.height),n.contains?"rgba(240,0,0,0.6)":"rgba(0,240,0,0.6)");break;case"choice":if("down"===e.eventName&&n.prefab){if(I.pack.objs.contains(n.prefab.blockName)){var i=I.pack.objs.get(n.prefab.blockName);p.updateActiveBlock(n.prefab.blockName,i.data.oName,r.getPackPath(P.currentPackName)+i.data.filename,i.data.width,i.data.height)}else{var s=I.pack.blocks.get(n.prefab.blockName);p.updateActiveBlock(n.prefab.blockName,s.data.bName,r.getPackPath(P.currentPackName)+s.data.filename)}o.changeActiveBlock(n.prefab.blockName)}break;case"hand":"move"===e.eventName&&(d.scrollX+=e.mousePos.x-d.scrollBeforeX,d.scrollY+=e.mousePos.y-d.scrollBeforeY,w["default"](E.activeStageLayerInEditor)),d.scrollBeforeX=e.mousePos.x,d.scrollBeforeY=e.mousePos.y;break;case"edit":"down"===e.eventName&&n.contains&&(o.showInspector("edit-block"),f.data.editingBlockId=n.id,y.updateEditBlock(new y.EditBlock(n.prefab.blockName,new v["default"](n.prefab.gridX,n.prefab.gridY),n.id)));break;default:("move"===e.eventName||"down"===e.eventName)&&("brush"===f.data.activeToolName?(n.contains&&n.prefab.blockName!==M.activeBlock.blockName&&(u.remove(n.id,E.activeStageLayerInEditor),w["default"](E.activeStageLayerInEditor)),n.contains||(k.render(M.activeBlockImage,a),u.push(u.getId(),t,E.activeStageLayerInEditor))):"erase"===f.data.activeToolName&&n.contains&&(u.remove(n.id,E.activeStageLayerInEditor),w["default"](E.activeStageLayerInEditor)))}})})}(a||(a={})),t.exports=a},{"./modules/canvas":2,"./modules/classes/prefab":4,"./modules/classes/rect":5,"./modules/classes/vector2":7,"./modules/data":8,"./modules/editBlock":9,"./modules/event":12,"./modules/initDOM":14,"./modules/makePrefabDataUrls":16,"./modules/model/editorModel":17,"./modules/model/packModel":18,"./modules/model/preferencesModel":19,"./modules/model/stageEffectsModel":21,"./modules/model/stageItemsModel":22,"./modules/model/trayModel":23,"./modules/packUtil/packLoader":24,"./modules/packUtil/packManager":25,"./modules/stage":27,"./modules/tray":28,"./modules/ui/focusGuide":30,"./modules/view/stageRenderView":33,"./ui":34}],2:[function(e,t,n){function a(){r.width=window.innerWidth,r.height=window.innerHeight,n.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight}}function o(e,t){c.drawImage(e,t.x,t.y,t.width,t.height)}function i(e){c.clearRect(e.x,e.y,e.width,e.height)}function s(){c.clearRect(0,0,r.width,r.height)}var r,c,d=e("./initDOM");d["default"](function(){r=document.getElementById("pla-canvas"),n.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight},a(),r&&r.getContext&&(c=r.getContext("2d"),c.imageSmoothingEnabled=!1,c.mozImageSmoothingEnabled=!1,c.webkitImageSmoothingEnabled=!1,c.msImageSmoothingEnabled=!1)}),window.addEventListener("resize",a),n.render=o,n.clearByRect=i,n.clear=s},{"./initDOM":14}],3:[function(e,t,n){var a=function(){function e(){this.data={}}return e.prototype.push=function(e,t){this.data[e]=t},e.prototype.update=function(e,t){this.data[e]=t},e.prototype.get=function(e){return this.data[e]},e.prototype.getAll=function(){return this.data},e.prototype.remove=function(e){delete this.data[e]},e.prototype.clear=function(){this.data={}},e.prototype.contains=function(e){return this.data.hasOwnProperty(e)},e.prototype.toSimple=function(){return this.data},e}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a},{}],4:[function(e,t,n){var a=function(){function e(e,t,n,a,o,i){this.gridX=e,this.gridY=t,this.fileName=n,this.blockName=a,this.gridW=o,this.gridH=i}return e}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a},{}],5:[function(e,t,n){var a=function(){function e(e,t,n,a){this.x=e,this.y=t,this.width=n,this.height=a}return e}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a},{}],6:[function(e,t,n){var a=function(){function e(e,t,n,a,o){this.blockName=e,this.fileName=t,this.label=n,this.width=a,this.height=o}return e}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a},{}],7:[function(e,t,n){var a=function(){function e(e,t){this.x=e,this.y=t}return Object.defineProperty(e,"zero",{get:function(){return new e(0,0)},enumerable:!0,configurable:!0}),e}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a},{}],8:[function(e,t,n){var a=e("./classes/list"),o=e("./model/editorModel"),i=e("./model/preferencesModel"),s=function(){function e(){}return e.dataInit=function(){this.trayItemDataURLs=new a["default"],i.setDefaultValues(),this.activeToolName="pencil",this.isObjMode=!1,this.isFullscreenTray=!1,this.isShowInspector=!1,o.setActiveStageLayer(0)},e}();n.data=s},{"./classes/list":3,"./model/editorModel":17,"./model/preferencesModel":19}],9:[function(e,t,n){function a(e){m=e,i()}function o(){return m}function i(){if(document.getElementById("ed-name").textContent="Name: "+m.blockName,document.getElementById("ed-pos").textContent="Pos: "+m.blockPos.x+", "+m.blockPos.y,document.getElementById("ed-id").textContent="ID: "+m.blockId,document.getElementsByClassName("ed-attr-view")[0].innerHTML="",u.containsBlock(l.data.editingBlockId)){var e=u.getBlock(l.data.editingBlockId);Object.keys(e).forEach(function(e){var t=u.getAttr(l.data.editingBlockId,parseInt(e));s(parseInt(e),t.attrName,t.attrVal)})}}function s(e,t,n){var a=document.createElement("section");a.id="ed-attr-field-"+e;var o=document.createElement("input");o.type="text",o.id="ed-attr-name-"+e,o.classList.add("ed-attr-name"),o.placeholder="name","undefined"!=typeof t&&(o.value=t),o.addEventListener("keydown",c);var i=document.createElement("input");i.type="text",i.id="ed-attr-"+e,i.classList.add("ed-attr-val"),i.placeholder="value","undefined"!=typeof n&&(i.value=n),i.addEventListener("keydown",r);var s=document.createElement("button");s.innerHTML='<i class="fa fa-minus"></i>',s.classList.add("pla-btn"),s.id="ed-attr-remove-"+e,s.addEventListener("click",d),a.appendChild(s),a.appendChild(o),a.appendChild(document.createTextNode(":")),a.appendChild(i),document.getElementsByClassName("ed-attr-view")[0].appendChild(a)}function r(e){console.log("hg!!"),u.update(l.data.editingBlockId,parseInt(e.target.id.replace("ed-attr-","")),{attrVal:e.target.value})}function c(e){u.update(l.data.editingBlockId,parseInt(e.target.id.replace("ed-attr-name-","")),{attrName:e.target.value})}function d(e){var t=parseInt(e.target.id.replace("ed-attr-remove-",""));u.removeAttr(l.data.editingBlockId,t),document.getElementsByClassName("ed-attr-view")[0].removeChild(document.getElementById("ed-attr-field-"+t))}var l=e("./data"),u=e("./model/stageAttrsModel"),f=function(){function e(e,t,n){this.blockName=e,this.blockPos=t,this.blockId=n}return e}();n.EditBlock=f;var m;n.updateEditBlock=a,n.getCurrentEditBlock=o,n.updateEditBlockUI=i,n.renderAttributeUI=s,n.changeAttrVal=r,n.changeAttrName=c,n.clickRemoveAttr=d},{"./data":8,"./model/stageAttrsModel":20}],10:[function(e,t,n){function a(e,t,n){o(e,function(e){e.addEventListener(t,n)})}function o(e,t){Array.prototype.forEach.call(document.querySelectorAll(e),t)}n.addEventListenerforQuery=a,n.forEachforQuery=o},{}],11:[function(e,t,n){function a(e){o.forEachforQuery(".ev-btn",function(t){t.addEventListener("click",e[t.dataset.listener])}),o.forEachforQuery(".ev-input",function(t){var n=t;"undefined"!=typeof n.dataset["default"]&&(n.value=n.dataset["default"]),"undefined"!=typeof n.dataset.change&&n.addEventListener("change",e[n.dataset.change])})}var o=e("./elem");Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a},{"./elem":10}],12:[function(e,t,n){function a(e,t){-1!==e.indexOf("|")?e.split("|").forEach(function(e){a(e,t)}):s.contains(e)?s.get(e).push(t):s.push(e,[t])}function o(e,t){s.contains(e)&&s.get(e).forEach(function(n){n(t,e)})}var i=e("./classes/list"),s=new i["default"];n.addEventListener=a,n.raiseEvent=o},{"./classes/list":3}],13:[function(e,t,n){function a(e,t,n){var o=new Image;if(o.src=e,t){var i,s,r=(o.width+n.x)/2,c=(o.height+n.y)/2;return i=document.createElement("canvas"),i.width=r,i.height=c,s=i.getContext("2d"),s.drawImage(o,0,0,r,c),a(i.toDataURL("image/png"))}return o}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a},{}],14:[function(e,t,n){function a(e){o.push(e)}var o=new Array;Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a,document.addEventListener("DOMContentLoaded",function(){o.forEach(function(e){e()})})},{}],15:[function(e,t,n){var a=e("./version"),o=function(){function e(e,t,n,a,o){this.blockName=e,this.posX=t,this.posY=n,this.name=a,this.attr=o}return e.prototype.toArray=function(){var e=[this.blockName,this.posX,this.posY];return"undefined"!=typeof this.name?e.push(this.name):e.push(""),"undefined"!=typeof this.attr&&e.push(this.attr),e},e.fromArray=function(t){var n=new e(t[0],t[1],t[2],t[3]);return"undefined"!=typeof t[4]&&(n.attr=t[4]),n},e}();n.jsonBlockItem=o;var i=function(){function e(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=[]),this.jsonPlanetVersion=e,this.stage=t,this.skyboxes=n}return e.prototype.exportJson=function(){var e={};e.jsonPlanetVersion=this.jsonPlanetVersion,this.skyboxes!==[]&&(e.skyboxes=this.skyboxes),e.stage=[];for(var t=0;t<this.stage.length;t++)e.stage[t]=[],this.stage[t].forEach(function(n){e.stage[t].push(n.toArray())});return e},e.importJson=function(t){for(var n=new e(t.jsonPlanetVersion||a.jsonPlanetVersion),i=t.stage,s=0;s<i.length;s++)n.stage[s]=[],i[s].forEach(function(e){n.stage[s].push(o.fromArray(e))});var r=t.skyboxes,c=0;return r.forEach(function(e){n.skyboxes[c++]=e}),n},e.fromCSV=function(t){var n=new e(a.jsonPlanetVersion,[[]]),i=t.split("\n");return i.forEach(function(e){if(""!==e&&"*"!==e.substring(0,1)&&"//"!==e.substring(0,2)){var t=e.split("="),a=t[0].split(",");n.stage[0].push(new o(a[0],parseInt(a[1]),parseInt(a[2]),t[1]))}}),n},e}();n.jsonPlanet=i},{"./version":32}],16:[function(e,t,n){function a(){var e=new o["default"],t=c.pack.blocks.getAll();Object.keys(t).forEach(function(t){e.push(t,r["default"](i.getPackPath(d.currentPackName)+c.pack.blocks.get(t).data.filename,!0,new s["default"](d.defaultGridSize,d.defaultGridSize)).src)});var n=c.pack.objs.getAll();return Object.keys(n).forEach(function(t){var n=c.pack.objs.get(t).data;e.push(t,r["default"](i.getPackPath(d.currentPackName)+n.filename,!0,new s["default"](n.width,n.height)).src)}),e}var o=e("./classes/list"),i=e("./packUtil/packManager"),s=e("./classes/vector2"),r=e("./image"),c=e("./model/packModel"),d=e("./model/preferencesModel");Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a},{"./classes/list":3,"./classes/vector2":7,"./image":13,"./model/packModel":18,"./model/preferencesModel":19,"./packUtil/packManager":25}],17:[function(e,t,n){function a(e){n.activeStageLayerInEditor=e}function o(e){n.isTrayFullscreen=e}function i(e){n.isVisibleInspector=e}function s(e){n.editingBlockIdByInspector=e}function r(e){n.isObjModeInEditor=e}function c(){n.activeStageLayerInEditor=0,n.isTrayFullscreen=!1,n.isObjModeInEditor=!1,n.isVisibleInspector=!1}n.setActiveStageLayer=a,n.setIsTrayFullscreen=o,n.setIsVisibleInspector=i,n.setEditingBlockId=s,n.setIsObjMode=r,n.setDefaultValues=c},{}],18:[function(e,t,n){function a(e){n.pack=e}n.setPack=a},{}],19:[function(e,t,n){function a(e){n.currentPackName=e}function o(e){n.defaultGridSize=e}function i(e){n.defaultBlockSize=e}function s(){n.currentPackName="oa",n.defaultGridSize=25,n.defaultBlockSize=50}n.setCurrentPackName=a,n.setDefaultGridSize=o,n.setDefaultBlockSize=i,n.setDefaultValues=s},{}],20:[function(e,t,n){function a(e){h=e}function o(e,t,n){"undefined"==typeof h[e]&&(h[e]={}),h[e][t]=n}function i(e,t,n){if(n instanceof v)h[e][t]=n;else{var a=h[e][t];"undefined"!=typeof n.attrName&&(a.attrName=n.attrName),"undefined"!=typeof n.attrVal&&(a.attrVal=n.attrVal),h[e][t]=a}}function s(e,t){return"undefined"==typeof h[e]?!1:"undefined"!=typeof h[e][t]}function r(e){return"undefined"!=typeof h[e]}function c(e,t){delete h[e][t]}function d(e){delete h[e]}function l(e){return h[e]}function u(e,t){return h[e][t]}function f(){return h}function m(){h={}}function p(e){return"undefined"==typeof h[e]?0:Object.keys(h[e]).length}function g(){h={}}var v=function(){function e(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this.attrName=e,this.attrVal=t}return e}();n.Attr=v;var h;n.setAll=a,n.push=o,n.update=i,n.containsAttr=s,n.containsBlock=r,n.removeAttr=c,n.removeBlock=d,n.getBlock=l,n.getAttr=u,n.getAll=f,n.clear=m,n.getMaxAttrId=p,n.init=g},{}],21:[function(e,t,n){function a(e){n.stageEffects=e}var o=function(){function e(){this.skyboxes=[""]}return e}();n.StageEffects=o,n.stageEffects=new o,n.setStageEffects=a},{}],22:[function(e,t,n){function a(e,t,n){void 0===n&&(n=0),g[e]=t,d(n,e)}function o(){return g}function i(e,t){v[t].splice(v[t].indexOf(e),1),delete g[e]}function s(){g={}}function r(e){return g[e]}function c(e){var t=l(e),n=new h["default"];return t.forEach(function(e){n.push(e.toString(),r(e))}),n}function d(e,t){"undefined"==typeof v[e]&&(v[e]=[]),v[e].push(t)}function l(e){return"undefined"==typeof v[e]&&(v[e]=[]),v[e]}function u(){return v}function f(){return k++}function m(){k=0}function p(){g={},v=new Array,k=0}var g,v,h=e("./../classes/list");n.push=a,n.all=o,n.remove=i,n.clear=s,n.get=r,n.getLayerItems=c,n.pushStageLayer=d,n.getLayerIds=l,n.getAllLayer=u;var k;n.getId=f,n.resetId=m,n.init=p},{"./../classes/list":3}],23:[function(e,t,n){function a(e){n.activeBlock=e}function o(e){n.activeBlockImage=e}function i(e){}function s(e){}function r(){n.activeToolName="pencil",n.trayBlockDataUrls={}}n.setActiveBlock=a,n.setActiveBlockImage=o,n.setActiveToolName=i,n.setTrayBlockDataUrls=s,n.setDefaultValues=r},{}],24:[function(e,t,n){function a(e){return new Promise(function(t){var n=new XMLHttpRequest;n.open("GET",o.getPackPath(e)+"packinfo.json"),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&t(JSON.parse(n.responseText))},n.send(null)})}var o=e("./../packUtil/packManager");Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a},{"./../packUtil/packManager":25}],25:[function(e,t,n){function a(e){return"pack/"+e+"/"}var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("./../classes/list");n.getPackPath=a;var s=function(){function e(e){var t=this;this.pack=new c(e.pack),this.blocks=new i["default"],Object.keys(e.blocks).forEach(function(n){t.blocks.push(n,new l({bName:e.blocks[n].name,filename:e.blocks[n].filename}))}),this.objs=new i["default"],Object.keys(e.objs).forEach(function(n){var a=e.objs[n];a.hidden?t.objs.push(n,new u({oName:a.name,filename:a.filename,width:a.width,height:a.height,type:a.type})):t.objs.push(n,new u({oName:a.name,filename:a.filename,width:a.width,height:a.height,type:a.type,hidden:a.hidden}))}),this.descriptions=new i["default"],Object.keys(e.descriptions).forEach(function(n){var a=e.descriptions[n];t.descriptions.push(n,new f(a))}),this.skyboxes=new p,Object.keys(e.skyboxes).forEach(function(n){t.skyboxes.push(n,new m(e.skyboxes[n]))}),this.editor=e.editor}return e}();n.packModule=s;var r=function(){function e(e,t,n,a){this.defaultSkybox=e,this.defaultBlock=t,this.skyboxMode=n,this.skyboxSize=a}return e}();n.packEditorInfo=r;var c=function(){function e(e){this.pName=e.name,this.version=e.version,this.author=e.author,this.exportType=e.exportType}return e}();n.packInfo=c;var d=function(){function e(e){this.data=e}return e}();n.packItem=d;var l=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(d);n.blockInfo=l;var u=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(d);n.objInfo=u;var f=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(d);n.desInfo=f;var m=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(d);n.skyboxInfo=m;var p=function(e){function t(){e.call(this)}return o(t,e),t.prototype.toSimple=function(){var e=this,t={};return Object.keys(this.getAll()).forEach(function(n){t[e.get(n).data.label]=n}),t},t}(i["default"]);n.skyboxInfoList=p},{"./../classes/list":3}],26:[function(e,t,n){function a(){var e=new l.jsonPlanet(u.jsonPlanetVersion);Object.keys(s.stageEffects.skyboxes).forEach(function(t){e.skyboxes.push(s.stageEffects.skyboxes[parseInt(t)])});for(var t=r.getAllLayer(),n=0;n<t.length;n++)e.stage[n]=[],t[n].forEach(function(t){var a=r.get(t);if(c.containsBlock(t)){var o={},i=c.getBlock(t);Object.keys(i).forEach(function(e){o[i[parseInt(e)].attrName]=i[parseInt(e)].attrVal}),e.stage[n].push(new l.jsonBlockItem(a.blockName,a.gridX,a.gridY,t.toString(),o))}else e.stage[n].push(new l.jsonBlockItem(a.blockName,a.gridX,a.gridY,t.toString()))});return e}function o(e){r.clear(),c.clear(),r.resetId();for(var t=0;t<e.stage.length;t++)e.stage[t].forEach(function(e){var n=r.getId();if(m.pack.objs.contains(e.blockName)){var a=m.pack.objs.get(e.blockName);r.push(n,new d["default"](e.posX,e.posY,a.data.filename,e.blockName,i.toGridPos(a.data.width),i.toGridPos(a.data.height)),t)}else{var o=m.pack.blocks.get(e.blockName);r.push(n,new d["default"](e.posX,e.posY,o.data.filename,e.blockName,i.toGridPos(p.defaultBlockSize),i.toGridPos(p.defaultBlockSize)),t)}"undefined"!=typeof e.attr&&Object.keys(e.attr).forEach(function(t){c.push(n,c.getMaxAttrId(n),new c.Attr(t,e.attr[t]))})});f.setActiveStageLayer(0);var n=new s.StageEffects;return n.skyboxes=e.skyboxes,n}var i=e("./stage"),s=e("./model/stageEffectsModel"),r=e("./model/stageItemsModel"),c=e("./model/stageAttrsModel"),d=e("./classes/prefab"),l=e("./jsonPlanet"),u=e("./version"),f=e("./model/editorModel"),m=e("./model/packModel"),p=e("./model/preferencesModel");n.toJsonPlanet=a,n.fromJsonPlanet=o},{"./classes/prefab":4,"./jsonPlanet":15,"./model/editorModel":17,"./model/packModel":18,"./model/preferencesModel":19,"./model/stageAttrsModel":20,"./model/stageEffectsModel":21,"./model/stageItemsModel":22,"./stage":27,"./version":32}],27:[function(e,t,n){var a,o=e("./classes/rect"),i=e("./event"),s=e("./classes/vector2"),r=e("./model/stageAttrsModel"),c=e("./model/stageItemsModel"),d=e("./model/editorModel"),l=e("./view/stageRenderView"),u=e("./model/preferencesModel");!function(e){function t(e){d.setActiveStageLayer(e),l["default"](e)}function n(){c.init(),r.init()}function a(e,t){return e-(t-u.defaultGridSize)/2}function f(t){var n=t.x-e.scrollX,a=t.y-e.scrollY,o=n-n%u.defaultGridSize,i=a-a%u.defaultGridSize,r=o/u.defaultGridSize,c=i/u.defaultGridSize;return new s["default"](r,c)}function m(e,t){var n=new b(!1,-1,null),a={};try{Object.keys(c.getLayerItems(t).getAll()).forEach(function(t){var o=c.get(parseInt(t));if(e.x>=o.gridX&&e.x<o.gridX+o.gridW&&e.y>=o.gridY&&e.y<o.gridY+o.gridH)throw n=new b(!0,parseInt(t),o),a})}catch(o){if(o!==a)throw o}return n}function p(e){return e*u.defaultGridSize}function g(e){return(e-e%u.defaultGridSize)/u.defaultGridSize}function v(t){return new o["default"](e.scrollX+a(p(t.x),p(t.width)),e.scrollY+a(p(t.y),p(t.height)),p(t.width),p(t.height))}e.changeActiveStageLayer=t,n();var h,k=!1;i.addEventListener("resize",function(){k&&clearTimeout(h),k=!0,h=setTimeout(function(){k=!1,l["default"](d.activeStageLayerInEditor)},100)});var y=function(){function e(e,t,n){this.gridPos=e,this.eventName=t,this.mousePos=n}return e}();e.gridDetail=y,e.getMousePosFromCenterAndSize=a,e.scrollX=0,e.scrollY=0,e.scrollBeforeX=0,e.scrollBeforeY=0,e.getGridPosFromMousePos=f;var b=function(){function e(e,t,n){this.contains=e,this.id=t,this.prefab=n}return e}();e.getPrefabFromGridDetails=b,e.getPrefabFromGrid=m,e.toMousePos=p,e.toGridPos=g,e.toDrawRect=v}(a||(a={})),t.exports=a},{"./classes/rect":5,"./classes/vector2":7,"./event":12,"./model/editorModel":17,"./model/preferencesModel":19,"./model/stageAttrsModel":20,"./model/stageItemsModel":22,"./view/stageRenderView":33}],28:[function(e,t,n){function a(e,t,n,a,i){var s=a||p.defaultBlockSize,r=i||p.defaultBlockSize;m.setActiveBlock(new c["default"](e,t,n,s,r)),o()}function o(){m.setActiveBlockImage(r["default"](d.data.trayItemDataURLs.get(m.activeBlock.blockName)))}function i(e){return new Promise(function(t){var n=Object.keys(f.pack.blocks.getAll()),a=[],o=function(i){var s=n[i],r=document.createElement("div");r.classList.add("tray-list","tray-list-block"),r.addEventListener("mousedown",function(e){l.raiseEvent("ui_clickTray",e)});var c=document.createElement("img");c.src=u.getPackPath(p.currentPackName)+f.pack.blocks.get(s).data.filename,c.onload=function(){c.alt=f.pack.blocks.get(s).data.bName,c.dataset.block=s,r.appendChild(c),a.push(r),i===n.length-1?t(a):(e(i,n.length-1),o(i+1))}};o(0)})}function s(e){return new Promise(function(t){var n=Object.keys(f.pack.objs.getAll()),a=[],o=function(i){var s=n[i],r=document.createElement("div");r.classList.add("tray-list","tray-list-obj"),r.addEventListener("click",function(e){l.raiseEvent("ui_clickTray",e)});var c=document.createElement("img");c.src=u.getPackPath(p.currentPackName)+f.pack.objs.get(s).data.filename,c.onload=function(){c.alt=f.pack.objs.get(s).data.oName,c.dataset.block=s,r.style.width=c.style.width=f.pack.objs.get(s).data.width/(f.pack.objs.get(s).data.height/50)+"px",r.style.height=c.style.height="50px",r.appendChild(c),a.push(r),i===n.length-1?t(a):(e(i,n.length-1),o(i+1))}};o(0)})}var r=e("./image"),c=e("./classes/trayBlockDetails"),d=e("./data"),l=e("./event"),u=e("./packUtil/packManager"),f=e("./model/packModel"),m=e("./model/trayModel"),p=e("./model/preferencesModel");n.updateActiveBlock=a,n.updateSelectImage=o,n.initTrayBlock=i,n.initTrayObj=s},{"./classes/trayBlockDetails":6,"./data":8,"./event":12,"./image":13,"./model/packModel":18,"./model/preferencesModel":19,"./model/trayModel":23,"./packUtil/packManager":25}],29:[function(e,t,n){function a(){move(".pla-footer").set("height","100%").duration("0.5s").end()}function o(){move(".pla-footer").set("height","50px").duration("0.5s").end()}function i(){move(".pla-inspector").set("left","80%").duration("0.5s").end()}function s(){move(".pla-inspector").set("left","100%").duration("0.5s").end()}function r(){move(".loading").set("opacity",0).duration("1s").then().set("display","none").pop().end()}n.showTrayFull=a,n.hideTrayFull=o,n.showInspector=i,n.hideInspector=s,n.hideLoading=r},{}],30:[function(e,t,n){function a(e,t,n){i.style.visibility="visible",i.style.left=e.x+"px",i.style.top=e.y+"px",i.style.width=t.x+"px",i.style.height=t.y+"px",i.style.backgroundColor=n}function o(){i.style.visibility="hidden"}var i,s=e("./../initDOM");s["default"](function(){i=document.createElement("div"),i.id="guide",i.style.position="fixed",i.style.backgroundColor="rgba(240,0,0,0.6)",i.style.pointerEvents="none",document.body.appendChild(i)}),n.focus=a,n.hide=o},{"./../initDOM":14}],31:[function(e,t,n){function a(e){var t=[];return Object.keys(e).forEach(function(n){e[n].constructor==={}.constructor?(t.push('<optgroup label="'+n+'">'),t.push(a(e[n])),t.push("</optgroup>")):t.push('<option value="'+e[n]+'">'+n+"</option>")}),t.join("\n")}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a},{}],32:[function(e,t,n){n.version="v1.0",n.author="shundroid",n.jsonPlanetVersion=.1},{}],33:[function(e,t,n){function a(e){void 0===e&&(e=0),i.clear();var t=s.getLayerItems(e).getAll();Object.keys(t).forEach(function(e){var t=s.get(parseInt(e)),n=o.scrollX+o.getMousePosFromCenterAndSize(o.toMousePos(t.gridX),o.toMousePos(t.gridW)),a=o.scrollY+o.getMousePosFromCenterAndSize(o.toMousePos(t.gridY),o.toMousePos(t.gridH)),l=o.toMousePos(t.gridW),u=o.toMousePos(t.gridH);n+l>=0&&n<=i.canvasRect.width&&a+u>=0&&a<=i.canvasRect.height&&i.render(c["default"](r.data.trayItemDataURLs.get(t.blockName)),new d["default"](n,a,l,u))})}var o=e("./../stage"),i=e("./../canvas"),s=e("./../model/stageItemsModel"),r=e("./../data"),c=e("./../image"),d=e("./../classes/rect");Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=a},{"./../canvas":2,"./../classes/rect":5,"./../data":8,"./../image":13,"./../model/stageItemsModel":22,"./../stage":27}],34:[function(e,t,n){var a,o=e("./modules/data"),i=e("./modules/initDOM"),s=e("./modules/event"),r=e("./modules/elem"),c=e("./modules/util"),d=e("./modules/classes/vector2"),l=e("./modules/tray"),u=e("./modules/packUtil/packManager"),f=e("./modules/planet"),m=e("./modules/stage"),p=e("./modules/model/stageEffectsModel"),g=e("./modules/model/stageAttrsModel"),v=e("./modules/version"),h=e("./modules/evElems"),k=e("./modules/ui/anim"),y=e("./modules/editBlock"),b=e("./modules/jsonPlanet"),E=e("./modules/model/editorModel"),w=e("./modules/view/stageRenderView"),I=e("./modules/model/packModel"),M=e("./modules/model/preferencesModel");!function(e){function t(){window.addEventListener("resize",function(){s.raiseEvent("resize",null)}),s.addEventListener("ui_clickTray",function(e){var t=e.target;if(o.data.isObjMode=t.parentElement.classList.contains("tray-list-obj"),o.data.isObjMode){var n=I.pack.objs.get(t.dataset.block).data;l.updateActiveBlock(t.dataset.block,n.filename,n.oName,n.width,n.height)}else{var n=I.pack.blocks.get(t.dataset.block).data;l.updateActiveBlock(t.dataset.block,n.filename,n.bName)}_(t.dataset.block)}),s.addEventListener("ui_downCanvas|ui_moveCanvas|ui_upCanvas|ui_hoveringCanvas",function(e,t){var n=m.getGridPosFromMousePos(new d["default"](e.clientX,e.clientY));s.raiseEvent("gridCanvas",new m.gridDetail(n,t.replace("ui_","").replace("Canvas",""),new d["default"](e.clientX,e.clientY)))}),s.addEventListener("initedPack",function(){"undefined"!=typeof I.pack.editor.skyboxMode&&"repeat"===I.pack.editor.skyboxMode&&(document.body.style.backgroundRepeat="repeat","undefined"!=typeof I.pack.editor.skyboxSize?document.body.style.backgroundSize=I.pack.editor.skyboxSize:document.body.style.backgroundSize="auto"),r.forEachforQuery(".pack-select",function(e){var t=e;t.innerHTML=c["default"](I.pack[t.dataset.items].toSimple())}),document.getElementById("stg-skybox").value=I.pack.editor.defaultSkybox})}function n(){e.canvas=document.getElementById("pla-canvas"),e.canvas.addEventListener("mousedown",function(e){s.raiseEvent("ui_downCanvas",e)}),e.canvas.addEventListener("mousemove",function(e){1===e.buttons?s.raiseEvent("ui_moveCanvas",e):s.raiseEvent("ui_hoveringCanvas",e)}),e.canvas.addEventListener("mouseup",function(e){s.raiseEvent("ui_upCanvas",e)})}function a(e){o.data.isFullscreenTray?(k.hideTrayFull(),e.target.textContent="↑"):(P(),k.showTrayFull(),e.target.textContent="↓"),o.data.isFullscreenTray=!o.data.isFullscreenTray}function P(){o.data.isShowInspector&&(o.data.isShowInspector=!1,k.hideInspector())}function S(e){document.querySelector(".ins-article-active")&&document.querySelector(".ins-article-active").classList.remove("ins-article-active"),document.getElementById("ins-"+e).classList.add("ins-article-active"),o.data.isShowInspector||(o.data.isShowInspector=!0,k.showInspector())}function x(){document.getElementById("pla-io").value=JSON.stringify(f.toJsonPlanet().exportJson())}function B(){var e=f.fromJsonPlanet(b.jsonPlanet.importJson(JSON.parse(document.getElementById("pla-io").value)));p.setStageEffects(e),j(u.getPackPath(M.currentPackName)+I.pack.skyboxes.get(e.skyboxes[0]).data.filename),w["default"](0)}function L(e){S(e.target.dataset.ins)}function N(e){var t=e.target;return"I"===t.nodeName&&(t=t.parentElement),t.classList.contains("tool-btn")?void s.raiseEvent("clickTrayToolbtn",t.dataset.toolname):(document.getElementsByClassName("tool-active")[0].classList.remove("tool-active"),t.classList.add("tool-active"),void(o.data.activeToolName=t.dataset.toolname))}function j(e){document.body.style.backgroundImage="url('"+e+"')"}function A(){return new Promise(function(e){l.initTrayBlock(function(e,t){C("loading tray-block : "+e.toString()+" / "+t.toString())}).then(function(t){t.forEach(function(e){document.getElementsByClassName("tray-items")[0].appendChild(e)}),e()})})}function O(){return new Promise(function(e){l.initTrayObj(function(e,t){C("loading tray-obj : "+e.toString()+" / "+t.toString())}).then(function(t){t.forEach(function(e){document.getElementsByClassName("tray-items")[0].appendChild(e)}),e()})})}function C(e){document.getElementsByClassName("loading")[0].innerHTML="Loading...<br />"+e}function T(){k.hideLoading()}function _(e){document.querySelector(".tray-active")&&document.querySelector(".tray-active").classList.remove("tray-active"),document.querySelector('[data-block="'+e+'"]').classList.add("tray-active")}function D(){document.getElementById("conv-new").value=JSON.stringify(b.jsonPlanet.fromCSV(document.getElementById("conv-old").value).exportJson())}function z(e){p.stageEffects.skyboxes[E.activeStageLayerInEditor]=e.target.value,j(u.getPackPath(M.currentPackName)+I.pack.skyboxes.get(p.stageEffects.skyboxes[E.activeStageLayerInEditor]).data.filename)}function V(){var e=g.getMaxAttrId(o.data.editingBlockId);g.push(o.data.editingBlockId,e,new g.Attr),y.renderAttributeUI(e)}function G(e){m.changeActiveStageLayer(parseInt(e.target.value)),"undefined"==typeof p.stageEffects.skyboxes[E.activeStageLayerInEditor]&&(p.stageEffects.skyboxes[E.activeStageLayerInEditor]=I.pack.editor.defaultSkybox),j(u.getPackPath(M.currentPackName)+I.pack.skyboxes.get(p.stageEffects.skyboxes[E.activeStageLayerInEditor]).data.filename),document.getElementById("stg-skybox").value=p.stageEffects.skyboxes[E.activeStageLayerInEditor];
}i["default"](function(){h["default"](e),document.getElementById("pla-ver").innerHTML="Planet "+v.version+" by "+v.author,r.addEventListenerforQuery(".ins-show-btn","click",L),r.addEventListenerforQuery(".tray-list-tool","mousedown",N);var t=document.createElement("script");t.src="bower_components/move.js/move.js",document.head.appendChild(t),window.onbeforeunload=function(e){e.returnValue="ページを移動しますか？"},s.raiseEvent("initDom",null)}),e.setupCanvas=n,e.togglefullScreen=a,e.closeInspector=P,e.showInspector=S,e.clickExport=x,e.clickImport=B,e.clickInsShowBtn=L,e.clickTrayTool=N,e.setSkybox=j,e.initTrayBlock=A,e.initTrayObj=O,e.changeLoadingStatus=C,e.hideLoading=T,e.changeActiveBlock=_,s.addEventListener("clickTrayToolbtn",function(t){var n={io:"io",setting:"inspector"};e.showInspector(n[t])}),e.clickConvertOldFile=D,e.changeSkybox=z,e.clickAddAttr=V,e.changeActiveStageLayer=G,t()}(a||(a={})),t.exports=a},{"./modules/classes/vector2":7,"./modules/data":8,"./modules/editBlock":9,"./modules/elem":10,"./modules/evElems":11,"./modules/event":12,"./modules/initDOM":14,"./modules/jsonPlanet":15,"./modules/model/editorModel":17,"./modules/model/packModel":18,"./modules/model/preferencesModel":19,"./modules/model/stageAttrsModel":20,"./modules/model/stageEffectsModel":21,"./modules/packUtil/packManager":25,"./modules/planet":26,"./modules/stage":27,"./modules/tray":28,"./modules/ui/anim":29,"./modules/util":31,"./modules/version":32,"./modules/view/stageRenderView":33}]},{},[1]);