!function e(t,n,i){function o(r,c){if(!n[r]){if(!t[r]){var s="function"==typeof require&&require;if(!c&&s)return s(r,!0);if(a)return a(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[r]={exports:{}};t[r][0].call(l.exports,function(e){var n=t[r][1][e];return o(n?n:e)},l,l.exports,e,t,n,i)}return n[r].exports}for(var a="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(e,t,n){var i,o=e("./modules/ui"),a=e("./modules/initDOM"),r=e("./modules/packUtil/packLoader"),c=e("./modules/packUtil/packManager"),s=e("./modules/event"),u=e("./modules/list"),l=e("./modules/stage"),d=e("./modules/data"),f=e("./modules/makePrefabDataUrls"),h=e("./modules/tray"),p=e("./modules/grid"),m=e("./modules/prefab"),g=e("./modules/vector2"),k=e("./modules/rect"),v=e("./modules/canvas");!function(e){function t(){d.trayItemDataURLs=new u,d.defaultPackName="halstar",d.pack=new c.packModule({}),d.defaultGridSize=25,d.defaultBlockSize=50,d.activeToolName="pencil"}t(),a(function(){r(d.defaultPackName).then(function(e){d.pack=new c.packModule(e),s.raiseEvent("packLoaded",null),l.stageEffects.skybox=d.pack.editor.defaultSkybox,o.setSkybox(c.getPackPath(d.defaultPackName)+d.pack.skyboxes.get(d.pack.editor.defaultSkybox).data.filename),o.initUI(),s.raiseEvent("initedUI",null),o.initTrayBlock().then(function(){o.initTrayObj(),s.raiseEvent("initedTray",null)})}),s.addEventListener("initedTray",function(){o.changeLoadingStatus("making DataURL"),d.trayItemDataURLs=f(),h.updateActiveBlock("w1/block2","pack/halstar/images/mapicons/w1block2-2.png","W1草付ブロック"),o.changeLoadingStatus("Are you ready?"),s.raiseEvent("ready",null)}),s.addEventListener("ready",function(){o.hideLoading()}),s.addEventListener("gridCanvas",function(e){var t=new m(e.gridPos.x,e.gridPos.y,d.selectBlock.fileName,d.selectBlock.blockName,p.toGridPos(d.selectBlock.width),p.toGridPos(d.selectBlock.height)),n=p.getPrefabFromGrid(new g(t.gridX,t.gridY)),i=p.toDrawRect(new k(t.gridX,t.gridY,t.gridW,t.gridH));switch(d.activeToolName){case"pencil":"mousedown"===e.eventName&&(n.contains?(l.items.remove(n.id),l.renderStage()):(v.render(d.selectImage,i),l.items.push(l.getId(),t)));break;case"choice":if("mousedown"===e.eventName&&n.prefab){var a=d.pack.blocks.get(n.prefab.blockName);h.updateActiveBlock(n.prefab.blockName,a.data.bName,c.getPackPath(d.defaultPackName)+a.data.filename),o.changeActiveBlock(n.prefab.blockName)}break;case"hand":"mousemove"===e.eventName&&(scrollX+=e.mousePos.x-p.scrollBeforeX,scrollY+=e.mousePos.y-p.scrollBeforeY,l.renderStage()),"mouseup"!==e.eventName&&(p.scrollBeforeX=e.mousePos.x,p.scrollBeforeY=e.mousePos.y);break;default:("mousemove"===e.eventName||"mousedown"===e.eventName)&&("brush"===d.activeToolName?(n.contains&&n.prefab.blockName!==d.selectBlock.blockName&&(l.items.remove(n.id),l.renderStage()),n.contains||(v.render(d.selectImage,i),l.items.add(l.getId(),t))):"erase"===d.activeToolName&&n.contains&&(l.items.remove(n.id),l.renderStage()))}}),s.addEventListener("packLoaded",function(){}),s.addEventListener("resize",function(){}),s.addEventListener("clickTrayToolbtn",function(){})})}(i||(i={})),t.exports=i},{"./modules/canvas":2,"./modules/data":3,"./modules/event":4,"./modules/grid":5,"./modules/initDOM":7,"./modules/list":8,"./modules/makePrefabDataUrls":9,"./modules/packUtil/packLoader":10,"./modules/packUtil/packManager":11,"./modules/prefab":12,"./modules/rect":13,"./modules/stage":14,"./modules/tray":15,"./modules/ui":16,"./modules/vector2":17}],2:[function(e,t,n){var i,o=e("./initDOM");!function(e){function t(){r.width=window.innerWidth,r.height=window.innerHeight,e.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight}}function n(e,t){c.drawImage(e,t.x,t.y,t.width,t.height)}function i(e){c.clearRect(e.x,e.y,e.width,e.height)}function a(){c.clearRect(0,0,r.width,r.height)}var r,c;o(function(){r=document.getElementById("pla-canvas"),e.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight},t(),r&&r.getContext&&(c=r.getContext("2d"))}),window.addEventListener("resize",t),e.render=n,e.clearByRect=i,e.clear=a}(i||(i={})),t.exports=i},{"./initDOM":7}],3:[function(e,t,n){var i=e("./tray"),o=e("./grid"),a=function(){function e(){}return Object.defineProperty(e,"scrollX",{get:function(){return o.scrollX},enumerable:!0,configurable:!0}),Object.defineProperty(e,"scrollY",{get:function(){return o.scrollY},enumerable:!0,configurable:!0}),e.updateSelectImage=function(){i.updateSelectImage()},e}();t.exports=a},{"./grid":5,"./tray":15}],4:[function(e,t,n){var i,o=e("./list");!function(e){function t(e,t){i.contains(e)?i.get(e).push(t):i.push(e,[t])}function n(e,t){i.contains(e)&&i.get(e).forEach(function(e){e(t)})}var i=new o;e.addEventListener=t,e.raiseEvent=n}(i||(i={})),t.exports=i},{"./list":8}],5:[function(e,t,n){var i,o=e("./data"),a=e("./stage"),r=e("./rect");!function(e){function t(e,t){return e-(t-o.defaultGridSize)/2}function n(t){t.x-e.scrollX}function i(e){var t=new d(!1,-1,null),n={};try{Object.keys(a.items.getAll()).forEach(function(i){var o=a.items.get(parseInt(i));if(e.x>=o.gridX&&e.x<o.gridX+o.gridW&&e.y>=o.gridY&&e.y<o.gridY+o.gridH)throw t=new d(!0,parseInt(i),o),n})}catch(i){if(i!==n)throw i}return t}function c(e){return e*o.defaultGridSize}function s(e){return(e-e%o.defaultGridSize)/o.defaultGridSize}function u(n){return new r(e.scrollX+t(c(n.x),c(n.width)),e.scrollY+t(c(n.y),c(n.height)),c(n.width),c(n.height))}var l=function(){function e(e,t,n){this.gridPos=e,this.eventName=t,this.mousePos=n}return e}();e.gridDetail=l,e.getMousePosFromCenterAndSize=t,e.scrollX=0,e.scrollY=0,e.scrollBeforeX=0,e.scrollBeforeY=0,e.getGridPosFromMousePos=n;var d=function(){function e(e,t,n){this.contains=e,this.id=t,this.prefab=n}return e}();e.getPrefabFromGridDetails=d,e.getPrefabFromGrid=i,e.toMousePos=c,e.toGridPos=s,e.toDrawRect=u}(i||(i={})),t.exports=i},{"./data":3,"./rect":13,"./stage":14}],6:[function(e,t,n){function i(e,t,n){var o=new Image;if(o.src=e,t){var a,r,c=(o.width+n.x)/2,s=(o.height+n.y)/2;return a=document.createElement("canvas"),a.width=c,a.height=s,r=a.getContext("2d"),r.drawImage(o,0,0,c,s),i(a.toDataURL("image/png"))}return o}t.exports=i},{}],7:[function(e,t,n){function i(e){o.push(e)}var o=new Array;document.addEventListener("DOMContentLoaded",function(){o.forEach(function(e){e()})}),t.exports=i},{}],8:[function(e,t,n){var i=function(){function e(){this.data={}}return e.prototype.push=function(e,t){this.data[e]=t},e.prototype.update=function(e,t){this.data[e]=t},e.prototype.get=function(e){return this.data[e]},e.prototype.getAll=function(){return this.data},e.prototype.remove=function(e){delete this.data[e]},e.prototype.clear=function(){this.data={}},e.prototype.contains=function(e){return this.data.hasOwnProperty(e)},e.prototype.toSimple=function(){return this.data},e}();t.exports=i},{}],9:[function(e,t,n){function i(){var e=new a,t=o.pack.blocks.getAll();Object.keys(t).forEach(function(t){e.push(t,s(r.getPackPath(o.defaultPackName)+o.pack.blocks.get(t).data.filename,!0,new c(o.defaultGridSize,o.defaultGridSize)).src)});var n=o.pack.objs.getAll();return Object.keys(n).forEach(function(t){var n=o.pack.objs.get(t).data;e.push(t,s(r.getPackPath(o.defaultPackName)+n.filename,!0,new c(n.width,n.height)).src)}),e}var o=e("./data"),a=e("./list"),r=e("./packUtil/packManager"),c=e("./vector2"),s=e("./image");t.exports=i},{"./data":3,"./image":6,"./list":8,"./packUtil/packManager":11,"./vector2":17}],10:[function(e,t,n){function i(e){return new Promise(function(t){var n=new XMLHttpRequest;n.open("GET",o.getPackPath(e)+"packinfo.json"),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&t(JSON.parse(n.responseText))},n.send(null)})}var o=e("./packManager");t.exports=i},{"./packManager":11}],11:[function(e,t,n){var i,o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},a=e("./../list");!function(e){function t(e){return"pack/"+e+"/"}e.getPackPath=t;var n=function(){function e(e){var t=this;this.pack=new r(e.pack),this.blocks=new a,Object.keys(e.blocks).forEach(function(n){t.blocks.push(n,new s({bName:e.blocks[n].name,filename:e.blocks[n].filename}))}),this.objs=new a,Object.keys(e.objs).forEach(function(n){var i=e.objs[n];i.hidden?t.objs.push(n,new u({oName:i.name,filename:i.filename,width:i.width,height:i.height,type:i.type})):t.objs.push(n,new u({oName:i.name,filename:i.filename,width:i.width,height:i.height,type:i.type,hidden:i.hidden}))}),this.descriptions=new a,Object.keys(e.descriptions).forEach(function(n){var i=e.descriptions[n];t.descriptions.push(n,new l(i))});var n=new a;Object.keys(e.abilities.selectelement).forEach(function(t){n.push(t,e.abilities.selectelement[t])});var o=new a;Object.keys(e.abilities.keys).forEach(function(t){o.push(t,e.abilities.keys[t])});var c=new a;Object.keys(e.abilities.types).forEach(function(t){c.push(t,e.abilities.keys[t])}),this.abilities=new d({selectelement:n,keys:o,types:c}),this.skyboxes=new h,Object.keys(e.skyboxes).forEach(function(n){t.skyboxes.push(n,new f(e.skyboxes[n]))}),this.editor=new i(e.editor.defaultSkybox)}return e}();e.packModule=n;var i=function(){function e(e){this.defaultSkybox=e}return e}();e.packEditorInfo=i;var r=function(){function e(e){this.pName=e.name,this.version=e.version,this.author=e.author,this.exportType=e.exportType}return e}();e.packInfo=r;var c=function(){function e(e){this.data=e}return e}();e.packItem=c;var s=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(c);e.blockInfo=s;var u=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(c);e.objInfo=u;var l=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(c);e.desInfo=l;var d=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(c);e.abilityInfo=d;var f=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(c);e.skyboxInfo=f;var h=function(e){function t(){e.call(this)}return o(t,e),t.prototype.toSimple=function(){var e=this,t={};return Object.keys(this.getAll()).forEach(function(n){t[e.get(n).data.label]=n}),t},t}(a);e.skyboxInfoList=h}(i||(i={})),t.exports=i},{"./../list":8}],12:[function(e,t,n){var i=function(){function e(e,t,n,i,o,a){this.gridX=e,this.gridY=t,this.fileName=n,this.blockName=i,this.gridW=o,this.gridH=a}return e}();t.exports=i},{}],13:[function(e,t,n){var i=function(){function e(e,t,n,i){this.x=e,this.y=t,this.width=n,this.height=i}return e}();t.exports=i},{}],14:[function(e,t,n){var i,o=e("./list"),a=e("./canvas"),r=e("./grid"),c=e("./image"),s=e("./data"),u=e("./rect");!function(e){function t(){d=new o,h=0}function n(){return h++}function i(){a.clear();var e=f.getAll();Object.keys(e).forEach(function(e){var t=f.get(parseInt(e)),n=r.scrollX+r.getMousePosFromCenterAndSize(r.toMousePos(t.gridX),r.toMousePos(t.gridW)),i=r.scrollY+r.getMousePosFromCenterAndSize(r.toMousePos(t.gridY),r.toMousePos(t.gridH)),o=r.toMousePos(t.gridW),l=r.toMousePos(t.gridH);n+o>=0&&n<=a.canvasRect.width&&i+l>=0&&n<=a.canvasRect.height&&a.render(c(s.trayItemDataURLs.get(t.blockName)),new u(n,i,o,l))})}var l=function(){function e(){this.skybox=""}return e}();e.StageEffects=l,e.stageEffects=new l;var d,f;!function(e){function t(e,t){n(e,t)}function n(e,t){d.push(e.toString(),t)}function i(){return d.getAll()}function o(e){return d.remove(e.toString())}function a(){d.clear()}function r(e){return d.get(e.toString())}e.add=t,e.push=n,e.getAll=i,e.remove=o,e.clear=a,e.get=r}(f=e.items||(e.items={}));var h;t(),e.getId=n,e.renderStage=i}(i||(i={})),t.exports=i},{"./canvas":2,"./data":3,"./grid":5,"./image":6,"./list":8,"./rect":13}],15:[function(e,t,n){var i,o=e("./data");!function(e){function t(e,t,n,a,r){a||(a=o.defaultBlockSize),r||(r=o.defaultBlockSize),o.selectBlock=new i(e,t,n,a,r)}function n(){}var i=function(){function e(e,t,n,i,o){this.blockName=e,this.fileName=t,this.label=n,this.width=i,this.height=o}return e}();e.TrayBlockDetails=i,e.updateActiveBlock=t,e.updateSelectImage=n}(i||(i={})),t.exports=i},{"./data":3}],16:[function(e,t,n){var i,o=e("./initDOM");!function(e){function t(){d=new Array}function n(e){d.push(e)}function i(e){document.body.style.backgroundImage="url('"+e+"')"}function a(){}function r(){return new Promise(function(){})}function c(){return new Promise(function(){})}function s(e){}function u(){}function l(e){}var d;e.onBtnClick=n,o(function(){for(var e=document.querySelectorAll(".ui-btn"),t=0;t<e.length;t++)e.item(t).addEventListener("click",function(n){d.forEach(function(i){i(e.item(t),n)})})}),e.setSkybox=i,e.initUI=a,e.initTrayBlock=r,e.initTrayObj=c,e.changeLoadingStatus=s,e.hideLoading=u,e.changeActiveBlock=l,t()}(i||(i={})),t.exports=i},{"./initDOM":7}],17:[function(e,t,n){var i=function(){function e(e,t){this.x=e,this.y=t}return Object.defineProperty(e,"zero",{get:function(){return new e(0,0)},enumerable:!0,configurable:!0}),e}();t.exports=i},{}]},{},[1,2,3,4,5,6,7,8,9,12,13,14,15,16,17]);