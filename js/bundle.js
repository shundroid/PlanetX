!function(e){function t(o){if(n[o])return n[o].exports;var a=n[o]={exports:{},id:o,loaded:!1};return e[o].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.oe=function(e){throw e},t.p="",t(t.s=29)}([function(e,t,n){var o=n(1),a=function(){function e(){}return e.dataInit=function(){this.trayItemDataURLs=new o,this.defaultPackName="oa",this.defaultGridSize=25,this.defaultBlockSize=50,this.activeToolName="pencil",this.isObjMode=!1,this.isFullscreenTray=!1,this.isShowInspector=!1,this.activeStageLayer=0},e}();e.exports=a},function(e,t){var n=function(){function e(){this.data={}}return e.prototype.push=function(e,t){this.data[e]=t},e.prototype.update=function(e,t){this.data[e]=t},e.prototype.get=function(e){return this.data[e]},e.prototype.getAll=function(){return this.data},e.prototype.remove=function(e){delete this.data[e]},e.prototype.clear=function(){this.data={}},e.prototype.contains=function(e){return this.data.hasOwnProperty(e)},e.prototype.toSimple=function(){return this.data},e}();e.exports=n},function(e,t,n){var o,a=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=n(1);!function(e){function t(e){return"pack/"+e+"/"}e.getPackPath=t;var n=function(){function e(e){var t=this;this.pack=new r(e.pack),this.blocks=new i,Object.keys(e.blocks).forEach(function(n){t.blocks.push(n,new s({bName:e.blocks[n].name,filename:e.blocks[n].filename}))}),this.objs=new i,Object.keys(e.objs).forEach(function(n){var o=e.objs[n];o.hidden?t.objs.push(n,new u({oName:o.name,filename:o.filename,width:o.width,height:o.height,type:o.type})):t.objs.push(n,new u({oName:o.name,filename:o.filename,width:o.width,height:o.height,type:o.type,hidden:o.hidden}))}),this.descriptions=new i,Object.keys(e.descriptions).forEach(function(n){var o=e.descriptions[n];t.descriptions.push(n,new d(o))}),this.skyboxes=new f,Object.keys(e.skyboxes).forEach(function(n){t.skyboxes.push(n,new l(e.skyboxes[n]))}),this.editor=e.editor}return e}();e.packModule=n;var o=function(){function e(e,t,n,o){this.defaultSkybox=e,this.defaultBlock=t,this.skyboxMode=n,this.skyboxSize=o}return e}();e.packEditorInfo=o;var r=function(){function e(e){this.pName=e.name,this.version=e.version,this.author=e.author,this.exportType=e.exportType}return e}();e.packInfo=r;var c=function(){function e(e){this.data=e}return e}();e.packItem=c;var s=function(e){function t(){e.apply(this,arguments)}return a(t,e),t}(c);e.blockInfo=s;var u=function(e){function t(){e.apply(this,arguments)}return a(t,e),t}(c);e.objInfo=u;var d=function(e){function t(){e.apply(this,arguments)}return a(t,e),t}(c);e.desInfo=d;var l=function(e){function t(){e.apply(this,arguments)}return a(t,e),t}(c);e.skyboxInfo=l;var f=function(e){function t(){e.call(this)}return a(t,e),t.prototype.toSimple=function(){var e=this,t={};return Object.keys(this.getAll()).forEach(function(n){t[e.get(n).data.label]=n}),t},t}(i);e.skyboxInfoList=f}(o||(o={})),e.exports=o},function(e,t){var n=function(){function e(e,t){this.x=e,this.y=t}return Object.defineProperty(e,"zero",{get:function(){return new e(0,0)},enumerable:!0,configurable:!0}),e}();e.exports=n},function(e,t,n){var o,a=n(1);!function(e){function t(e,n){-1!==e.indexOf("|")?e.split("|").forEach(function(e){t(e,n)}):o.contains(e)?o.get(e).push(n):o.push(e,[n])}function n(e,t){o.contains(e)&&o.get(e).forEach(function(n){n(t,e)})}var o=new a;e.addEventListener=t,e.raiseEvent=n}(o||(o={})),e.exports=o},function(e,t){function n(e){o.push(e)}var o=new Array;document.addEventListener("DOMContentLoaded",function(){o.forEach(function(e){e()})}),e.exports=n},function(e,t,n){var o,a=n(1),i=n(10),r=n(8),c=n(0),s=n(11),u=n(4),d=n(3);!function(e){function t(e){c.activeStageLayer=e,f(e)}function n(){x={},w={},S=new Array,e.header="",e.footer="",P=0}function o(){return P++}function l(){P=0}function f(t){void 0===t&&(t=0),i.clear();var n=I.getLayerItems(t).getAll();Object.keys(n).forEach(function(t){var n=I.get(parseInt(t)),o=e.scrollX+e.getMousePosFromCenterAndSize(e.toMousePos(n.gridX),e.toMousePos(n.gridW)),a=e.scrollY+e.getMousePosFromCenterAndSize(e.toMousePos(n.gridY),e.toMousePos(n.gridH)),u=e.toMousePos(n.gridW),d=e.toMousePos(n.gridH);o+u>=0&&o<=i.canvasRect.width&&a+d>=0&&a<=i.canvasRect.height&&i.render(r(c.trayItemDataURLs.get(n.blockName)),new s(o,a,u,d))})}function h(e,t){return e-(t-c.defaultGridSize)/2}function p(t){var n=t.x-e.scrollX,o=t.y-e.scrollY,a=n-n%c.defaultGridSize,i=o-o%c.defaultGridSize,r=a/c.defaultGridSize,s=i/c.defaultGridSize;return new d(r,s)}function g(e,t){var n=new A(!1,-1,null),o={};try{Object.keys(I.getLayerItems(t).getAll()).forEach(function(t){var a=I.get(parseInt(t));if(e.x>=a.gridX&&e.x<a.gridX+a.gridW&&e.y>=a.gridY&&e.y<a.gridY+a.gridH)throw n=new A(!0,parseInt(t),a),o})}catch(a){if(a!==o)throw a}return n}function v(e){return e*c.defaultGridSize}function m(e){return(e-e%c.defaultGridSize)/c.defaultGridSize}function k(t){return new s(e.scrollX+h(v(t.x),v(t.width)),e.scrollY+h(v(t.y),v(t.height)),v(t.width),v(t.height))}var y=function(){function e(){this.skybox=""}return e}();e.StageEffects=y,e.stageEffects=new y;var b=function(){function e(e,t){void 0===e&&(e=""),void 0===t&&(t=""),this.attrName=e,this.attrVal=t}return e}();e.Attr=b;var w,E;!function(e){function t(e){w=e}function n(e,t,n){"undefined"==typeof w[e]&&(w[e]={}),w[e][t]=n}function o(e,t,n){if(n instanceof b)w[e][t]=n;else{var o=w[e][t];"undefined"!=typeof n.attrName&&(o.attrName=n.attrName),"undefined"!=typeof n.attrVal&&(o.attrVal=n.attrVal),w[e][t]=o}}function a(e,t){return"undefined"==typeof w[e]?!1:"undefined"!=typeof w[e][t]}function i(e){return"undefined"!=typeof w[e]}function r(e,t){delete w[e][t]}function c(e){delete w[e]}function s(e){return w[e]}function u(e,t){return w[e][t]}function d(){return w}function l(){w={}}function f(e){return"undefined"==typeof w[e]?0:Object.keys(w[e]).length}e.setAll=t,e.push=n,e.update=o,e.containsAttr=a,e.containsBlock=i,e.removeAttr=r,e.removeBlock=c,e.getBlock=s,e.getAttr=u,e.getAll=d,e.clear=l,e.getMaxAttrId=f}(E=e.blockAttrs||(e.blockAttrs={}));var x,S;e.changeActiveStageLayer=t;var I;!function(e){function t(e,t,n){void 0===n&&(n=0),x[e]=t,s(n,e)}function n(){return x}function o(e,t){S[t].splice(S[t].indexOf(e),1),delete x[e]}function i(){x={}}function r(e){return x[e]}function c(e){var t=u(e),n=new a;return t.forEach(function(e){n.push(e.toString(),r(e))}),n}function s(e,t){"undefined"==typeof S[e]&&(S[e]=[]),S[e].push(t)}function u(e){return"undefined"==typeof S[e]&&(S[e]=[]),S[e]}function d(){return S}e.push=t,e.all=n,e.remove=o,e.clear=i,e.get=r,e.getLayerItems=c,e.pushStageLayer=s,e.getLayerIds=u,e.getAllLayer=d}(I=e.items||(e.items={}));var P;n(),e.getId=o,e.resetId=l,e.renderStage=f;var L,N=!1;u.addEventListener("resize",function(){N&&clearTimeout(L),N=!0,L=setTimeout(function(){N=!1,f(c.activeStageLayer)},100)});var B=function(){function e(e,t,n){this.gridPos=e,this.eventName=t,this.mousePos=n}return e}();e.gridDetail=B,e.getMousePosFromCenterAndSize=h,e.scrollX=0,e.scrollY=0,e.scrollBeforeX=0,e.scrollBeforeY=0,e.getGridPosFromMousePos=p;var A=function(){function e(e,t,n){this.contains=e,this.id=t,this.prefab=n}return e}();e.getPrefabFromGridDetails=A,e.getPrefabFromGrid=g,e.toMousePos=v,e.toGridPos=m,e.toDrawRect=k}(o||(o={})),e.exports=o},function(e,t){var n;!function(e){e.version="v1.0",e.author="shundroid",e.jsonPlanetVersion=.1}(n||(n={})),e.exports=n},function(e,t){function n(e,t,o){var a=new Image;if(a.src=e,t){var i,r,c=(a.width+o.x)/2,s=(a.height+o.y)/2;return i=document.createElement("canvas"),i.width=c,i.height=s,r=i.getContext("2d"),r.drawImage(a,0,0,c,s),n(i.toDataURL("image/png"))}return a}e.exports=n},function(e,t,n){var o,a=n(7);!function(e){var t=function(){function e(e,t,n,o,a){this.blockName=e,this.posX=t,this.posY=n,this.name=o,this.attr=a}return e.prototype.toArray=function(){var e=[this.blockName,this.posX,this.posY];return"undefined"!=typeof this.name?e.push(this.name):e.push(""),"undefined"!=typeof this.attr&&e.push(this.attr),e},e.fromArray=function(t){var n=new e(t[0],t[1],t[2],t[3]);return"undefined"!=typeof t[4]&&(n.attr=t[4]),n},e}();e.jsonBlockItem=t;var n=function(){function e(e,t){void 0===t&&(t=[]),this.JsonPlanetVersion=e,this.Stage=t}return e.prototype.exportJson=function(){var e={};e.JsonPlanetVersion=this.JsonPlanetVersion,e.Stage=[];for(var t=0;t<this.Stage.length;t++)e.Stage[t]=[],this.Stage[t].forEach(function(n){e.Stage[t].push(n.toArray())});return e},e.importJson=function(n){for(var o=new e(n.JsonPlanetVersion||a.jsonPlanetVersion),i=n.Stage,r=0;r<i.length;r++)o.Stage[r]=[],i[r].forEach(function(e){o.Stage[r].push(t.fromArray(e))});return o},e}();e.jsonPlanet=n}(o||(o={})),e.exports=o},function(e,t,n){var o,a=n(5);!function(e){function t(){r.width=window.innerWidth,r.height=window.innerHeight,e.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight}}function n(e,t){c.drawImage(e,t.x,t.y,t.width,t.height)}function o(e){c.clearRect(e.x,e.y,e.width,e.height)}function i(){c.clearRect(0,0,r.width,r.height)}var r,c;a(function(){r=document.getElementById("pla-canvas"),e.canvasRect={x:0,y:0,width:window.innerWidth,height:window.innerHeight},t(),r&&r.getContext&&(c=r.getContext("2d"),c.imageSmoothingEnabled=!1,c.mozImageSmoothingEnabled=!1,c.webkitImageSmoothingEnabled=!1,c.msImageSmoothingEnabled=!1)}),window.addEventListener("resize",t),e.render=n,e.clearByRect=o,e.clear=i}(o||(o={})),e.exports=o},function(e,t){var n=function(){function e(e,t,n,o){this.x=e,this.y=t,this.width=n,this.height=o}return e}();e.exports=n},function(e,t,n){var o,a=n(0),i=n(6);!function(e){function t(e){l=e,o()}function n(){return l}function o(){if(document.getElementById("ed-name").textContent="Name: "+l.blockName,document.getElementById("ed-pos").textContent="Pos: "+l.blockPos.x+", "+l.blockPos.y,document.getElementById("ed-id").textContent="ID: "+l.blockId,document.getElementsByClassName("ed-attr-view")[0].innerHTML="",i.blockAttrs.containsBlock(a.editingBlockId)){var e=i.blockAttrs.getBlock(a.editingBlockId);Object.keys(e).forEach(function(e){var t=i.blockAttrs.getAttr(a.editingBlockId,parseInt(e));r(parseInt(e),t.attrVal,t.attrName)})}}function r(e,t,n){var o=document.createElement("section");o.id="ed-attr-field-"+e;var a=document.createElement("input");a.type="text",a.id="ed-attr-name-"+e,a.classList.add("ed-attr-name"),a.placeholder="name","undefined"!=typeof t&&(a.value=t),a.addEventListener("change",s);var i=document.createElement("input");i.type="text",i.id="ed-attr-"+e,i.classList.add("ed-attr-val"),i.placeholder="value","undefined"!=typeof n&&(i.value=n),i.addEventListener("change",c);var r=document.createElement("button");r.innerHTML='<i class="fa fa-minus"></i>',r.classList.add("pla-btn"),r.id="ed-attr-remove-"+e,r.addEventListener("click",u),o.appendChild(r),o.appendChild(a),o.appendChild(document.createTextNode(":")),o.appendChild(i),document.getElementsByClassName("ed-attr-view")[0].appendChild(o)}function c(e){console.log(i.blockAttrs.getAll()),console.log(parseInt(e.target.id.replace("ed-attr-",""))),i.blockAttrs.update(a.editingBlockId,parseInt(e.target.id.replace("ed-attr-","")),{attrVal:e.target.value})}function s(e){i.blockAttrs.update(a.editingBlockId,parseInt(e.target.id.replace("ed-attr-name-","")),{attrName:e.target.value})}function u(e){var t=parseInt(e.target.id.replace("ed-attr-remove-",""));i.blockAttrs.removeAttr(a.editingBlockId,t),document.getElementsByClassName("ed-attr-view")[0].removeChild(document.getElementById("ed-attr-field-"+t))}var d=function(){function e(e,t,n){this.blockName=e,this.blockPos=t,this.blockId=n}return e}();e.EditBlock=d;var l;e.updateEditBlock=t,e.getCurrentEditBlock=n,e.updateEditBlockUI=o,e.renderAttributeUI=r,e.changeAttrVal=c,e.changeAttrName=s,e.clickRemoveAttr=u}(o||(o={})),e.exports=o},function(e,t){var n;!function(e){function t(e,t,o){n(e,function(e){e.addEventListener(t,o)})}function n(e,t){Array.prototype.forEach.call(document.querySelectorAll(e),t)}e.addEventListenerforQuery=t,e.forEachforQuery=n}(n||(n={})),e.exports=n},function(e,t){var n=function(){function e(e,t,n,o,a,i){this.gridX=e,this.gridY=t,this.fileName=n,this.blockName=o,this.gridW=a,this.gridH=i}return e}();e.exports=n},function(e,t,n){var o,a=n(8),i=n(17),r=n(0),c=n(24),s=n(4),u=n(2);!function(e){function t(e,t,o,a,c){var s=a||r.defaultBlockSize,u=c||r.defaultBlockSize;r.selectBlock=new i(e,t,o,s,u),n()}function n(){r.selectImage=a(r.trayItemDataURLs.get(r.selectBlock.blockName)),c.start(),r.selectImage.onload=function(){c.end()}}function o(e){return new Promise(function(t){var n=Object.keys(r.pack.blocks.getAll()),o=[],a=function(i){var c=n[i],d=document.createElement("div");d.classList.add("tray-list","tray-list-block"),d.addEventListener("click",function(e){s.raiseEvent("ui_clickTray",e)});var l=document.createElement("img");l.src=u.getPackPath(r.defaultPackName)+r.pack.blocks.get(c).data.filename,l.onload=function(){l.alt=r.pack.blocks.get(c).data.bName,l.dataset.block=c,d.appendChild(l),o.push(d),i===n.length-1?t(o):(e(i,n.length-1),a(i+1))}};a(0)})}function d(e){return new Promise(function(t){var n=Object.keys(r.pack.objs.getAll()),o=[],a=function(i){var c=n[i],d=document.createElement("div");d.classList.add("tray-list","tray-list-obj"),d.addEventListener("click",function(e){s.raiseEvent("ui_clickTray",e)});var l=document.createElement("img");l.src=u.getPackPath(r.defaultPackName)+r.pack.objs.get(c).data.filename,l.onload=function(){l.alt=r.pack.objs.get(c).data.oName,l.dataset.block=c,d.style.width=l.style.width=r.pack.objs.get(c).data.width/(r.pack.objs.get(c).data.height/50)+"px",d.style.height=l.style.height="50px",d.appendChild(l),o.push(d),i===n.length-1?t(o):(e(i,n.length-1),a(i+1))}};a(0)})}e.updateActiveBlock=t,e.updateSelectImage=n,e.initTrayBlock=o,e.initTrayObj=d}(o||(o={})),e.exports=o},function(e,t,n){var o,a=n(28),i=n(5),r=n(22),c=n(2),s=n(4),u=n(6),d=n(0),l=n(21),f=n(15),h=n(14),p=n(3),g=n(11),v=n(10),m=n(12),k=n(26);!function(e){function t(){d.dataInit()}t(),i(function(){a.setupCanvas(),r(d.defaultPackName).then(function(e){d.pack=new c.packModule(e),s.raiseEvent("packLoaded",null),u.stageEffects.skybox=d.pack.editor.defaultSkybox,a.setSkybox(c.getPackPath(d.defaultPackName)+d.pack.skyboxes.get(d.pack.editor.defaultSkybox).data.filename),s.raiseEvent("initedPack",null),s.raiseEvent("initedUI",null),a.initTrayBlock().then(function(){a.initTrayObj().then(function(){s.raiseEvent("initedTray",null)})})}),s.addEventListener("initedTray",function(){a.changeLoadingStatus("making DataURL"),d.trayItemDataURLs=l();var e=d.pack.blocks.get(d.pack.editor.defaultBlock);f.updateActiveBlock(d.pack.editor.defaultBlock,e.data.filename,e.data.bName),a.changeLoadingStatus("Are you ready?"),s.raiseEvent("ready",null)}),s.addEventListener("ready",function(){a.hideLoading()}),s.addEventListener("gridCanvas",function(e){var t=new h(e.gridPos.x,e.gridPos.y,d.selectBlock.fileName,d.selectBlock.blockName,u.toGridPos(d.selectBlock.width),u.toGridPos(d.selectBlock.height)),n=u.getPrefabFromGrid(new p(t.gridX,t.gridY),d.activeStageLayer),o=u.toDrawRect(new g(t.gridX,t.gridY,t.gridW,t.gridH));switch(k.hide(),d.activeToolName){case"pencil":"down"===e.eventName?n.contains?(u.items.remove(n.id,d.activeStageLayer),u.renderStage(d.activeStageLayer)):(v.render(d.selectImage,o),u.items.push(u.getId(),t,d.activeStageLayer)):"hovering"===e.eventName&&k.focus(new p(o.x,o.y),new p(o.width,o.height),n.contains?"rgba(240,0,0,0.6)":"rgba(0,240,0,0.6)");break;case"choice":if("down"===e.eventName&&n.prefab){if(d.pack.objs.contains(n.prefab.blockName)){var i=d.pack.objs.get(n.prefab.blockName);f.updateActiveBlock(n.prefab.blockName,i.data.oName,c.getPackPath(d.defaultPackName)+i.data.filename,i.data.width,i.data.height)}else{var r=d.pack.blocks.get(n.prefab.blockName);f.updateActiveBlock(n.prefab.blockName,r.data.bName,c.getPackPath(d.defaultPackName)+r.data.filename)}a.changeActiveBlock(n.prefab.blockName)}break;case"hand":"move"===e.eventName&&(u.scrollX+=e.mousePos.x-u.scrollBeforeX,u.scrollY+=e.mousePos.y-u.scrollBeforeY,u.renderStage(d.activeStageLayer)),u.scrollBeforeX=e.mousePos.x,u.scrollBeforeY=e.mousePos.y;break;case"edit":"down"===e.eventName&&n.contains&&(a.showInspector("edit-block"),d.editingBlockId=n.id,m.updateEditBlock(new m.EditBlock(n.prefab.blockName,new p(n.prefab.gridX,n.prefab.gridY),n.id)));break;default:("move"===e.eventName||"down"===e.eventName)&&("brush"===d.activeToolName?(n.contains&&n.prefab.blockName!==d.selectBlock.blockName&&(u.items.remove(n.id,d.activeStageLayer),u.renderStage(d.activeStageLayer)),n.contains||(v.render(d.selectImage,o),u.items.push(u.getId(),t,d.activeStageLayer))):"erase"===d.activeToolName&&n.contains&&(u.items.remove(n.id,d.activeStageLayer),u.renderStage(d.activeStageLayer)))}})})}(o||(o={})),e.exports=o},function(e,t){var n=function(){function e(e,t,n,o,a){this.blockName=e,this.fileName=t,this.label=n,this.width=o,this.height=a}return e}();e.exports=n},function(e,t,n){var o,a=n(9),i=n(7);!function(e){function t(e){var t=e.split("\n"),n=[],o=0,a=-1,i=0;return n.push("//:csv"),t.forEach(function(e){if(""!==e)if(-1===a)i++,5===i&&a++;else if(0===a)5===i&&"// stageCTRL::edit not_header"===e?a++:5===i?(n.push("//:header"),n.push(e),i++):"// stageCTRL::edit /header"===e?(n.push("//:/header"),a++):n.push(e);else if(1===a){if("// stageCTRL::edit footer"===e)return a++,void(i=10);if("// stageCTRL::edit not_footer"===e)return void(a+=2);if("*"===e.substring(0,1))return void(-1!==e.indexOf("*skybox,")?n.push(e):n.push(e));if(":"===e.substring(0,1))return;if(e=e.replace(/ /g,""),"//"===e.substring(0,2))return;e=e.split("=")[0];var t=e.split(",");t[2]=(-parseInt(t[2])).toString(),n.push([[t[0],t[1],t[2]].join(","),o++].join("="))}else 2===a&&(10===i?(i++,n.push("//:footer"),n.push(e)):"// stageCTRL::edit /footer"===e?(n.push("//:/footer"),a++):n.push(e))}),n.join("\n")}function n(e){var t=new a.jsonPlanet(i.jsonPlanetVersion),n=e.split("\n");return n.forEach(function(e){if(""!==e&&"*"!==e.substring(0,1)&&"//"!==e.substring(0,2)){var n=e.split("="),o=n[0].split(",");t.Stage[0].push(new a.jsonBlockItem(o[0],parseInt(o[1]),parseInt(o[2]),n[1]))}}),t}e.old2CSV=t,e.csv2Json=n}(o||(o={})),e.exports=o},function(e,t,n){var o,a=n(13);!function(e){function t(e){a.forEachforQuery(".ev-btn",function(t){t.addEventListener("click",e[t.dataset.listener])}),a.forEachforQuery(".ev-input",function(t){var n=t;"undefined"!=typeof n.dataset["default"]&&(n.value=n.dataset["default"]),"undefined"!=typeof n.dataset.change&&n.addEventListener("change",e[n.dataset.change])})}e.set=t}(o||(o={})),e.exports=o},function(e,t){function n(e){var t=document.createElement("script");return t.src=e,t}e.exports=n},function(e,t,n){function o(){var e=new i,t=a.pack.blocks.getAll();Object.keys(t).forEach(function(t){e.push(t,s(r.getPackPath(a.defaultPackName)+a.pack.blocks.get(t).data.filename,!0,new c(a.defaultGridSize,a.defaultGridSize)).src)});var n=a.pack.objs.getAll();return Object.keys(n).forEach(function(t){var n=a.pack.objs.get(t).data;e.push(t,s(r.getPackPath(a.defaultPackName)+n.filename,!0,new c(n.width,n.height)).src)}),e}var a=n(0),i=n(1),r=n(2),c=n(3),s=n(8);e.exports=o},function(e,t,n){function o(e){return new Promise(function(t){var n=new XMLHttpRequest;n.open("GET",a.getPackPath(e)+"packinfo.json"),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&t(JSON.parse(n.responseText))},n.send(null)})}var a=n(2);e.exports=o},function(e,t,n){var o,a=n(6),i=n(14),r=n(0),c=n(9),s=n(7);!function(e){function t(){for(var e=new c.jsonPlanet(s.jsonPlanetVersion),t=a.items.getAllLayer(),n=0;n<t.length;n++)e.Stage[n]=[],t[n].forEach(function(t){var o=a.items.get(t);if(a.blockAttrs.containsBlock(t)){var i={},r=a.blockAttrs.getBlock(t);Object.keys(r).forEach(function(e){i[r[parseInt(e)].attrName]=r[parseInt(e)].attrVal}),e.Stage[n].push(new c.jsonBlockItem(o.blockName,o.gridX,o.gridY,t.toString(),i))}else e.Stage[n].push(new c.jsonBlockItem(o.blockName,o.gridX,o.gridY,t.toString()))});return e}function n(e){a.items.clear(),a.blockAttrs.clear(),a.resetId();for(var t=0;t<e.Stage.length;t++)e.Stage[t].forEach(function(e){var n=a.getId();if(r.pack.objs.contains(e.blockName)){var o=r.pack.objs.get(e.blockName);a.items.push(n,new i(e.posX,e.posY,o.data.filename,e.blockName,a.toGridPos(o.data.width),a.toGridPos(o.data.height)),t)}else{var c=r.pack.blocks.get(e.blockName);a.items.push(n,new i(e.posX,e.posY,c.data.filename,e.blockName,a.toGridPos(r.defaultBlockSize),a.toGridPos(r.defaultBlockSize)),t)}"undefined"!=typeof e.attr&&Object.keys(e.attr).forEach(function(t){a.blockAttrs.push(n,a.blockAttrs.getMaxAttrId(n),new a.Attr(t,e.attr[t]))})});r.activeStageLayer=0;var n=new a.StageEffects;return n.skybox="sky",n}e.toJsonPlanet=t,e.fromJsonPlanet=n}(o||(o={})),e.exports=o},function(e,t){var n;!function(e){function t(){document.getElementById("pla-canvas").style.cursor="wait"}function n(){document.getElementById("pla-canvas").style.cursor="crosshair"}e.start=t,e.end=n}(n||(n={})),e.exports=n},function(e,t){var n;!function(e){function t(){move(".pla-footer").set("height","100%").duration("0.5s").end()}function n(){move(".pla-footer").set("height","50px").duration("0.5s").end()}function o(){move(".pla-inspector").set("left","80%").duration("0.5s").end()}function a(){move(".pla-inspector").set("left","100%").duration("0.5s").end()}function i(){move(".loading").set("opacity",0).duration("1s").then().set("display","none").pop().end()}e.showTrayFull=t,e.hideTrayFull=n,e.showInspector=o,e.hideInspector=a,e.hideLoading=i}(n||(n={})),e.exports=n},function(e,t,n){var o,a=n(5);!function(e){function t(e,t,n){o.style.visibility="visible",o.style.left=e.x+"px",o.style.top=e.y+"px",o.style.width=t.x+"px",o.style.height=t.y+"px",o.style.backgroundColor=n}function n(){o.style.visibility="hidden"}var o;a(function(){o=document.createElement("div"),o.id="guide",o.style.position="fixed",o.style.backgroundColor="rgba(240,0,0,0.6)",o.style.pointerEvents="none",document.body.appendChild(o)}),e.focus=t,e.hide=n}(o||(o={})),e.exports=o},function(e,t){var n;!function(e){function t(e){var n=[];return Object.keys(e).forEach(function(o){e[o].constructor==={}.constructor?(n.push('<optgroup label="'+o+'">'),n.push(t(e[o])),n.push("</optgroup>")):n.push('<option value="'+e[o]+'">'+o+"</option>")}),n.join("\n")}e.obj2SelectElem=t}(n||(n={})),e.exports=n},function(e,t,n){var o,a=n(0),i=n(5),r=n(4),c=n(13),s=n(18),u=n(20),d=n(27),l=n(3),f=n(15),h=n(2),p=n(23),g=n(6),v=n(7),m=n(19),k=n(25),y=n(12),b=n(9);!function(e){function t(){window.addEventListener("resize",function(){r.raiseEvent("resize",null)}),r.addEventListener("ui_clickTray",function(e){var t=e.target;if(a.isObjMode=t.parentElement.classList.contains("tray-list-obj"),a.isObjMode){var n=a.pack.objs.get(t.dataset.block).data;f.updateActiveBlock(t.dataset.block,n.filename,n.oName,n.width,n.height)}else{var n=a.pack.blocks.get(t.dataset.block).data;f.updateActiveBlock(t.dataset.block,n.filename,n.bName)}T(t.dataset.block)}),r.addEventListener("ui_downCanvas|ui_moveCanvas|ui_upCanvas|ui_hoveringCanvas",function(e,t){var n=g.getGridPosFromMousePos(new l(e.clientX,e.clientY));r.raiseEvent("gridCanvas",new g.gridDetail(n,t.replace("ui_","").replace("Canvas",""),new l(e.clientX,e.clientY)))}),r.addEventListener("initedPack",function(){"undefined"!=typeof a.pack.editor.skyboxMode&&"repeat"===a.pack.editor.skyboxMode&&(document.body.style.backgroundRepeat="repeat","undefined"!=typeof a.pack.editor.skyboxSize?document.body.style.backgroundSize=a.pack.editor.skyboxSize:document.body.style.backgroundSize="auto"),c.forEachforQuery(".pack-select",function(e){var t=e;t.innerHTML=d.obj2SelectElem(a.pack[t.dataset.items].toSimple())}),document.getElementById("stg-skybox").value=a.pack.editor.defaultSkybox})}function n(){e.canvas=document.getElementById("pla-canvas"),e.canvas.addEventListener("mousedown",function(e){r.raiseEvent("ui_downCanvas",e)}),e.canvas.addEventListener("mousemove",function(e){1===e.buttons?r.raiseEvent("ui_moveCanvas",e):r.raiseEvent("ui_hoveringCanvas",e)}),e.canvas.addEventListener("mouseup",function(e){r.raiseEvent("ui_upCanvas",e)})}function o(e){a.isFullscreenTray?(k.hideTrayFull(),e.target.textContent="↑"):(w(),k.showTrayFull(),e.target.textContent="↓"),a.isFullscreenTray=!a.isFullscreenTray}function w(){a.isShowInspector&&(a.isShowInspector=!1,k.hideInspector())}function E(e){document.querySelector(".ins-article-active")&&document.querySelector(".ins-article-active").classList.remove("ins-article-active"),document.getElementById("ins-"+e).classList.add("ins-article-active"),a.isShowInspector||(a.isShowInspector=!0,k.showInspector())}function x(){document.getElementById("pla-io").value=JSON.stringify(p.toJsonPlanet().exportJson())}function S(){var e=p.fromJsonPlanet(b.jsonPlanet.importJson(JSON.parse(document.getElementById("pla-io").value)));g.stageEffects=e,N(h.getPackPath(a.defaultPackName)+a.pack.skyboxes.get(e.skybox).data.filename),g.renderStage(a.activeStageLayer)}function I(e){E(e.target.dataset.ins)}function P(e){var t=e.target;"io-header"===t.id?g.header=t.value:"io-footer"===t.id&&(g.footer=t.value)}function L(e){var t=e.target;return"I"===t.nodeName&&(t=t.parentElement),t.classList.contains("tool-btn")?void r.raiseEvent("clickTrayToolbtn",t.dataset.toolname):(document.getElementsByClassName("tool-active")[0].classList.remove("tool-active"),t.classList.add("tool-active"),void(a.activeToolName=t.dataset.toolname))}function N(e){document.body.style.backgroundImage="url('"+e+"')"}function B(){return new Promise(function(e){f.initTrayBlock(function(e,t){j("loading tray-block : "+e.toString()+" / "+t.toString())}).then(function(t){t.forEach(function(e){document.getElementsByClassName("tray-items")[0].appendChild(e)}),e()})})}function A(){return new Promise(function(e){f.initTrayObj(function(e,t){j("loading tray-obj : "+e.toString()+" / "+t.toString())}).then(function(t){t.forEach(function(e){document.getElementsByClassName("tray-items")[0].appendChild(e)}),e()})})}function j(e){document.getElementsByClassName("loading")[0].innerHTML="Loading...<br />"+e}function C(){k.hideLoading()}function T(e){document.querySelector(".tray-active")&&document.querySelector(".tray-active").classList.remove("tray-active"),document.querySelector('[data-block="'+e+'"]').classList.add("tray-active")}function O(){document.getElementById("conv-new").value=JSON.stringify(s.csv2Json(document.getElementById("conv-old").value).exportJson())}function z(e){g.stageEffects.skybox=e.target.value,N(h.getPackPath(a.defaultPackName)+a.pack.skyboxes.get(g.stageEffects.skybox).data.filename)}function M(){var e=g.blockAttrs.getMaxAttrId(a.editingBlockId);g.blockAttrs.push(a.editingBlockId,e,new g.Attr),y.renderAttributeUI(e)}function G(e){g.changeActiveStageLayer(parseInt(e.target.value))}i(function(){m.set(e),document.getElementById("pla-ver").innerHTML="Planet "+v.version+" by "+v.author,c.addEventListenerforQuery(".ins-show-btn","click",I),c.addEventListenerforQuery(".io-hf","change",P),c.addEventListenerforQuery(".tray-list-tool","click",L),document.head.appendChild(u("bower_components/move.js/move.js")),window.onbeforeunload=function(e){e.returnValue="ページを移動しますか？"},r.raiseEvent("initDom",null)}),e.setupCanvas=n,e.togglefullScreen=o,e.closeInspector=w,e.showInspector=E,e.clickExport=x,e.clickImport=S,e.clickInsShowBtn=I,e.changeHeaderorFooterValue=P,e.clickTrayTool=L,e.setSkybox=N,e.initTrayBlock=B,e.initTrayObj=A,e.changeLoadingStatus=j,e.hideLoading=C,e.changeActiveBlock=T,r.addEventListener("clickTrayToolbtn",function(t){var n={io:"io",setting:"inspector"};e.showInspector(n[t])}),e.clickConvertOldFile=O,e.changeSkybox=z,e.clickAddAttr=M,e.changeActiveStageLayer=G,t()}(o||(o={})),e.exports=o},function(e,t,n){e.exports=n(16)}]);